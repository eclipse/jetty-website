<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="generator" content="Asciidoctor 1.5.7.1"><title>Eclipse Jetty: Development Guide</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><!--Google Tag Manager--><script>(function(w,d,s,l,i){
  w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
  var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
  j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5WLCZXC');</script><!--End Google Tag Manager--><link rel="shortcut icon" href="../common/images/favicon.ico"><link rel="stylesheet" href="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/quicksilver.min.css?v1.3"><meta name="description" content="The Eclipse Foundation - home to a global community, the Eclipse IDE, Jakarta EE and over 350 open source projects, including runtimes, tools and frameworks."><meta property="og:description" content="The Eclipse Foundation - home to a global community, the Eclipse IDE, Jakarta EE and over 350 open source projects, including runtimes, tools and frameworks."><meta property="og:image" content="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-foundation-200x200.png"><meta property="og:title" content="Eclipse Jetty"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta itemprop="name" content="Eclipse Jetty"><meta itemprop="description" content="The Eclipse Foundation - home to a global community, the Eclipse IDE, Jakarta EE and over 350 open source projects, including runtimes, tools and frameworks."><meta itemprop="image" content="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-foundation-400x400.png"><meta name="twitter:site" content="@EclipseFdn"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Eclipse Jetty"><meta name="twitter:url" content="https://www.eclipse.org/eclipse.org-common/themes/solstice/html_template/index.php?theme=default&layout=thin"><meta name="twitter:description" content="The Eclipse Foundation - home to a global community, the Eclipse IDE, Jakarta EE and over 350 open source projects, including runtimes, tools and frameworks."><meta name="twitter:image" content="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-foundation-400x400.png"><link href="https://fonts.googleapis.com/css?family=Libre+Franklin:400,700,300,600,100" rel="stylesheet" type="text/css"><script>var eclipse_org_common = {"settings":{"cookies_class":{"name":"eclipse_settings","enabled":1}}}</script><link rel="stylesheet" href="../common/css/jetty.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"></head><body id="body_solstice"><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5WLCZXC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--><a class="sr-only" href="#content">Skip to main content</a><header class="header-wrapper" id="header-wrapper"><div class="clearfix toolbar-container-wrapper"><div class="container"><div class="text-right toolbar-row row hidden-print"><div class="col-md-24 row-toolbar-col"><ul class="list-inline"><li><a class="toolbar-link" href="https://accounts.eclipse.org/user/login/?takemeback=https%3A%2F%2Fwww.eclipse.org%2Feclipse.org-common%2Fthemes%2Fsolstice%2Fhtml_template%2Findex.php"><i class="fa fa-sign-in"> Log in</i></a></li><li><a class="toolbar-link toolbar-manage-cookies dropdown-toggle"><i class="fa fa-wrench"> Manage Cookies</i></a></li></ul></div></div></div></div><div class="container"><div class="row" id="header-row"><div class="col-sm-5 col-md-4" id="header-left"><div class="wrapper-logo-default"><a href="https://www.eclipse.org/"><img class="logo-eclipse-default hidden-xs" alt="logo" width="160" src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-foundation-white-orange.svg"></a></div></div><div class="col-sm-19 col-md-20 margin-top-10" id="main-menu-wrapper"><div class="float-right hidden-xs" id="btn-call-for-action"><a href="https://www.eclipse.org/donate/" class="btn btn-huge btn-info"><i class="fa fa-star">Donate</i></a></div><div class="navbar yamm float-sm-right" id="main-menu"><div class="navbar-collapse collapse" id="navbar-main-menu"><ul class="nav navbar-nav"><li><a href="https://www.eclipse.org/membership/" target="_self">Members</a></li><li><a href="https://www.eclipse.org/org/workinggroups/" target="_self">Working Groups</a></li><li><a href="https://www.eclipse.org/projects/" target="_self">Projects</a></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Community <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li><li><a href="https://blogs.eclipse.org">Blogs</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Participate <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/org/research/">Research</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Eclipse IDE <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://www.eclipse.org/downloads">Download</a></li><li><a href="https://help.eclipse.org">Documentation</a></li><li><a href="https://www.eclipse.org/getting_started">Getting Started / Support</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li><li><a href="https://www.eclipse.org/ide/">IDE and Tools</a></li><li><a href="https://www.eclipse.org/forums/index.php/f/89/">Newcomer Forum</a></li></ul></li><!--More--><li class="dropdown eclipse-more hidden-xs"><a data-toggle="dropdown" class="dropdown-toggle" role="button">More <b class="caret"></b></a><ul class="dropdown-menu"><li><!--Content container to add padding--><div class="yamm-content"><div class="row"><ul class="col-sm-8 list-unstyled"><li><p><strong>Community</strong></p></li><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li><li><a href="https://blogs.eclipse.org">Blogs</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Participate</strong></p></li><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/org/research/">Research</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Eclipse IDE</strong></p></li><li><a href="https://www.eclipse.org/downloads">Download</a></li><li><a href="https://help.eclipse.org">Documentation</a></li><li><a href="https://www.eclipse.org/getting_started">Getting Started / Support</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li><li><a href="https://www.eclipse.org/ide/">IDE and Tools</a></li><li><a href="https://www.eclipse.org/forums/index.php/f/89/">Newcomer Forum</a></li></ul></div></div></li></ul></li></ul></div><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main-menu"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="wrapper-logo-mobile"><a class="navbar-brand visible-xs" href="https://www.eclipse.org/"><img class="logo-eclipse-default-mobile img-responsive" alt="logo" width="160" src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-foundation-white-orange.svg"></a></div></div></div></div></div></div></header><main id="main-wrapper"><div id="toc" class="toc2"><div id="toc-image"><a href="/jetty/index.html"><img src="../common/images/jetty-logo.svg" width="80%"></a></div><div id="toctitle">Development Guide</div><ul class="sectlevel1"><li><!--advanced-embedding--><a href="#advanced-embedding">Embedding</a><ul class="sectlevel2"><li><!--jetty-helloworld--><a href="#jetty-helloworld">Jetty Embedded HelloWorld</a></li><li><!--embedding-jetty--><a href="#embedding-jetty">Embedding Jetty</a></li><li><!--embedded-examples--><a href="#embedded-examples">Embedded Examples</a></li></ul></li><li><!--http-client--><a href="#http-client">HTTP Client</a><ul class="sectlevel2"><li><!--http-client-intro--><a href="#http-client-intro">Introduction</a></li><li><!--http-client-api--><a href="#http-client-api">API Usage</a></li><li><!--http-client-cookie--><a href="#http-client-cookie">Cookies Support</a></li><li><!--http-client-authentication--><a href="#http-client-authentication">Authentication Support</a></li><li><!--http-client-proxy--><a href="#http-client-proxy">Proxy Support</a></li><li><!--http-client-transport--><a href="#http-client-transport">Pluggable Transports</a></li></ul></li><li><!--maven-and-jetty--><a href="#maven-and-jetty">Maven and Jetty</a><ul class="sectlevel2"><li><!--jetty-maven-helloworld--><a href="#jetty-maven-helloworld">Using Maven</a></li><li><!--jetty-maven-plugin--><a href="#jetty-maven-plugin">Configuring the Jetty Maven Plugin</a></li><li><!--jetty-maven-scanning--><a href="#jetty-maven-scanning">Files Scanned by the Jetty Maven Plugin</a></li><li><!--jetty-jspc-maven-plugin--><a href="#jetty-jspc-maven-plugin">Jetty Jspc Maven Plugin</a></li></ul></li><li><!--ant-and-jetty--><a href="#ant-and-jetty">Ant and Jetty</a><ul class="sectlevel2"><li><!--jetty-ant--><a href="#jetty-ant">Ant Jetty Plugin</a></li></ul></li><li><!--jetty-handlers--><a href="#jetty-handlers">Handlers</a><ul class="sectlevel2"><li><!--writing-custom-handlers--><a href="#writing-custom-handlers">Writing Custom Handlers</a></li></ul></li><li><!--websocket-intro--><a href="#websocket-intro">WebSocket Introduction</a><ul class="sectlevel2"><li><!--ws-intro-provides--><a href="#ws-intro-provides">What Jetty provides</a></li><li><!--ws-intro-api--><a href="#ws-intro-api">WebSocket APIs</a></li><li><!----><a href="#">Enabling WebSocket</a></li></ul></li><li><!--websocket-jetty--><a href="#websocket-jetty">Jetty Websocket API</a><ul class="sectlevel2"><li><!--jetty-websocket-api--><a href="#jetty-websocket-api">Jetty WebSocket API Usage</a></li><li><!--jetty-websocket-api-events--><a href="#jetty-websocket-api-events">WebSocket Events</a></li><li><!--jetty-websocket-api-session--><a href="#jetty-websocket-api-session">WebSocket Session</a></li><li><!--jetty-websocket-api-send-message--><a href="#jetty-websocket-api-send-message">Send Messages to Remote Endpoint</a></li><li><!--jetty-websocket-api-annotations--><a href="#jetty-websocket-api-annotations">Using WebSocket Annotations</a></li><li><!--jetty-websocket-api-listener--><a href="#jetty-websocket-api-listener">Using WebSocketListener</a></li><li><!--jetty-websocket-api-adapter--><a href="#jetty-websocket-api-adapter">Using the WebSocketAdapter</a></li><li><!--jetty-websocket-server-api--><a href="#jetty-websocket-server-api">Jetty WebSocket Server API</a></li><li><!--jetty-websocket-client-api--><a href="#jetty-websocket-client-api">Jetty WebSocket Client API</a></li></ul></li><li><!--continuations--><a href="#continuations">Continuations</a><ul class="sectlevel2"><li><!--continuations-intro--><a href="#continuations-intro">Introduction</a></li><li><!--continuations-using--><a href="#continuations-using">Using Continuations</a></li><li><!--continuations-patterns--><a href="#continuations-patterns">Common Continuation Patterns</a></li></ul></li><li><!--frameworks--><a href="#frameworks">Frameworks</a><ul class="sectlevel2"><li><!--framework-jetty-spring--><a href="#framework-jetty-spring">Spring Setup</a></li><li><!--framework-jetty-osgi--><a href="#framework-jetty-osgi">OSGI</a></li><li><!--framework-weld--><a href="#framework-weld">Weld</a></li><li><!--framework-metro--><a href="#framework-metro">Metro</a></li></ul></li></ul></div><div id="content-container"><div id="header"><h1>Eclipse Jetty: Development Guide</h1><div class="details"><span class="author" id="author">Jetty Developers</span><br><span class="email" id="email"><a href="mailto:jetty-dev@eclipse.org">jetty-dev@eclipse.org</a></span><br><span id="revnumber">version 1.0,</span> <span id="revdate">2019-01-30 15:10</span></div></div><div id="content"><div class="sect2"><h3 id="advanced-embedding">Embedding</h3><div class="sect2"><h3 id="jetty-helloworld">Jetty Embedded HelloWorld</h3><div class="paragraph"><p>This section provides a tutorial that shows how you can quickly develop embedded code against the Jetty API.</p></div>
<div class="sect3"><h4 id="downloading-jars">Downloading the Jars</h4><div class="paragraph"><p>Jetty is decomposed into many jars and dependencies to achieve a minimal footprint by selecting the minimal set of jars.
Typically it is best to use something like <a href="#jetty-maven-helloworld">Maven</a> to manage jars, however this tutorial uses an aggregate Jar that contains all of the required Jetty classes in one Jar.
You can manually download the aggregate <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/aggregate/jetty-all/9.4.15-SNAPSHOT/jetty-all-9.4.15-SNAPSHOT-uber.jar"><code>jetty-all.jar</code></a> using <code>curl</code> or a browser.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">The central Maven repository has started to aggressively reject/deny access to the repository from the <code>wget</code> command line tool (due to abusive use of the tool by some groups).
The administrators of the central maven repository have stated that the recommended command line download tool is now curl.</td></tr></table></div></blockquote></div>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">The <code>jetty-all</code> jar referenced in this section is for example purposes only and should not be used outside of this context.
Please consider using <a href="#jetty-maven-helloworld">Maven</a> to manage your project dependencies.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>Use curl as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mkdir Demo
&gt; cd Demo
&gt; curl -o jetty-all-uber.jar https://repo1.maven.org/maven2/org/eclipse/jetty/aggregate/jetty-all/9.4.15-SNAPSHOT/jetty-all-9.4.15-SNAPSHOT-uber.jar</code></pre></div></div></div>
<div class="sect3"><h4 id="writing-helloworld-example">Writing a HelloWorld Example</h4><div class="paragraph"><p>The <a href="#embedding">Embedding Jetty</a> section contains many examples of writing against the Jetty API.
This tutorial uses a simple HelloWorld handler with a main method to run the server.
You can either <a href="https://github.com/eclipse/jetty.project/tree/master/examples/embedded/src/main/java/org/eclipse/jetty/embedded/HelloWorld.java">download</a> or create in an editor the file <code>HelloWorld.java</code> with the following content:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.AbstractHandler;

public class HelloWorld extends AbstractHandler
{
    @Override
    public void handle( String target,
                        Request baseRequest,
                        HttpServletRequest request,
                        HttpServletResponse response ) throws IOException,
                                                      ServletException
    {
        // Declare response encoding and types
        response.setContentType("text/html; charset=utf-8");

        // Declare response status code
        response.setStatus(HttpServletResponse.SC_OK);

        // Write back response
        response.getWriter().println("&lt;h1&gt;Hello World&lt;/h1&gt;");

        // Inform jetty that this request has now been handled
        baseRequest.setHandled(true);
    }

    public static void main( String[] args ) throws Exception
    {
        Server server = new Server(8080);
        server.setHandler(new HelloWorld());

        server.start();
        server.join();
    }
}</code></pre></div></div></div>
<div class="sect3"><h4 id="compiling-helloworld-example">Compiling the HelloWord example</h4><div class="paragraph"><p>The following command compiles the HelloWorld class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mkdir classes
&gt; javac -d classes -cp jetty-all-uber.jar HelloWorld.java</code></pre></div></div></div>
<div class="sect3"><h4 id="running-handler-and-server">Running the Handler and Server</h4><div class="paragraph"><p>The following command runs the HelloWorld example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; java -cp classes:jetty-all-uber.jar org.eclipse.jetty.embedded.HelloWorld</code></pre></div></div>
<div class="paragraph"><p>You can now point your browser at <a href="http://localhost:8080/">http://localhost:8080</a> to see your hello world page.</p></div></div>
<div class="sect3"><h4 id="next-steps">Next Steps</h4><div class="paragraph"><p>To learn more about Jetty, take these next steps:</p></div>
<div class="ulist"><ul><li><p>Follow the examples in <a href="#embedding-jetty">Embedding Jetty</a> to better understand the jetty APIs.</p></li><li><p>Explore the complete <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/">Jetty javadoc</a></p></li><li><p>Consider using <a href="#maven-and-jetty">Jetty and Maven</a> to manage your Jars and dependencies.</p></li></ul></div></div></div>
<div class="sect2"><h3 id="embedding-jetty">Embedding Jetty</h3><div class="paragraph"><p>Jetty has a slogan, "<em>Don&#8217;t deploy your application in Jetty, deploy Jetty in your application!</em>"
What this means is that as an alternative to bundling your application as a standard WAR to be deployed in Jetty, Jetty is designed to be a software component that can be instantiated and used in a Java program just like any POJO.
Put another way, running Jetty in embedded mode means putting an HTTP module into your application, rather than putting your application into an HTTP server.</p></div>
<div class="paragraph"><p>This tutorial takes you step-by-step from the simplest Jetty server instantiation to running multiple web applications with standards-based deployment descriptors.
The source for most of these examples is part of the standard Jetty project.</p></div>
<div class="sect3"><h4>Overview</h4><div class="paragraph"><p>To embed a Jetty server the following steps are typical and are illustrated by the examples in this tutorial:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Server.html">Server</a> instance.</p></li><li><p>Add/Configure <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Connector.html">Connectors</a>.</p></li><li><p>Add/Configure <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Handler.html">Handlers</a> and/or <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/ContextHandler.html">Contexts</a> and/or <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/Servlet.html">Servlets</a>.</p></li><li><p>Start the Server.</p></li><li><p>Wait on the server or do something else with your thread.</p></li></ol></div></div>
<div class="sect3"><h4>Creating the Server</h4><div class="paragraph"><p>The following code from SimplestServer.java instantiates and runs the simplest possible Jetty server:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;

/**
 * The simplest possible Jetty server.
 */
public class SimplestServer
{
    public static void main( String[] args ) throws Exception
    {
        Server server = new Server(8080);
        server.start();
        server.dumpStdErr();
        server.join();
    }
}</code></pre></div></div>
<div class="paragraph"><p>This runs an HTTP server on port 8080. It is not a very useful server as it has no handlers, and thus returns a 404 error for every request.</p></div></div>
<div class="sect3"><h4>Using Handlers</h4><div class="paragraph"><p>To produce a response to a request, Jetty requires that you set a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Handler.html">Handler</a> on the server.
A handler may:</p></div>
<div class="ulist"><ul><li><p>Examine/modify the HTTP request.</p></li><li><p>Generate the complete HTTP response.</p></li><li><p>Call another Handler (see <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerWrapper.html"><code>HandlerWrapper</code></a>).</p></li><li><p>Select one or many Handlers to call (see <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerCollection.html"><code>HandlerCollection</code></a>).</p></li></ul></div>
<div class="sect4"><h5>HelloWorld Handler</h5><div class="paragraph"><p>The following code based on HelloHandler.java shows a simple hello world handler:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;

public class HelloHandler extends AbstractHandler
{
    final String greeting;
    final String body;

    public HelloHandler()
    {
        this("Hello World");
    }

    public HelloHandler( String greeting )
    {
        this(greeting, null);
    }

    public HelloHandler( String greeting, String body )
    {
        this.greeting = greeting;
        this.body = body;
    }

    @Override
    public void handle( String target,
                        Request baseRequest,
                        HttpServletRequest request,
                        HttpServletResponse response ) throws IOException,
                                                      ServletException
    {
        response.setContentType("text/html; charset=utf-8");
        response.setStatus(HttpServletResponse.SC_OK);

        PrintWriter out = response.getWriter();

        out.println("&lt;h1&gt;" + greeting + "&lt;/h1&gt;");
        if (body != null)
        {
            out.println(body);
        }

        baseRequest.setHandled(true);
    }
}</code></pre></div></div>
<div class="paragraph"><p>The parameters passed to the handle method are:</p></div>
<div class="ulist"><ul><li><p><code>target</code> – the target of the request, which is either a URI or a name from a named dispatcher.</p></li><li><p><code>baseRequest</code> – the Jetty mutable request object, which is always unwrapped.</p></li><li><p><code>request</code> – the immutable request object, which may have been wrapped by a filter or servlet.</p></li><li><p><code>response</code> – the response, which may have been wrapped by a filter or servlet.</p></li></ul></div>
<div class="paragraph"><p>The handler sets the response status, content-type, and marks the request as handled before it generates the body of the response using a writer.</p></div></div>
<div class="sect4"><h5>Running HelloWorldHandler</h5><div class="paragraph"><p>To allow a Handler to handle HTTP requests, you must add it to a Server instance.
The following code from OneHandler.java shows how a Jetty server can use the HelloWorld handler:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;

public class OneHandler
{
    public static void main( String[] args ) throws Exception
    {
        Server server = new Server(8080);
        server.setHandler(new HelloHandler());

        server.start();
        server.join();
    }
}</code></pre></div></div>
<div class="paragraph"><p>One or more handlers do all request handling in Jetty.
Some handlers select other specific handlers (for example, a <code>ContextHandlerCollection</code> uses the context path to select a <code>ContextHandler</code>); others use application logic to generate a response (for example, the <code>ServletHandler</code> passes the request to an application Servlet), while others do tasks unrelated to generating the response (for example, <code>RequestLogHandler</code> or <code>StatisticsHandler</code>).</p></div>
<div class="paragraph"><p>Later sections describe how you can combine handlers like aspects.
You can see some of the handlers available in Jetty in the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/package-summary.html">org.eclipse.jetty.server.handler</a> package.</p></div></div>
<div class="sect4"><h5>Handler Collections and Wrappers</h5><div class="paragraph"><p>Complex request handling is typically built from multiple Handlers that you can combine in various ways.
Jetty has several implementations of the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/HandlerContainer.html"><code>HandlerContainer</code></a> interface:</p></div>
<div class="dlist"><dl><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerCollection.html"><code>HandlerCollection</code></a></dt><dd><p>Holds a collection of other handlers and calls each handler in order.
This is useful for combining statistics and logging handlers with the handler that generates the response.</p></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerList.html"><code>HandlerList</code></a></dt><dd><p>A Handler Collection that calls each handler in turn until either an exception is thrown, the response is committed or the <code>request.isHandled()</code> returns true.
You can use it to combine handlers that conditionally handle a request, such as calling multiple contexts until one matches a virtual host.</p></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerWrapper.html"><code>HandlerWrapper</code></a></dt><dd><p>A Handler base class that you can use to daisy chain handlers together in the style of aspect-oriented programming.
For example, a standard web application is implemented by a chain of a context, session, security and servlet handlers.</p></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/ContextHandlerCollection.html"><code>ContextHandlerCollection</code></a></dt><dd><p>A specialized <code>HandlerCollection</code> that uses the longest prefix of the request URI (the <code>contextPath</code>) to select a contained <code>ContextHandler</code> to handle the request.</p></dd></dl></div></div>
<div class="sect4"><h5>Scoped Handlers</h5><div class="paragraph"><p>Much of the standard Servlet container in Jetty is implemented with <code>HandlerWrappers</code> that daisy chain handlers together: <code>ContextHandler</code> to <code>SessionHandler</code> to <code>SecurityHandler</code> to <code>ServletHandler</code>.
However, because of the nature of the servlet specification, this chaining cannot be a pure nesting of handlers as the outer handlers sometimes need information that the inner handlers process.
For example, when a <code>ContextHandler</code> calls some application listeners to inform them of a request entering the context, it must already know which servlet the <code>ServletHandler</code> will dispatch the request to so that the <code>servletPath</code> method returns the correct value.</p></div>
<div class="paragraph"><p>The <code>HandlerWrapper</code> is specialized to the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/ScopedHandler.html"><code>ScopedHandler</code></a> abstract class, which supports a daisy chain of scopes.
For example if a <code>ServletHandler</code> is nested within a <code>ContextHandler</code>, the order and nesting of execution of methods is:</p></div>
<div class="literalblock"><div class="content"><pre>Server.handle(...)
  ContextHandler.doScope(...)
    ServletHandler.doScope(...)
      ContextHandler.doHandle(...)
        ServletHandler.doHandle(...)
          SomeServlet.service(...)</pre></div></div>
<div class="paragraph"><p>Thus when the <code>ContextHandler</code> handles the request, it does so within the scope the <code>ServletHandler</code> has established.</p></div></div>
<div class="sect4"><h5>Resource Handler</h5><div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/FileServer.html">FileServer example</a> shows how you can use a <code>ResourceHandler</code> to serve static content from the current working directory:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.DefaultHandler;
import org.eclipse.jetty.server.handler.HandlerList;
import org.eclipse.jetty.server.handler.ResourceHandler;

/**
 * Simple Jetty FileServer.
 * This is a simple example of Jetty configured as a FileServer.
 */
public class FileServer
{
    public static void main(String[] args) throws Exception
    {
        // Create a basic Jetty server object that will listen on port 8080.  Note that if you set this to port 0
        // then a randomly available port will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Create the ResourceHandler. It is the object that will actually handle the request for a given file. It is
        // a Jetty Handler object so it is suitable for chaining with other handlers as you will see in other examples.
        ResourceHandler resource_handler = new ResourceHandler();

        // Configure the ResourceHandler. Setting the resource base indicates where the files should be served out of.
        // In this example it is the current directory but it can be configured to anything that the jvm has access to.
        resource_handler.setDirectoriesListed(true);
        resource_handler.setWelcomeFiles(new String[]{ "index.html" });
        resource_handler.setResourceBase(".");

        // Add the ResourceHandler to the server.
        HandlerList handlers = new HandlerList();
        handlers.setHandlers(new Handler[] { resource_handler, new DefaultHandler() });
        server.setHandler(handlers);

        // Start things up! By using the server.join() the server thread will join with the current thread.
        // See "http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#join()" for more details.
        server.start();
        server.join();
    }
}</code></pre></div></div>
<div class="paragraph"><p>Notice that a <code>HandlerList</code> is used with the <code>ResourceHandler</code> and a <code>DefaultHandler</code>, so that the <code>DefaultHandler</code> generates a good 404 response for any requests that do not match a static resource.</p></div></div></div>
<div class="sect3"><h4>Embedding Connectors</h4><div class="paragraph"><p>In the previous examples, the Server instance is passed a port number and it internally creates a default instance of a Connector that listens for requests on that port.
However, often when embedding Jetty it is desirable to explicitly instantiate and configure one or more Connectors for a Server instance.</p></div>
<div class="sect4"><h5>One Connector</h5><div class="paragraph"><p>The following example, <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneConnector.html">OneConnector.java</a>,
instantiates, configures, and adds a single HTTP connector instance to the server:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;

/**
 * A Jetty server with one connectors.
 */
public class OneConnector
{
    public static void main( String[] args ) throws Exception
    {
        // The Server
        Server server = new Server();

        // HTTP connector
        ServerConnector http = new ServerConnector(server);
        http.setHost("localhost");
        http.setPort(8080);
        http.setIdleTimeout(30000);

        // Set the connector
        server.addConnector(http);

        // Set a handler
        server.setHandler(new HelloHandler());

        // Start the server
        server.start();
        server.join();
    }
}</code></pre></div></div>
<div class="paragraph"><p>In this example the connector handles the HTTP protocol, as that is the default for the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/ServerConnector.html"><code>ServerConnector</code></a> class.</p></div></div>
<div class="sect4"><h5>Many Connectors</h5><div class="paragraph"><p>When configuring multiple connectors (for example, HTTP and HTTPS), it may be desirable to share configuration of common parameters for HTTP.
To achieve this you need to explicitly configure the <code>ServerConnector</code> class with <code>ConnectionFactory</code> instances, and provide them with common HTTP configuration.</p></div>
<div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/ManyConnectors.html">ManyConnectors example</a>, configures a server with two <code>ServerConnector</code> instances: the http connector has a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/HttpConnectionFactory.html"><code>HTTPConnectionFactory</code></a> instance; the https connector has a <code>SslConnectionFactory</code> chained to a <code>HttpConnectionFactory</code>.
Both <code>HttpConnectionFactory</code> are configured based on the same <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/HttpConfiguration.html"><code>HttpConfiguration</code></a> instance, however the HTTPS factory uses a wrapped configuration so that a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/SecureRequestCustomizer.html"><code>SecureRequestCustomizer</code></a> can be added.</p></div></div></div>
<div class="sect3"><h4>Embedding Servlets</h4><div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Java_Servlet">Servlets</a> are the standard way to provide application logic that handles HTTP requests.
Servlets are similar to a Jetty Handler except that the request object is not mutable and thus cannot be modified.
Servlets are handled in Jetty by a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/MinimalServlets.html"><code>ServletHandler</code></a>.
It uses standard path mappings to match a Servlet to a request; sets the requests <code>servletPath</code> and <code>pathInfo</code>; passes the request to the servlet, possibly via Filters to produce a response.</p></div>
<div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/MinimalServlets.html">MinimalServlets example</a> creates a <code>ServletHandler</code> instance and configures a single HelloServlet:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.ServletHandler;

public class MinimalServlets
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // The ServletHandler is a dead simple way to create a context handler
        // that is backed by an instance of a Servlet.
        // This handler then needs to be registered with the Server object.
        ServletHandler handler = new ServletHandler();
        server.setHandler(handler);

        // Passing in the class for the Servlet allows jetty to instantiate an
        // instance of that Servlet and mount it on a given context path.

        // IMPORTANT:
        // This is a raw Servlet, not a Servlet that has been configured
        // through a web.xml @WebServlet annotation, or anything similar.
        handler.addServletWithMapping(HelloServlet.class, "/*");

        // Start things up!
        server.start();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See
        // http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }

    @SuppressWarnings("serial")
    public static class HelloServlet extends HttpServlet
    {
        @Override
        protected void doGet( HttpServletRequest request,
                              HttpServletResponse response ) throws ServletException,
                                                            IOException
        {
            response.setContentType("text/html");
            response.setStatus(HttpServletResponse.SC_OK);
            response.getWriter().println("&lt;h1&gt;Hello from HelloServlet&lt;/h1&gt;");
        }
    }
}</code></pre></div></div></div>
<div class="sect3"><h4>Embedding Contexts</h4><div class="paragraph"><p>A <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneContext.html"><code>ContextHandler</code></a> is a <code>ScopedHandler</code> that responds only to requests that have a URI prefix that matches the configured context path.
Requests that match the context path have their path methods updated accordingly and the contexts scope is available, which optionally may include:</p></div>
<div class="ulist"><ul><li><p>A <code>Classloader</code> that is set as the Thread context <code>classloader</code> while request handling is in scope.</p></li><li><p>A set of attributes that is available via the <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html"><code>ServletContext</code></a> API.</p></li><li><p>A set of init parameters that is available via the <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html"><code>ServletContext</code></a> API.</p></li><li><p>A base Resource which is used as the document root for static resource requests via the <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html"><code>ServletContext</code></a> API.</p></li><li><p>A set of virtual host names.</p></li></ul></div>
<div class="paragraph"><p>The following <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneContext.html">OneContext example</a> shows a context being established that wraps the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/HelloHandler.html">HelloHandler</a>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.ContextHandler;

public class OneContext
{
    public static void main( String[] args ) throws Exception
    {
        Server server = new Server( 8080 );

        // Add a single handler on context "/hello"
        ContextHandler context = new ContextHandler();
        context.setContextPath( "/hello" );
        context.setHandler( new HelloHandler() );

        // Can be accessed using http://localhost:8080/hello

        server.setHandler( context );

        // Start the server
        server.start();
        server.join();
    }
}</code></pre></div></div>
<div class="paragraph"><p>When many contexts are present, you can embed a <code>ContextHandlerCollection</code> to efficiently examine a request URI to then select the matching <code>ContextHandler</code>(s) for the request.
The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/ManyContexts.html">ManyContexts example</a> shows how many such contexts you can configure:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.ContextHandler;
import org.eclipse.jetty.server.handler.ContextHandlerCollection;

public class ManyContexts
{
    public static void main( String[] args ) throws Exception
    {
        Server server = new Server(8080);

        ContextHandler context = new ContextHandler("/");
        context.setContextPath("/");
        context.setHandler(new HelloHandler("Root Hello"));

        ContextHandler contextFR = new ContextHandler("/fr");
        contextFR.setHandler(new HelloHandler("Bonjoir"));

        ContextHandler contextIT = new ContextHandler("/it");
        contextIT.setHandler(new HelloHandler("Bongiorno"));

        ContextHandler contextV = new ContextHandler("/");
        contextV.setVirtualHosts(new String[] { "127.0.0.2" });
        contextV.setHandler(new HelloHandler("Virtual Hello"));

        ContextHandlerCollection contexts = new ContextHandlerCollection();
        contexts.setHandlers(new Handler[] { context, contextFR, contextIT,
                contextV });

        server.setHandler(contexts);

        server.start();
        server.dumpStdErr();
        server.join();
    }
}</code></pre></div></div></div>
<div class="sect3"><h4>Embedding ServletContexts</h4><div class="paragraph"><p>A <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/servlet/ServletContextHandler.html"><code>ServletContextHandler</code></a> is a specialization of <code>ContextHandler</code> with support for standard sessions and Servlets.
The following <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneServletContext.html">OneServletContext example</a> instantiates a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/servlet/DefaultServlet.html"><code>DefaultServlet</code></a> to server static content from /tmp/ and a <code>DumpServlet</code> that creates a session and dumps basic details about the request:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.DefaultServlet;
import org.eclipse.jetty.servlet.ListenerHolder;
import org.eclipse.jetty.servlet.ServletContextHandler;

import javax.servlet.DispatcherType;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletRequestEvent;
import javax.servlet.ServletRequestListener;
import javax.servlet.ServletResponse;
import java.io.IOException;
import java.util.EnumSet;

public class OneServletContext
{
    public static void main( String[] args ) throws Exception
    {
        Server server = new Server(8080);

        ServletContextHandler context = new ServletContextHandler(
                ServletContextHandler.SESSIONS);
        context.setContextPath("/");
        context.setResourceBase(System.getProperty("java.io.tmpdir"));
        server.setHandler(context);

        // Add dump servlet
        context.addServlet(
            context.addServlet(DumpServlet.class, "/dump/*"),
            "*.dump");
        context.addServlet(HelloServlet.class, "/hello/*");
        context.addServlet(DefaultServlet.class, "/");

        context.addFilter(TestFilter.class,"/*", EnumSet.of(DispatcherType.REQUEST));
        context.addFilter(TestFilter.class,"/test", EnumSet.of(DispatcherType.REQUEST,DispatcherType.ASYNC));
        context.addFilter(TestFilter.class,"*.test", EnumSet.of(DispatcherType.REQUEST,DispatcherType.INCLUDE,DispatcherType.FORWARD));

        context.getServletHandler().addListener(new ListenerHolder(InitListener.class));
        context.getServletHandler().addListener(new ListenerHolder(RequestListener.class));

        server.start();
        server.dumpStdErr();
        server.join();
    }


    public static class TestFilter implements Filter
    {
        @Override
        public void init(FilterConfig filterConfig) throws ServletException
        {

        }

        @Override
        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException
        {
            chain.doFilter(request, response);
        }

        @Override
        public void destroy()
        {

        }
    }

    public static class InitListener implements ServletContextListener
    {
        @Override
        public void contextInitialized(ServletContextEvent sce)
        {
        }

        @Override
        public void contextDestroyed(ServletContextEvent sce)
        {
        }
    }


    public static class RequestListener implements ServletRequestListener
    {
        @Override
        public void requestDestroyed(ServletRequestEvent sre)
        {

        }

        @Override
        public void requestInitialized(ServletRequestEvent sre)
        {

        }
    }
}</code></pre></div></div></div>
<div class="sect3"><h4>Embedding Web Applications</h4><div class="paragraph"><p>A <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html"><code>WebAppContext</code></a> is an extension of a <code>ServletContextHandler</code> that uses the <a href="http://en.wikipedia.org/wiki/WAR_%28Sun_file_format%29">standard layout</a> and web.xml to configure the servlets, filters and other features from a web.xml and/or annotations.
The following <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneWebApp.html">OneWebApp example</a> configures the Jetty test webapp.
Web applications can use resources the container provides, and in this case a <code>LoginService</code> is needed and also configured:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.AllowSymLinkAliasChecker;
import org.eclipse.jetty.webapp.WebAppContext;

public class OneWebApp
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Setup JMX
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer());
        server.addBean(mbContainer);

        // The WebAppContext is the entity that controls the environment in
        // which a web application lives and breathes. In this example the
        // context path is being set to "/" so it is suitable for serving root
        // context requests and then we see it setting the location of the war.
        // A whole host of other configurations are available, ranging from
        // configuring to support annotation scanning in the webapp (through
        // PlusConfiguration) to choosing where the webapp will unpack itself.
        WebAppContext webapp = new WebAppContext();
        webapp.setContextPath("/");
        File warFile = new File(
                "../../tests/test-jmx/jmx-webapp/target/jmx-webapp");
        webapp.setWar(warFile.getAbsolutePath());

        // A WebAppContext is a ContextHandler as well so it needs to be set to
        // the server so it is aware of where to send the appropriate requests.
        server.setHandler(webapp);

        // Start things up!
        server.start();

        server.dumpStdErr();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }
}</code></pre></div></div></div>
<div class="sect3"><h4>Like Jetty XML</h4><div class="paragraph"><p>The typical way to configure an instance of the Jetty server is via <code>jetty.xml</code> and associated configuration files.
However the Jetty XML configuration format is just a simple rendering of what you can do in code; it is very simple to write embedded code that does precisely what the jetty.xml configuration does.
The <a href="https://github.com/eclipse/jetty.project/tree/master/examples/embedded/src/main/java/org/eclipse/jetty/embedded/LikeJettyXml.java">LikeJettyXml example</a> following renders in code the behavior obtained from the configuration files:</p></div>
<div class="ulist"><ul><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty.xml">jetty.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-jmx/src/main/config/etc/jetty-jmx.xml">jetty-jmx.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty-http.xml">jetty-http.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty-https.xml">jetty-https.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-deploy/src/main/config/etc/jetty-deploy.xml">jetty-deploy.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty-stats.xml">jetty-stats.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty-requestlog.xml">jetty-requestlog.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty-lowresources.xml">jetty-lowresources.xml</a></p></li><li><p><a href="https://github.com/eclipse/jetty.project/tree/master/tests/test-webapps/test-jetty-webapp/src/main/config/etc/test-realm.xml">test-realm.xml</a></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.io.FileNotFoundException;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.deploy.DeploymentManager;
import org.eclipse.jetty.deploy.PropertiesConfigurationManager;
import org.eclipse.jetty.deploy.bindings.DebugListenerBinding;
import org.eclipse.jetty.deploy.providers.WebAppProvider;
import org.eclipse.jetty.http.HttpVersion;
import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.rewrite.handler.RewriteHandler;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.server.DebugListener;
import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.HttpConfiguration;
import org.eclipse.jetty.server.HttpConnectionFactory;
import org.eclipse.jetty.server.LowResourceMonitor;
import org.eclipse.jetty.server.NCSARequestLog;
import org.eclipse.jetty.server.SecureRequestCustomizer;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnectionStatistics;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.SslConnectionFactory;
import org.eclipse.jetty.server.handler.ContextHandlerCollection;
import org.eclipse.jetty.server.handler.DefaultHandler;
import org.eclipse.jetty.server.handler.HandlerCollection;
import org.eclipse.jetty.server.handler.StatisticsHandler;
import org.eclipse.jetty.util.ssl.SslContextFactory;
import org.eclipse.jetty.util.thread.QueuedThreadPool;
import org.eclipse.jetty.util.thread.ScheduledExecutorScheduler;
import org.eclipse.jetty.webapp.Configuration;

/**
 * Starts the Jetty Distribution's demo-base directory using entirely
 * embedded jetty techniques.
 */
public class LikeJettyXml
{
    public static void main( String[] args ) throws Exception
    {
        // Path to as-built jetty-distribution directory
        String jettyHomeBuild = "jetty-distribution/target/distribution";

        // Find jetty home and base directories
        String homePath = System.getProperty("jetty.home", jettyHomeBuild);
        File start_jar = new File(homePath,"start.jar");
        if (!start_jar.exists())
        {
            homePath = jettyHomeBuild = "jetty-distribution/target/distribution";
            start_jar = new File(homePath,"start.jar");
            if (!start_jar.exists())
                throw new FileNotFoundException(start_jar.toString());
        }

        File homeDir = new File(homePath);

        String basePath = System.getProperty("jetty.base", homeDir + "/demo-base");
        File baseDir = new File(basePath);
        if(!baseDir.exists())
        {
            throw new FileNotFoundException(baseDir.getAbsolutePath());
        }

        // Configure jetty.home and jetty.base system properties
        String jetty_home = homeDir.getAbsolutePath();
        String jetty_base = baseDir.getAbsolutePath();
        System.setProperty("jetty.home", jetty_home);
        System.setProperty("jetty.base", jetty_base);


        // === jetty.xml ===
        // Setup Threadpool
        QueuedThreadPool threadPool = new QueuedThreadPool();
        threadPool.setMaxThreads(500);

        // Server
        Server server = new Server(threadPool);

        // Scheduler
        server.addBean(new ScheduledExecutorScheduler());

        // HTTP Configuration
        HttpConfiguration http_config = new HttpConfiguration();
        http_config.setSecureScheme("https");
        http_config.setSecurePort(8443);
        http_config.setOutputBufferSize(32768);
        http_config.setRequestHeaderSize(8192);
        http_config.setResponseHeaderSize(8192);
        http_config.setSendServerVersion(true);
        http_config.setSendDateHeader(false);
        // httpConfig.addCustomizer(new ForwardedRequestCustomizer());

        // Handler Structure
        HandlerCollection handlers = new HandlerCollection();
        ContextHandlerCollection contexts = new ContextHandlerCollection();
        handlers.setHandlers(new Handler[] { contexts, new DefaultHandler() });
        server.setHandler(handlers);

        // Extra options
        server.setDumpAfterStart(false);
        server.setDumpBeforeStop(false);
        server.setStopAtShutdown(true);

        // === jetty-jmx.xml ===
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer());
        server.addBean(mbContainer);


        // === jetty-http.xml ===
        ServerConnector http = new ServerConnector(server,
                new HttpConnectionFactory(http_config));
        http.setPort(8080);
        http.setIdleTimeout(30000);
        server.addConnector(http);


        // === jetty-https.xml ===
        // SSL Context Factory
        SslContextFactory sslContextFactory = new SslContextFactory();
        sslContextFactory.setKeyStorePath(jetty_home + "/../../../jetty-server/src/test/config/etc/keystore");
        sslContextFactory.setKeyStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
        sslContextFactory.setKeyManagerPassword("OBF:1u2u1wml1z7s1z7a1wnl1u2g");
        sslContextFactory.setTrustStorePath(jetty_home + "/../../../jetty-server/src/test/config/etc/keystore");
        sslContextFactory.setTrustStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
        sslContextFactory.setExcludeCipherSuites("SSL_RSA_WITH_DES_CBC_SHA",
                "SSL_DHE_RSA_WITH_DES_CBC_SHA", "SSL_DHE_DSS_WITH_DES_CBC_SHA",
                "SSL_RSA_EXPORT_WITH_RC4_40_MD5",
                "SSL_RSA_EXPORT_WITH_DES40_CBC_SHA",
                "SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA",
                "SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA");

        // SSL HTTP Configuration
        HttpConfiguration https_config = new HttpConfiguration(http_config);
        https_config.addCustomizer(new SecureRequestCustomizer());

        // SSL Connector
        ServerConnector sslConnector = new ServerConnector(server,
            new SslConnectionFactory(sslContextFactory,HttpVersion.HTTP_1_1.asString()),
            new HttpConnectionFactory(https_config));
        sslConnector.setPort(8443);
        server.addConnector(sslConnector);


        // === jetty-deploy.xml ===
        DeploymentManager deployer = new DeploymentManager();
        DebugListener debug = new DebugListener(System.err,true,true,true);
        server.addBean(debug);
        deployer.addLifeCycleBinding(new DebugListenerBinding(debug));
        deployer.setContexts(contexts);
        deployer.setContextAttribute(
                "org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern",
                ".*/[^/]*servlet-api-[^/]*\\.jar$|.*/javax.servlet.jsp.jstl-.*\\.jar$|.*/[^/]*taglibs.*\\.jar$");

        WebAppProvider webapp_provider = new WebAppProvider();
        webapp_provider.setMonitoredDirName(jetty_base + "/webapps");
        webapp_provider.setDefaultsDescriptor(jetty_home + "/etc/webdefault.xml");
        webapp_provider.setScanInterval(1);
        webapp_provider.setExtractWars(true);
        webapp_provider.setConfigurationManager(new PropertiesConfigurationManager());

        deployer.addAppProvider(webapp_provider);
        server.addBean(deployer);

        // === setup jetty plus ==
        Configuration.ClassList classlist = Configuration.ClassList
                .setServerDefault( server );
        classlist.addAfter(
                "org.eclipse.jetty.webapp.FragmentConfiguration",
                "org.eclipse.jetty.plus.webapp.EnvConfiguration",
                "org.eclipse.jetty.plus.webapp.PlusConfiguration");

        classlist.addBefore("org.eclipse.jetty.webapp.JettyWebXmlConfiguration",
                            "org.eclipse.jetty.annotations.AnnotationConfiguration");

        // === jetty-stats.xml ===
        StatisticsHandler stats = new StatisticsHandler();
        stats.setHandler(server.getHandler());
        server.setHandler(stats);
        ServerConnectionStatistics.addToAllConnectors(server);

        // === Rewrite Handler
        RewriteHandler rewrite = new RewriteHandler();
        rewrite.setHandler(server.getHandler());
        server.setHandler(rewrite);

        // === jetty-requestlog.xml ===
        NCSARequestLog requestLog = new NCSARequestLog();
        requestLog.setFilename(jetty_home + "/logs/yyyy_mm_dd.request.log");
        requestLog.setFilenameDateFormat("yyyy_MM_dd");
        requestLog.setRetainDays(90);
        requestLog.setAppend(true);
        requestLog.setExtended(true);
        requestLog.setLogCookies(false);
        requestLog.setLogTimeZone("GMT");
        server.setRequestLog(requestLog);


        // === jetty-lowresources.xml ===
        LowResourceMonitor lowResourcesMonitor=new LowResourceMonitor(server);
        lowResourcesMonitor.setPeriod(1000);
        lowResourcesMonitor.setLowResourcesIdleTimeout(200);
        lowResourcesMonitor.setMonitorThreads(true);
        lowResourcesMonitor.setMaxConnections(0);
        lowResourcesMonitor.setMaxMemory(0);
        lowResourcesMonitor.setMaxLowResourcesTime(5000);
        server.addBean(lowResourcesMonitor);


        // === test-realm.xml ===
        HashLoginService login = new HashLoginService();
        login.setName("Test Realm");
        login.setConfig(jetty_base + "/etc/realm.properties");
        login.setHotReload(false);
        server.addBean(login);

        // Start the server
        server.start();
        server.join();
    }
}</code></pre></div></div></div></div>
<div class="sect2"><h3 id="embedded-examples">Embedded Examples</h3><div class="paragraph"><p>Jetty has a rich history of being embedded into a wide variety of applications.
In this section we will walk you through a number of our simple examples under our embedded-jetty-examples project in our git repository.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">These files are pulled directly from our git repository when this document is generated.
If the line numbers do not line up feel free to fix this documentation in github and give us a pull request, or at least open an issue to notify us of the discrepancy.</td></tr></table></div></blockquote></div>
<div class="sect3"><h4 id="embedded-file-server">Simple File Server</h4><div class="paragraph"><p>This example shows how to create a simple file server in Jetty.
It is perfectly suitable for test cases where you need an actual web server to obtain a file from, it could easily be configured to serve files from a directory under <code>src/test/resources</code>.
Note that this does not have any logic for caching of files, either within the server or setting the appropriate headers on the response.
It is simply a few lines that illustrate how easy it is to serve out some files.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.DefaultHandler;
import org.eclipse.jetty.server.handler.HandlerList;
import org.eclipse.jetty.server.handler.ResourceHandler;

/**
 * Simple Jetty FileServer.
 * This is a simple example of Jetty configured as a FileServer.
 */
public class FileServer
{
    public static void main(String[] args) throws Exception
    {
        // Create a basic Jetty server object that will listen on port 8080.  Note that if you set this to port 0
        // then a randomly available port will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Create the ResourceHandler. It is the object that will actually handle the request for a given file. It is
        // a Jetty Handler object so it is suitable for chaining with other handlers as you will see in other examples.
        ResourceHandler resource_handler = new ResourceHandler();

        // Configure the ResourceHandler. Setting the resource base indicates where the files should be served out of.
        // In this example it is the current directory but it can be configured to anything that the jvm has access to.
        resource_handler.setDirectoriesListed(true);
        resource_handler.setWelcomeFiles(new String[]{ "index.html" });
        resource_handler.setResourceBase(".");

        // Add the ResourceHandler to the server.
        HandlerList handlers = new HandlerList();
        handlers.setHandlers(new Handler[] { resource_handler, new DefaultHandler() });
        server.setHandler(handlers);

        // Start things up! By using the server.join() the server thread will join with the current thread.
        // See "http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#join()" for more details.
        server.start();
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Run it!</h5><div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8080/index.html">http://localhost:8080/index.html</a> (assuming one is in the resource base directory) and you are good to go.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project you will need the following Maven dependencies declared.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-server&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-split-file-server">Split File Server</h4><div class="paragraph"><p>This example builds on the <a href="#emebedded-file-server">Simple File Server</a> to show how chaining multiple <code>ResourceHandlers</code> together can let you aggregate multiple directories to serve content on a single path and how you can link these together with <code>ContextHandlers</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;

import org.eclipse.jetty.server.Connector;
import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.handler.ContextHandler;
import org.eclipse.jetty.server.handler.ContextHandlerCollection;
import org.eclipse.jetty.server.handler.ResourceHandler;
import org.eclipse.jetty.toolchain.test.MavenTestingUtils;
import org.eclipse.jetty.util.resource.Resource;

/**
 * A {@link ContextHandlerCollection} handler may be used to direct a request to
 * a specific Context. The URI path prefix and optional virtual host is used to
 * select the context.
 */
public class SplitFileServer
{
    public static void main( String[] args ) throws Exception
    {
        // Create the Server object and a corresponding ServerConnector and then
        // set the port for the connector. In this example the server will
        // listen on port 8090. If you set this to port 0 then when the server
        // has been started you can called connector.getLocalPort() to
        // programmatically get the port the server started on.
        Server server = new Server();
        ServerConnector connector = new ServerConnector(server);
        connector.setPort(8090);
        server.setConnectors(new Connector[] { connector });

        // Create a Context Handler and ResourceHandler. The ContextHandler is
        // getting set to "/" path but this could be anything you like for
        // builing out your url. Note how we are setting the ResourceBase using
        // our jetty maven testing utilities to get the proper resource
        // directory, you needn't use these, you simply need to supply the paths
        // you are looking to serve content from.
        ResourceHandler rh0 = new ResourceHandler();

        ContextHandler context0 = new ContextHandler();
        context0.setContextPath("/");
        File dir0 = MavenTestingUtils.getTestResourceDir("dir0");
        context0.setBaseResource(Resource.newResource(dir0));
        context0.setHandler(rh0);

        // Rinse and repeat the previous item, only specifying a different
        // resource base.
        ResourceHandler rh1 = new ResourceHandler();

        ContextHandler context1 = new ContextHandler();
        context1.setContextPath("/");
        File dir1 = MavenTestingUtils.getTestResourceDir("dir1");
        context1.setBaseResource(Resource.newResource(dir1));
        context1.setHandler(rh1);

        // Create a ContextHandlerCollection and set the context handlers to it.
        // This will let jetty process urls against the declared contexts in
        // order to match up content.
        ContextHandlerCollection contexts = new ContextHandlerCollection();
        contexts.setHandlers(new Handler[] { context0, context1 });

        server.setHandler(contexts);

        // Start things up!
        server.start();

        // Dump the server state
        System.out.println(server.dump());

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Run it!</h5><div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8090/index.html">http://localhost:8090/index.html</a> (assuming one is in the resource base directory) and you are good to go.
Any requests for files will be looked for in the first resource handler, then the second, and so on and so forth.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example as is in your project you will need the following maven dependencies declared.
We would recommend not using the toolchain dependency in your actual application.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-server&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty.toolchain&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-test-helper&lt;/artifactId&gt;
  &lt;version&gt;2.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-many-connectors">Multiple Connectors</h4><div class="paragraph"><p>This example shows how to configure Jetty to use multiple connectors, specifically so it can process both http and https requests.
Since the meat of this example is the server and connector configuration it only uses a simple HelloHandler but this example should be easily merged with other examples like those deploying servlets or webapps.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.io.FileNotFoundException;
import java.security.Security;

import org.conscrypt.OpenSSLProvider;
import org.eclipse.jetty.http.HttpVersion;
import org.eclipse.jetty.server.Connector;
import org.eclipse.jetty.server.HttpConfiguration;
import org.eclipse.jetty.server.HttpConnectionFactory;
import org.eclipse.jetty.server.SecureRequestCustomizer;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.SslConnectionFactory;
import org.eclipse.jetty.util.ssl.SslContextFactory;

/**
 * A Jetty server with multiple connectors.
 */
public class ManyConnectors
{
    public static void main( String[] args ) throws Exception
    {
        // Since this example shows off SSL configuration, we need a keystore
        // with the appropriate key. These lookup of jetty.home is purely a hack
        // to get access to a keystore that we use in many unit tests and should
        // probably be a direct path to your own keystore.

        String jettyDistKeystore = "../../jetty-distribution/target/distribution/demo-base/etc/keystore";
        String keystorePath = System.getProperty("example.keystore", jettyDistKeystore);
        File keystoreFile = new File(keystorePath);
        if (!keystoreFile.exists())
        {
            keystorePath = "jetty-distribution/target/distribution/demo-base/etc/keystore";
            keystoreFile = new File(keystorePath);
            if (!keystoreFile.exists())
                throw new FileNotFoundException(keystoreFile.getAbsolutePath());
        }

        // Create a basic jetty server object without declaring the port. Since
        // we are configuring connectors directly we'll be setting ports on
        // those connectors.
        Server server = new Server();

        // HTTP Configuration
        // HttpConfiguration is a collection of configuration information
        // appropriate for http and https. The default scheme for http is
        // &lt;code&gt;http&lt;/code&gt; of course, as the default for secured http is
        // &lt;code&gt;https&lt;/code&gt; but we show setting the scheme to show it can be
        // done. The port for secured communication is also set here.
        HttpConfiguration http_config = new HttpConfiguration();
        http_config.setSecureScheme("https");
        http_config.setSecurePort(8443);
        http_config.setOutputBufferSize(32768);

        // HTTP connector
        // The first server connector we create is the one for http, passing in
        // the http configuration we configured above so it can get things like
        // the output buffer size, etc. We also set the port (8080) and
        // configure an idle timeout.
        ServerConnector http = new ServerConnector(server,
                new HttpConnectionFactory(http_config));
        http.setPort(8080);
        http.setIdleTimeout(30000);

        // SSL Context Factory for HTTPS
        // SSL requires a certificate so we configure a factory for ssl contents
        // with information pointing to what keystore the ssl connection needs
        // to know about. Much more configuration is available the ssl context,
        // including things like choosing the particular certificate out of a
        // keystore to be used.

        SslContextFactory sslContextFactory = new SslContextFactory();
        sslContextFactory.setKeyStorePath(keystoreFile.getAbsolutePath());
        sslContextFactory.setKeyStorePassword("OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4");
        sslContextFactory.setKeyManagerPassword("OBF:1u2u1wml1z7s1z7a1wnl1u2g");

        // OPTIONAL: Un-comment the following to use Conscrypt for SSL instead of
        // the native JSSE implementation.

        //Security.addProvider(new OpenSSLProvider());
        //sslContextFactory.setProvider("Conscrypt");

        // HTTPS Configuration
        // A new HttpConfiguration object is needed for the next connector and
        // you can pass the old one as an argument to effectively clone the
        // contents. On this HttpConfiguration object we add a
        // SecureRequestCustomizer which is how a new connector is able to
        // resolve the https connection before handing control over to the Jetty
        // Server.
        HttpConfiguration https_config = new HttpConfiguration(http_config);
        SecureRequestCustomizer src = new SecureRequestCustomizer();
        src.setStsMaxAge(2000);
        src.setStsIncludeSubDomains(true);
        https_config.addCustomizer(src);

        // HTTPS connector
        // We create a second ServerConnector, passing in the http configuration
        // we just made along with the previously created ssl context factory.
        // Next we set the port and a longer idle timeout.
        ServerConnector https = new ServerConnector(server,
            new SslConnectionFactory(sslContextFactory,HttpVersion.HTTP_1_1.asString()),
                new HttpConnectionFactory(https_config));
        https.setPort(8443);
        https.setIdleTimeout(500000);

        // Here you see the server having multiple connectors registered with
        // it, now requests can flow into the server from both http and https
        // urls to their respective ports and be processed accordingly by jetty.
        // A simple handler is also registered with the server so the example
        // has something to pass requests off to.

        // Set the connectors
        server.setConnectors(new Connector[] { http, https });

        // Set a handler
        server.setHandler(new HelloHandler());

        // Start the server
        server.start();
        server.dumpStdErr();
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Walkthrough</h5><div class="paragraph"><p>Start things up!
By using the <code>server.join()</code> the server thread will join with the current thread.
See <a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#join()"><code>Thread.join()</code></a> for more details.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project you will need the following Maven dependencies declared.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-server&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-security&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-secured-hello-handler">Secured Hello Handler</h4><div class="paragraph"><p>This example shows how to wrap one handler with another one that handles security.
We have a simple Hello Handler that just return a greeting but add on the restriction that to get this greeting you must authenticate.
Another thing to remember is that this example uses the <code>ConstraintSecurityHandler</code> which is what supports the security mappings inside of the servlet api, it could be easier to show just the <code>SecurityHandler</code> usage, but the constraint provides more configuration power.
If you don&#8217;t need that you can drop the Constraint bits and use just the <code>SecurityHandler</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.util.Collections;

import org.eclipse.jetty.security.ConstraintMapping;
import org.eclipse.jetty.security.ConstraintSecurityHandler;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.security.LoginService;
import org.eclipse.jetty.security.authentication.BasicAuthenticator;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.util.security.Constraint;

public class SecuredHelloHandler
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Since this example is for our test webapp, we need to setup a
        // LoginService so this shows how to create a very simple hashmap based
        // one. The name of the LoginService needs to correspond to what is
        // configured a webapp's web.xml and since it has a lifecycle of its own
        // we register it as a bean with the Jetty server object so it can be
        // started and stopped according to the lifecycle of the server itself.
        // In this example the name can be whatever you like since we are not
        // dealing with webapp realms.
        LoginService loginService = new HashLoginService("MyRealm",
                "src/test/resources/realm.properties");
        server.addBean(loginService);

        // A security handler is a jetty handler that secures content behind a
        // particular portion of a url space. The ConstraintSecurityHandler is a
        // more specialized handler that allows matching of urls to different
        // constraints. The server sets this as the first handler in the chain,
        // effectively applying these constraints to all subsequent handlers in
        // the chain.
        ConstraintSecurityHandler security = new ConstraintSecurityHandler();
        server.setHandler(security);

        // This constraint requires authentication and in addition that an
        // authenticated user be a member of a given set of roles for
        // authorization purposes.
        Constraint constraint = new Constraint();
        constraint.setName("auth");
        constraint.setAuthenticate(true);
        constraint.setRoles(new String[] { "user", "admin" });

        // Binds a url pattern with the previously created constraint. The roles
        // for this constraing mapping are mined from the Constraint itself
        // although methods exist to declare and bind roles separately as well.
        ConstraintMapping mapping = new ConstraintMapping();
        mapping.setPathSpec("/*");
        mapping.setConstraint(constraint);

        // First you see the constraint mapping being applied to the handler as
        // a singleton list, however you can passing in as many security
        // constraint mappings as you like so long as they follow the mapping
        // requirements of the servlet api. Next we set a BasicAuthenticator
        // instance which is the object that actually checks the credentials
        // followed by the LoginService which is the store of known users, etc.
        security.setConstraintMappings(Collections.singletonList(mapping));
        security.setAuthenticator(new BasicAuthenticator());
        security.setLoginService(loginService);

        // The Hello Handler is the handler we are securing so we create one,
        // and then set it as the handler on the
        // security handler to complain the simple handler chain.
        HelloHandler hh = new HelloHandler();

        // chain the hello handler into the security handler
        security.setHandler(hh);

        // Start things up!
        server.start();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See
        // http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Run it!</h5><div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8080/index.html">http://localhost:8080/index.html</a> (assuming one is in the resource base directory) and you are good to go.</p></div></div>
<div class="sect4"><h5>The Realm Properties File</h5><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-properties" data-lang="properties">#
# This file defines users passwords and roles for a HashUserRealm
#
# The format is
#  &lt;username&gt;: &lt;password&gt;[,&lt;rolename&gt; ...]
#
# Passwords may be clear text, obfuscated or checksummed.  The class
# org.eclipse.jetty.util.security.Password should be used to generate obfuscated
# passwords or password checksums
#
# If DIGEST Authentication is used, the password must be in a recoverable
# format, either plain text or OBF:.
#
jetty: MD5:164c88b302622e17050af52c89945d44,user
admin: CRYPT:adpexzg3FUZAk,server-administrator,content-administrator,admin,user
other: OBF:1xmk1w261u9r1w1c1xmq,user
plain: plain,user
user: password,user

# This entry is for digest auth.  The credential is a MD5 hash of username:realmname:password
digest: MD5:6e120743ad67abfbc385bc2bb754e297,user</code></pre></div></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project you will need the following Maven dependencies declared.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-server&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-minimal-servlet">Minimal Servlet</h4><div class="paragraph"><p>This example shows the bare minimum required for deploying a servlet into Jetty.
Note that this is strictly a servlet, not a servlet in the context of a web application, that example comes later.
This is purely just a servlet deployed and mounted on a context and able to process requests.
This example is excellent for situations where you have a simple servlet that you need to unit test, just mount it on a context and issue requests using your favorite http client library (like our Jetty client found in <a href="#http-client">HTTP Client</a>).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.ServletHandler;

public class MinimalServlets
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // The ServletHandler is a dead simple way to create a context handler
        // that is backed by an instance of a Servlet.
        // This handler then needs to be registered with the Server object.
        ServletHandler handler = new ServletHandler();
        server.setHandler(handler);

        // Passing in the class for the Servlet allows jetty to instantiate an
        // instance of that Servlet and mount it on a given context path.

        // IMPORTANT:
        // This is a raw Servlet, not a Servlet that has been configured
        // through a web.xml @WebServlet annotation, or anything similar.
        handler.addServletWithMapping(HelloServlet.class, "/*");

        // Start things up!
        server.start();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See
        // http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }

    @SuppressWarnings("serial")
    public static class HelloServlet extends HttpServlet
    {
        @Override
        protected void doGet( HttpServletRequest request,
                              HttpServletResponse response ) throws ServletException,
                                                            IOException
        {
            response.setContentType("text/html");
            response.setStatus(HttpServletResponse.SC_OK);
            response.getWriter().println("&lt;h1&gt;Hello from HelloServlet&lt;/h1&gt;");
        }
    }
}</code></pre></div></div>
<div class="sect4"><h5>Walkthrough</h5><div class="paragraph"><p>Start things up! By using the <code>server.join()</code> the server thread will join with the current thread.
See <a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#join()"><code>Thread.join()</code></a> for more details.</p></div>
<div class="paragraph"><p>It is really simple to create useful servlets for testing behaviors. Sometimes you need a http server to run a unit test against that will return test content and wiring up a servlet like this makes it trivial.</p></div>
<div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8080/">http://localhost:8080/</a> and you are good to go.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project you will need the following Maven dependencies declared.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-servlet&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-one-webapp">Web Application</h4><div class="paragraph"><p>This example shows how to deploy a simple webapp with an embedded instance of Jetty.
This is useful when you want to manage the lifecycle of a server programmatically, either within a production application or as a simple way to deploying and debugging a full scale application deployment.
In many ways it is easier then traditional deployment since you control the classpath yourself, making this easy to wire up in a test case in Maven  and issue requests using your favorite http client library (like our Jetty client found in <a href="#http-client">HTTP Client</a>).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.AllowSymLinkAliasChecker;
import org.eclipse.jetty.webapp.WebAppContext;

public class OneWebApp
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Setup JMX
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer());
        server.addBean(mbContainer);

        // The WebAppContext is the entity that controls the environment in
        // which a web application lives and breathes. In this example the
        // context path is being set to "/" so it is suitable for serving root
        // context requests and then we see it setting the location of the war.
        // A whole host of other configurations are available, ranging from
        // configuring to support annotation scanning in the webapp (through
        // PlusConfiguration) to choosing where the webapp will unpack itself.
        WebAppContext webapp = new WebAppContext();
        webapp.setContextPath("/");
        File warFile = new File(
                "../../tests/test-jmx/jmx-webapp/target/jmx-webapp");
        webapp.setWar(warFile.getAbsolutePath());

        // A WebAppContext is a ContextHandler as well so it needs to be set to
        // the server so it is aware of where to send the appropriate requests.
        server.setHandler(webapp);

        // Start things up!
        server.start();

        server.dumpStdErr();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Run it!</h5><div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8080/">http://localhost:8080/</a> and you are good to go.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project you will need the following Maven dependencies declared.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-webapp&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="embedded-webapp-jsp">Web Application with JSP</h4><div class="paragraph"><p>This example is very similar to the one in the previous section, although it enables the embedded webapp to use JSPs.
As of jetty-9.2, we use the JSP engine from Apache, which relies on a Servlet Specification 3.1 style <code>ServletContainerInitializer</code> to initialize itself.
To get this to work with Jetty, you need to enable annotations processing, as shown in this example code:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.webapp.Configuration;
import org.eclipse.jetty.webapp.WebAppContext;

public class OneWebAppWithJsp
{
    public static void main( String[] args ) throws Exception
    {
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then
        // a randomly available port will be assigned that you can either look
        // in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server( 8080 );

        // Setup JMX
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer() );
        server.addBean( mbContainer );

        // The WebAppContext is the entity that controls the environment in
        // which a web application lives and
        // breathes. In this example the context path is being set to "/" so it
        // is suitable for serving root context
        // requests and then we see it setting the location of the war. A whole
        // host of other configurations are
        // available, ranging from configuring to support annotation scanning in
        // the webapp (through
        // PlusConfiguration) to choosing where the webapp will unpack itself.
        WebAppContext webapp = new WebAppContext();
        webapp.setContextPath( "/" );
        File warFile = new File(
                "../../jetty-distribution/target/distribution/demo-base/webapps/test.war" );
        if (!warFile.exists())
        {
            throw new RuntimeException( "Unable to find WAR File: "
                    + warFile.getAbsolutePath() );
        }
        webapp.setWar( warFile.getAbsolutePath() );
        webapp.setExtractWAR(true);

        // This webapp will use jsps and jstl. We need to enable the
        // AnnotationConfiguration in order to correctly
        // set up the jsp container
        Configuration.ClassList classlist = Configuration.ClassList
                .setServerDefault( server );
        classlist.addBefore(
                "org.eclipse.jetty.webapp.JettyWebXmlConfiguration",
                "org.eclipse.jetty.annotations.AnnotationConfiguration" );

        // Set the ContainerIncludeJarPattern so that jetty examines these
        // container-path jars for tlds, web-fragments etc.
        // If you omit the jar that contains the jstl .tlds, the jsp engine will
        // scan for them instead.
        webapp.setAttribute(
                "org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern",
                ".*/[^/]*servlet-api-[^/]*\\.jar$|.*/javax.servlet.jsp.jstl-.*\\.jar$|.*/[^/]*taglibs.*\\.jar$" );

        // A WebAppContext is a ContextHandler as well so it needs to be set to
        // the server so it is aware of where to
        // send the appropriate requests.
        server.setHandler( webapp );

        // Configure a LoginService.
        // Since this example is for our test webapp, we need to setup a
        // LoginService so this shows how to create a very simple hashmap based
        // one. The name of the LoginService needs to correspond to what is
        // configured in the webapp's web.xml and since it has a lifecycle of
        // its own we register it as a bean with the Jetty server object so it
        // can be started and stopped according to the lifecycle of the server
        // itself.
        HashLoginService loginService = new HashLoginService();
        loginService.setName( "Test Realm" );
        loginService.setConfig( "src/test/resources/realm.properties" );
        server.addBean( loginService );

        // Start things up!
        server.start();

        server.dumpStdErr();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    }
}</code></pre></div></div>
<div class="sect4"><h5>Run it!</h5><div class="paragraph"><p>After you have started things up you should be able to navigate to <a class="bare" href="http://localhost:8080/jsp/">http://localhost:8080/jsp/</a> and click on any of the links to jsps.</p></div></div>
<div class="sect4"><h5>Maven Coordinates</h5><div class="paragraph"><p>To use this example in your project, you will need the following Maven dependencies declared, in addition to those from the previous section:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-annotations&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;apache-jsp&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;apache-jstl&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="adding-embedded-examples">Adding Examples</h4><div class="paragraph"><p>If you would like to add an example to this list, fork the documentation project from github (see the blue bar at the bottom of this page) and add the new page.
Feel free to add the example contents directly as a <code>[source.java]</code> and we will take it from there.</p></div>
<div class="paragraph"><p>If you feel and example is missing, feel free to open a bug to ask for it.
No guarantees, but the more helpful and demonstrative it is the better.</p></div></div></div></div>
<div class="sect2"><h3 id="http-client">HTTP Client</h3><div class="sect2"><h3 id="http-client-intro">Introduction</h3><div class="paragraph"><p>The Jetty HTTP client module provides easy-to-use APIs and utility classes to perform HTTP (or HTTPS) requests.</p></div>
<div class="paragraph"><p>Jetty&#8217;s HTTP client is non-blocking and asynchronous.
It offers an asynchronous API that never blocks for I/O, making it very efficient in thread utilization and well suited for high performance scenarios such as load testing or parallel computation.</p></div>
<div class="paragraph"><p>However, when all you need to do is to perform a <code>GET</code> request to a resource, Jetty&#8217;s HTTP client offers also a synchronous API; a programming interface
where the thread that issued the request blocks until the request/response conversation is complete.</p></div>
<div class="paragraph"><p>Jetty&#8217;s HTTP client supports different <a href="#http-client-transport">transports</a>: HTTP/1.1, FastCGI and HTTP/2.
This means that the semantic of a HTTP request (that is, " <code>GET</code> me the resource <code>/index.html</code> ") can be carried over the network in different formats.
The most common and default format is HTTP/1.1.
That said, Jetty&#8217;s HTTP client can carry the same request using the FastCGI format or the new HTTP/2 format.</p></div>
<div class="paragraph"><p>The FastCGI transport is heavily used in Jetty&#8217;s <a href="#fastcgi">FastCGI support</a> that allows Jetty to work as a reverse proxy to PHP (exactly like Apache or Nginx do) and therefore be able to serve - for example - WordPress websites.</p></div>
<div class="paragraph"><p>The HTTP/2 transport allows Jetty&#8217;s HTTP client to perform requests using HTTP/2 to HTTP/2 enabled web sites, see also Jetty&#8217;s <a href="#http2">HTTP/2 support</a>.</p></div>
<div class="paragraph"><p>Out of the box features that you get with the Jetty HTTP client include:</p></div>
<div class="ulist"><ul><li><p>Redirect support - redirect codes such as 302 or 303 are automatically followed.</p></li><li><p>Cookies support - cookies sent by servers are stored and sent back to servers in matching requests.</p></li><li><p>Authentication support - HTTP "Basic" and "Digest" authentications are supported, others are pluggable.</p></li><li><p>Forward proxy support - HTTP proxying and SOCKS4 proxying.</p></li></ul></div>
<div class="sect3"><h4 id="http-client-init">Starting HttpClient</h4><div class="paragraph"><p>The main class is named <code>org.eclipse.jetty.client.HttpClient</code>.</p></div>
<div class="paragraph"><p>You can think of a <code>HttpClient</code> instance as a browser instance.
Like a browser it can make requests to different domains, it manages redirects, cookies and authentication, you can configure it with a proxy, and
it provides you with the responses to the requests you make.</p></div>
<div class="paragraph"><p>In order to use <code>HttpClient</code>, you must instantiate it, configure it, and then start it:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// Instantiate HttpClient
HttpClient httpClient = new HttpClient();

// Configure HttpClient, for example:
httpClient.setFollowRedirects(false);

// Start HttpClient
httpClient.start();</code></pre></div></div>
<div class="paragraph"><p>You may create multiple instances of <code>HttpClient</code>, but typically one instance is enough for an application.
There are several reasons for having multiple <code>HttpClient</code> instances including, but not limited to:</p></div>
<div class="ulist"><ul><li><p>You want to specify different configuration parameters (for example, one instance is configured with a forward proxy while another is not)</p></li><li><p>You want the two instances to behave like two different browsers and hence have different cookies, different authentication credentials&#8230;&#8203;etc.</p></li><li><p>You want to use different transports</p></li></ul></div>
<div class="paragraph"><p>When you create a <code>HttpClient</code> instance using the parameterless constructor, you will only be able to perform plain HTTP requests and you will not be able to perform HTTPS requests.</p></div>
<div class="paragraph"><p>In order to perform HTTPS requests, you should create first a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/util/ssl/SslContextFactory.html"><code>SslContextFactory</code></a>, configure it, and pass it to the <code>HttpClient</code> constructor.
When created with a <code>SslContextFactory</code>, the <code>HttpClient</code> will be able to perform both HTTP and HTTPS requests to any domain.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// Instantiate and configure the SslContextFactory
SslContextFactory sslContextFactory = new SslContextFactory();

// Instantiate HttpClient with the SslContextFactory
HttpClient httpClient = new HttpClient(sslContextFactory);

// Configure HttpClient, for example:
httpClient.setFollowRedirects(false);

// Start HttpClient
httpClient.start();</code></pre></div></div></div>
<div class="sect3"><h4>Stopping HttpClient</h4><div class="paragraph"><p>It is recommended that when your application stops, you also stop the <code>HttpClient</code> instance (or instances) that you are using.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.stop();</code></pre></div></div>
<div class="paragraph"><p>Stopping <code>HttpClient</code> makes sure that the memory it holds (for example, authentication credentials, cookies, etc.) is released, and that the thread pool and scheduler are properly stopped allowing all threads used by <code>HttpClient</code> to exit.</p></div></div></div>
<div class="sect2"><h3 id="http-client-api">API Usage</h3><div class="sect3"><h4 id="http-client-blocking">Blocking APIs</h4><div class="paragraph"><p>The simple way to perform a HTTP request is the following:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.GET("http://domain.com/path?query");</code></pre></div></div>
<div class="paragraph"><p>The method <code>HttpClient.GET(&#8230;&#8203;)</code> performs a HTTP <code>GET</code> request to the given URI and returns a <code>ContentResponse</code> when the request/response conversation completes successfully.</p></div>
<div class="paragraph"><p>The <code>ContentResponse</code> object contains the HTTP response information: status code, headers and possibly content.
The content length is limited by default to 2 MiB; for larger content see <a href="#http-client-response-content">Response Content Handling</a>.</p></div>
<div class="paragraph"><p>If you want to customize the request, for example by issuing a <code>HEAD</code> request instead of a <code>GET</code>, and simulating a browser user agent, you can do it in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/path?query")
        .method(HttpMethod.HEAD)
        .agent("Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:17.0) Gecko/20100101 Firefox/17.0")
        .send();</code></pre></div></div>
<div class="paragraph"><p>This is a shorthand for:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Request request = httpClient.newRequest("http://domain.com/path?query");
request.method(HttpMethod.HEAD);
request.agent("Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:17.0) Gecko/20100101 Firefox/17.0");
ContentResponse response = request.send();</code></pre></div></div>
<div class="paragraph"><p>You first create a request object using <code>httpClient.newRequest(&#8230;&#8203;)</code>, and then you customize it using the fluent API style (that is, a chained invocation of methods on the request object).
When the request object is customized, you call <code>request.send()</code> that produces the <code>ContentResponse</code> when the request/response conversation is complete.</p></div>
<div class="paragraph"><p>Simple <code>POST</code> requests also have a shortcut method:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.POST("http://domain.com/entity/1")
        .param("p", "value")
        .send();</code></pre></div></div>
<div class="paragraph"><p>The <code>POST</code> parameter values added via the <code>param()</code> method are automatically URL-encoded.</p></div>
<div class="paragraph"><p>Jetty&#8217;s HTTP client automatically follows redirects, so it handles the typical web pattern <a href="http://en.wikipedia.org/wiki/Post/Redirect/Get">POST/Redirect/GET</a>, and the response object contains the content of the response of the <code>GET</code> request.
Following redirects is a feature that you can enable/disable on a per-request basis or globally.</p></div>
<div class="paragraph"><p>File uploads also require one line, and make use of JDK 7′s <code>java.nio.file</code> classes:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .file(Paths.get("file_to_upload.txt"), "text/plain")
        .send();</code></pre></div></div>
<div class="paragraph"><p>It is possible to impose a total timeout for the request/response conversation using the <code>Request.timeout(&#8230;&#8203;)</code> method as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/path?query")
        .timeout(5, TimeUnit.SECONDS)
        .send();</code></pre></div></div>
<div class="paragraph"><p>In the example above, when the 5 seconds expire, the request is aborted and a <code>java.util.concurrent.TimeoutException</code> is thrown.</p></div></div>
<div class="sect3"><h4 id="http-client-async">Non-Blocking APIs</h4><div class="paragraph"><p>So far we have shown how to use Jetty HTTP client in a blocking style - that is, the thread that issues the request blocks until the request/response conversation is complete.</p></div>
<div class="paragraph"><p>This section will look at Jetty&#8217;s HTTP client non-blocking, asynchronous APIs that are perfectly suited for large content downloads, for parallel processing of requests/responses and in cases where performance and efficient thread and resource utilization is a key factor.</p></div>
<div class="paragraph"><p>The asynchronous APIs rely heavily on listeners that are invoked at various stages of request and response processing.
These listeners are implemented by applications and may perform any kind of logic.
The implementation invokes these listeners in the same thread that is used to process the request or response.
Therefore, if the application code in these listeners takes a long time to execute, the request or response processing is delayed until the listener returns.</p></div>
<div class="paragraph"><p>If you need to execute application code that takes long time inside a listener, you must spawn your own thread and remember to deep copy any data provided by the listener that you will need in your code, because when the listener returns the data it provides may be recycled/cleared/destroyed.</p></div>
<div class="paragraph"><p>Request and response processing are executed by two different threads and therefore may happen concurrently.
A typical example of this concurrent processing is an echo server, where a large upload may be concurrent with the large download echoed back.
As a side note, remember that responses may be processed and completed <em>before</em> requests; a typical example is a large upload that triggers a quick response - for example an error - by the server: the response may arrive and be completed while the request content is still being uploaded.</p></div>
<div class="paragraph"><p>The application thread that calls <code>Request.send(Response.CompleteListener)</code> performs the processing of the request until either the request is fully processed or until it would block on I/O, then it returns (and therefore never blocks).
If it would block on I/O, the thread asks the I/O system to emit an event when the I/O will be ready to continue, then returns.
When such an event is fired, a thread taken from the <code>HttpClient</code> thread pool will resume the processing of the request.</p></div>
<div class="paragraph"><p>Response are processed from the I/O thread that fires the event that bytes are ready to be read.
Response processing continues until either the response is fully processed or until it would block for I/O.
If it would block for I/O, the thread asks the I/O system to emit an event when the I/O will be ready to continue, then returns.
When such an event is fired, a thread taken from the <code>HttpClient</code> thread pool will resume the processing of the response.</p></div>
<div class="paragraph"><p>When the request and the response are both fully processed, the thread that finished the last processing (usually the thread that processes the response, but may also be the thread that processes the request - if the request takes more time than the response to be processed) is used to de-queue the next request for the same destination and processes it.</p></div>
<div class="paragraph"><p>A simple asynchronous <code>GET</code> request that discards the response content can be written in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.newRequest("http://domain.com/path")
        .send(new Response.CompleteListener()
        {
            @Override
            public void onComplete(Result result)
            {
                // Your logic here
            }
        });</code></pre></div></div>
<div class="paragraph"><p>Method <code>Request.send(Response.CompleteListener)</code> returns <code>void</code> and does not block; the <code>Response.CompleteListener</code> provided as a parameter is notified when the request/response conversation is complete, and the <code>Result</code> parameter allows you to access the response object.</p></div>
<div class="paragraph"><p>You can write the same code using JDK 8′s lambda expressions:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.newRequest("http://domain.com/path")
        .send(result -&gt; { /* Your logic here */ });</code></pre></div></div>
<div class="paragraph"><p>You can impose a total timeout for the request/response conversation in the same way used by the synchronous API:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.newRequest("http://domain.com/path")
        .timeout(3, TimeUnit.SECONDS)
        .send(result -&gt; { /* Your logic here */ });</code></pre></div></div>
<div class="paragraph"><p>The example above will impose a total timeout of 3 seconds on the request/response conversation.</p></div>
<div class="paragraph"><p>The HTTP client APIs use listeners extensively to provide hooks for all possible request and response events, and with JDK 8′s lambda expressions they are even more fun to use:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.newRequest("http://domain.com/path")
        // Add request hooks
        .onRequestQueued(request -&gt; { ... })
        .onRequestBegin(request -&gt; { ... })
        ... // More request hooks available

        // Add response hooks
        .onResponseBegin(response -&gt; { ... })
        .onResponseHeaders(response -&gt; { ... })
        .onResponseContent((response, buffer) -&gt; { ... })
        ... // More response hooks available

        .send(result -&gt; { ... });</code></pre></div></div>
<div class="paragraph"><p>This makes Jetty HTTP client suitable for HTTP load testing because, for example, you can accurately time every step of the request/response conversation (thus knowing where the request/response time is really spent).</p></div>
<div class="paragraph"><p>Have a look at the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/client/api/Request.Listener.html"><code>Request.Listener</code></a> class to know about request events, and to the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/client/api/Response.Listener.html"><code>Response.Listener</code></a> class to know about response events.</p></div></div>
<div class="sect3"><h4 id="http-client-content">Content Handling</h4><div class="sect4"><h5 id="http-client-request-content">Request Content Handling</h5><div class="paragraph"><p>Jetty&#8217;s HTTP client provides a number of utility classes off the shelf to handle request content.</p></div>
<div class="paragraph"><p>You can provide request content as <code>String</code>, <code>byte[]</code>, <code>ByteBuffer</code>, <code>java.nio.file.Path</code>, <code>InputStream</code>, and provide your own implementation of <code>org.eclipse.jetty.client.api.ContentProvider</code>.
Here’s an example that provides the request content using <code>java.nio.file.Paths</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .file(Paths.get("file_to_upload.txt"), "text/plain")
        .send();</code></pre></div></div>
<div class="paragraph"><p>This is equivalent to using the <code>PathContentProvider</code> utility class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .content(new PathContentProvider(Paths.get("file_to_upload.txt")), "text/plain")
        .send();</code></pre></div></div>
<div class="paragraph"><p>Alternatively, you can use <code>FileInputStream</code> via the <code>InputStreamContentProvider</code> utility class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .content(new InputStreamContentProvider(new FileInputStream("file_to_upload.txt")), "text/plain")
        .send();</code></pre></div></div>
<div class="paragraph"><p>Since <code>InputStream</code> is blocking, then also the send of the request will block if the input stream blocks, even in case of usage of the asynchronous <code>HttpClient</code> APIs.</p></div>
<div class="paragraph"><p>If you have already read the content in memory, you can pass it as a <code>byte[]</code> using the <code>BytesContentProvider</code> utility class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">byte[] bytes = ...;
ContentResponse response = httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .content(new BytesContentProvider(bytes), "text/plain")
        .send();</code></pre></div></div>
<div class="paragraph"><p>If the request content is not immediately available, but your application will be notified of the content to send, you can use <code>DeferredContentProvider</code> in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">DeferredContentProvider content = new DeferredContentProvider();
httpClient.newRequest("http://domain.com/upload")
        .method(HttpMethod.POST)
        .content(content)
        .send(new Response.CompleteListener()
        {
            @Override
            public void onComplete(Result result)
            {
                // Your logic here
            }
        });

// Content not available yet here

...

// An event happens, now content is available
byte[] bytes = ...;
content.offer(ByteBuffer.wrap(bytes));

...

// All content has arrived
content.close();</code></pre></div></div>
<div class="paragraph"><p>While the request content is awaited and consequently uploaded by the client application, the server may be able to respond (at least with the response headers) completely asynchronously.
In this case, <code>Response.Listener</code> callbacks will be invoked before the request is fully sent.
This allows fine-grained control of the request/response conversation: for example the server may reject contents that are too big, send a response to the client, which in turn may stop the content upload.</p></div>
<div class="paragraph"><p>Another way to provide request content is by using an <code>OutputStreamContentProvider</code>,
which allows applications to write request content when it is available to the <code>OutputStream</code> provided by <code>OutputStreamContentProvider</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">OutputStreamContentProvider content = new OutputStreamContentProvider();

// Use try-with-resources to close the OutputStream when all content is written
try (OutputStream output = content.getOutputStream())
{
    client.newRequest("localhost", 8080)
            .method(HttpMethod.POST)
            .content(content)
            .send(new Response.CompleteListener()
            {
                @Override
                public void onComplete(Result result)
                {
                    // Your logic here
                }
            });

    ...

    // Write content
    writeContent(output);
}
// End of try-with-resource, output.close() called automatically to signal end of content</code></pre></div></div></div>
<div class="sect4"><h5 id="http-client-response-content">Response Content Handling</h5><div class="paragraph"><p>Jetty HTTP client allows applications to handle response content in different ways.</p></div>
<div class="paragraph"><p>The first way is to buffer the response content in memory; this is done when using the blocking APIs (see <a href="#http-client-blocking">Blocking APIs</a>) and the content is buffered within a <code>ContentResponse</code> up to 2 MiB.</p></div>
<div class="paragraph"><p>If you want to control the length of the response content (for example limiting to values smaller than the default of 2 MiB), then you can use a <code>org.eclipse.jetty.client.util.FutureResponseListener</code> in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Request request = httpClient.newRequest("http://domain.com/path");

// Limit response content buffer to 512 KiB
FutureResponseListener listener = new FutureResponseListener(request, 512 * 1024);

request.send(listener);

ContentResponse response = listener.get(5, TimeUnit.SECONDS);</code></pre></div></div>
<div class="paragraph"><p>If the response content length is exceeded, the response will be aborted, and an exception will be thrown by method <code>get()</code>.</p></div>
<div class="paragraph"><p>If you are using the asynchronous APIs (see <a href="#http-client-async">Non-Blocking APIs</a>), you can use the <code>BufferingResponseListener</code> utility class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.newRequest("http://domain.com/path")
        // Buffer response content up to 8 MiB
        .send(new BufferingResponseListener(8 * 1024 * 1024)
        {
            @Override
            public void onComplete(Result result)
            {
                if (!result.isFailed())
                {
                    byte[] responseContent = getContent();
                    // Your logic here
                }
            }
        });</code></pre></div></div>
<div class="paragraph"><p>The second way is the most efficient (because it avoids content copies) and allows you to specify a <code>Response.ContentListener</code>, or a subclass, to handle the content as soon as it arrives.
In the example below, <code>Response.Listener.Adapter</code> is a class that implements both <code>Response.ContentListener</code> and <code>Response.CompleteListener</code> and can be passed to <code>Request.send()</code>.
Jetty&#8217;s HTTP client will invoke the <code>onContent()</code> method zero or more times (until there is content), and finally invoke the <code>onComplete()</code> method.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient .newRequest("http://domain.com/path")
        .send(new Response.Listener.Adapter()
        {
            @Override
            public void onContent(Response response, ByteBuffer buffer)
            {
                // Your logic here
            }
        });</code></pre></div></div>
<div class="paragraph"><p>The third way allows you to wait for the response and then stream the content using the <code>InputStreamResponseListener</code> utility class:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">InputStreamResponseListener listener = new InputStreamResponseListener();
httpClient.newRequest("http://domain.com/path")
        .send(listener);

// Wait for the response headers to arrive
Response response = listener.get(5, TimeUnit.SECONDS);

// Look at the response
if (response.getStatus() == HttpStatus.OK_200)
{
    // Use try-with-resources to close input stream.
    try (InputStream responseContent = listener.getInputStream())
    {
        // Your logic here
    }
}</code></pre></div></div></div></div></div>
<div class="sect2"><h3 id="http-client-cookie">Cookies Support</h3><div class="paragraph"><p>Jetty HTTP client supports cookies out of the box.
The <code>HttpClient</code> instance receives cookies from HTTP responses and stores them in a <code>java.net.CookieStore</code>, a class that is part of the JDK.
When new requests are made, the cookie store is consulted and if there are matching cookies (that is, cookies that are not expired and that match domain and path of the request) then they are added to the requests.</p></div>
<div class="paragraph"><p>Applications can programmatically access the cookie store to find the cookies that have been set:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">CookieStore cookieStore = httpClient.getCookieStore();
List&lt;HttpCookie&gt; cookies = cookieStore.get(URI.create("http://domain.com/path"));</code></pre></div></div>
<div class="paragraph"><p>Applications can also programmatically set cookies as if they were returned from a HTTP response:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">CookieStore cookieStore = httpClient.getCookieStore();
HttpCookie cookie = new HttpCookie("foo", "bar");
cookie.setDomain("domain.com");
cookie.setPath("/");
cookie.setMaxAge(TimeUnit.DAYS.toSeconds(1));
cookieStore.add(URI.create("http://domain.com"), cookie);</code></pre></div></div>
<div class="paragraph"><p>Cookies may be added only for a particular request:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ContentResponse response = httpClient.newRequest("http://domain.com/path")
        .cookie(new HttpCookie("foo", "bar"))
        .send();</code></pre></div></div>
<div class="paragraph"><p>You can remove cookies that you do not want to be sent in future HTTP requests:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">CookieStore cookieStore = httpClient.getCookieStore();
URI uri = URI.create("http://domain.com");
List&lt;HttpCookie&gt; cookies = cookieStore.get(uri);
for (HttpCookie cookie : cookies)
    cookieStore.remove(uri, cookie);</code></pre></div></div>
<div class="paragraph"><p>If you want to totally disable cookie handling, you can install a <code>HttpCookieStore.Empty</code> instance in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.setCookieStore(new HttpCookieStore.Empty());</code></pre></div></div>
<div class="paragraph"><p>You can enable cookie filtering by installing a cookie store that performs the filtering logic in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.setCookieStore(new GoogleOnlyCookieStore());

public class GoogleOnlyCookieStore extends HttpCookieStore
{
    @Override
    public void add(URI uri, HttpCookie cookie)
    {
        if (uri.getHost().endsWith("google.com"))
            super.add(uri, cookie);
    }
}</code></pre></div></div>
<div class="paragraph"><p>The example above will retain only cookies that come from the <code>google.com</code> domain or sub-domains.</p></div>
<div class="sect3"><h4>Special Characters in Cookies</h4><div class="paragraph"><p>Jetty is compliant with <a href="https://tools.ietf.org/html/rfc6265">RFC6265</a>, and as such care must be taken when setting a cookie value that includes special characters such as <code>;</code>.</p></div>
<div class="paragraph"><p>Previously, Version=1 cookies defined in <a href="https://tools.ietf.org/html/rfc2109">RFC2109</a> (and continued in <a href="https://tools.ietf.org/html/rfc2965">RFC2965</a>) allowed for special/reserved characters to be enclosed within double quotes when declared in a <code>Set-Cookie</code> response header:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Set-Cookie: foo="bar;baz";Version=1;Path="/secur"</code></pre></div></div>
<div class="paragraph"><p>This was added to the HTTP Response header as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Cookie cookie = new Cookie("foo", "bar;baz");
cookie.setPath("/secur");
response.addCookie(cookie);</code></pre></div></div>
<div class="paragraph"><p>The introduction of RFC6265 has rendered this approach no longer possible; users are now required to encode cookie values that use these special characters.
This can be done utilizing <code>javax.servlet.http.Cookie</code> as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Cookie cookie = new Cookie("foo", URLEncoder.encode("bar;baz", "utf-8"));</code></pre></div></div>
<div class="paragraph"><p>Jetty validates all cookie names and values being added to the <code>HttpServletResponse</code> via the <code>addCookie(Cookie)</code> method.
If an illegal value is discovered Jetty will throw an <code>IllegalArgumentException</code> with the details.</p></div></div></div>
<div class="sect2"><h3 id="http-client-authentication">Authentication Support</h3><div class="paragraph"><p>Jetty&#8217;s HTTP client supports the <code>BASIC</code> and <code>DIGEST</code> authentication mechanisms defined by <a href="https://tools.ietf.org/html/rfc7235">RFC 7235</a>.</p></div>
<div class="paragraph"><p>You can configure authentication credentials in the HTTP client instance as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">URI uri = new URI("http://domain.com/secure");
String realm = "MyRealm";
String user = "username";
String pass = "password";

// Add authentication credentials
AuthenticationStore auth = httpClient.getAuthenticationStore();
auth.addAuthentication(new BasicAuthentication(uri, realm, user, pass));

ContentResponse response = httpClient
        .newRequest(uri)
        .send()
        .get(5, TimeUnit.SECONDS);</code></pre></div></div>
<div class="paragraph"><p>Jetty&#8217;s HTTP client tests authentication credentials against the challenge(s) the server issues (see our section here on <a href="#configuring-security-secure-passwords">secure password obfuscation</a>), and if they match it automatically sends the right authentication headers to the server for authentication.
If the authentication is successful, it caches the result and reuses it for subsequent requests for the same domain and matching URIs.</p></div>
<div class="paragraph"><p>The HTTP conversation for a successful match is the following:</p></div>
<div class="listingblock"><div class="content"><pre>Application  HttpClient                     Server
     |           |                             |
     |--- GET ---|------------ GET -----------&gt;|
     |           |                             |
     |           |&lt;-- 401 + WWW-Authenticate --|
     |           |                             |
     |           |--- GET + Authentication ---&gt;|
     |           |                             |
     |&lt;-- 200 ---|------------ 200 ------------|</pre></div></div>
<div class="paragraph"><p>The application does not receive events related to the response with code 401, they are handled internally by <code>HttpClient</code> which produces a request similar to the original but with the correct <code>Authorization</code> header, and then relays the response with code 200 to the application.</p></div>
<div class="paragraph"><p>Successful authentications are cached, but it is possible to clear them in order to force authentication again:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">httpClient.getAuthenticationStore().clearAuthenticationResults();</code></pre></div></div>
<div class="paragraph"><p>Authentications may be preempted to avoid the additional roundtrip due to the server challenge in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">AuthenticationStore auth = httpClient.getAuthenticationStore();
URI uri = URI.create("http://domain.com/secure");
auth.addAuthenticationResult(new BasicAuthentication.BasicResult(uri, "username", "password"));</code></pre></div></div>
<div class="paragraph"><p>In this way, requests for the given URI are enriched by <code>HttpClient</code> immediately with the <code>Authorization</code> header, and the server should respond with a 200 and the resource content rather than with the 401 and the challenge.</p></div>
<div class="paragraph"><p>It is also possible to preempt the authentication for a single request only, in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">URI uri = URI.create("http://domain.com/secure");
Authentication.Result authn = new BasicAuthentication.BasicResult(uri, "username", "password")
Request request = httpClient.newRequest(uri);
authn.apply(request);
request.send();</code></pre></div></div>
<div class="paragraph"><p>See also the <a href="#http-client-proxy-authentication">proxy authentication section</a> for further information about how authentication works with HTTP proxies.</p></div></div>
<div class="sect2"><h3 id="http-client-proxy">Proxy Support</h3><div class="paragraph"><p>Jetty&#8217;s HTTP client can be configured to use proxies to connect to destinations.</p></div>
<div class="paragraph"><p>Two types of proxies are available out of the box: a HTTP proxy (provided by class <code>org.eclipse.jetty.client.HttpProxy</code>) and a SOCKS 4 proxy (provided by class <code>org.eclipse.jetty.client.Socks4Proxy</code>).
Other implementations may be written by subclassing <code>ProxyConfiguration.Proxy</code>.</p></div>
<div class="paragraph"><p>The following is a typical configuration:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">ProxyConfiguration proxyConfig = httpClient.getProxyConfiguration();
HttpProxy proxy = new HttpProxy("proxyHost", proxyPort);

// Do not proxy requests for localhost:8080
proxy.getExcludedAddresses().add("localhost:8080");

// add the new proxy to the list of proxies already registered
proxyConfig.getProxies().add(proxy);

ContentResponse response = httpClient.GET(uri);</code></pre></div></div>
<div class="paragraph"><p>You specify the proxy host and port, and optionally also the addresses that you do not want to be proxied, and then add the proxy configuration on the <code>ProxyConfiguration</code> instance.</p></div>
<div class="paragraph"><p>Configured in this way, <code>HttpClient</code> makes requests to the HTTP proxy (for plain-text HTTP requests) or establishes a tunnel via <code>HTTP CONNECT</code> (for encrypted HTTPS requests).</p></div>
<div class="sect3"><h4 id="http-client-proxy-authentication">Proxy Authentication Support</h4><div class="paragraph"><p>Jetty&#8217;s HTTP client support proxy authentication in the same way it supports <a href="#http-client-authentication">server authentication</a>.</p></div>
<div class="paragraph"><p>In the example below, the proxy requires Basic authentication, but the server requires Digest authentication, and therefore:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">URI proxyURI = new URI("http://proxy.net:8080");
URI serverURI = new URI("http://domain.com/secure");

AuthenticationStore auth = httpClient.getAuthenticationStore();

// Proxy credentials.
auth.addAuthentication(new BasicAuthentication(proxyURI, "ProxyRealm", "proxyUser", "proxyPass"));

// Server credentials.
auth.addAuthentication(new DigestAuthentication(serverURI, "ServerRealm", "serverUser", "serverPass"));

// Proxy configuration.
ProxyConfiguration proxyConfig = httpClient.getProxyConfiguration();
HttpProxy proxy = new HttpProxy("proxy.net", 8080);
proxyConfig.getProxies().add(proxy);

ContentResponse response = httpClient.newRequest(serverURI)
        .send()
        .get(5, TimeUnit.SECONDS);</code></pre></div></div>
<div class="paragraph"><p>The HTTP conversation for successful authentications on both the proxy and the server is the following:</p></div>
<div class="listingblock"><div class="content"><pre>Application  HttpClient                         Proxy                    Server
     |           |                                |                         |
     |--- GET --&gt;|------------- GET -------------&gt;|                         |
     |           |                                |                         |
     |           |&lt;----- 407 + Proxy-Authn -------|                         |
     |           |                                |                         |
     |           |------ GET + Proxy-Authz ------&gt;|                         |
     |           |                                |                         |
     |           |                                |---------- GET ---------&gt;|
     |           |                                |                         |
     |           |                                |&lt;--- 401 + WWW-Authn ----|
     |           |                                |                         |
     |           |&lt;------ 401 + WWW-Authn --------|                         |
     |           |                                |                         |
     |           |-- GET + Proxy-Authz + Authz --&gt;|                         |
     |           |                                |                         |
     |           |                                |------ GET + Authz -----&gt;|
     |           |                                |                         |
     |&lt;-- 200 ---|&lt;------------ 200 --------------|&lt;--------- 200 ----------|</pre></div></div>
<div class="paragraph"><p>The application does not receive events related to the responses with code 407 and 401 since they are handled internally by <code>HttpClient</code>.</p></div>
<div class="paragraph"><p>Similarly to the <a href="#http-client-authentication">authentication section</a>, the proxy authentication result and the server authentication result can be preempted to avoid, respectively, the 407 and 401 roundtrips.</p></div></div></div>
<div class="sect2"><h3 id="http-client-transport">Pluggable Transports</h3><div class="paragraph"><p>Jetty&#8217;s HTTP client can be configured to use different transports to carry the semantic of HTTP requests and responses.</p></div>
<div class="paragraph"><p>This means that the intention of a client to request resource <code>/index.html</code> using the <code>GET</code> method can be carried over the network in different formats.</p></div>
<div class="paragraph"><p>A HTTP client transport is the component that is in charge of converting a high-level, semantic, HTTP requests such as "GET resource /index.html" into the specific format understood by the server (for example, HTTP/2), and to convert the server response from the specific format (HTTP/2) into high-level, semantic objects that can be used by applications.</p></div>
<div class="paragraph"><p>In this way, applications are not aware of the actual protocol being used.
This allows them to write their logic against a high-level API that hides the details of the specific protocol being used over the network.</p></div>
<div class="paragraph"><p>The most common protocol format is HTTP/1.1, a text-based protocol with lines separated by <code>\r\n</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">GET /index.html HTTP/1.1\r\n
Host: domain.com\r\n
...
\r\n</code></pre></div></div>
<div class="paragraph"><p>However, the same request can be made using FastCGI, a binary protocol:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">x01 x01 x00 x01 x00 x08 x00 x00
x00 x01 x01 x00 x00 x00 x00 x00
x01 x04 x00 x01 xLL xLL x00 x00
x0C x0B  D   O   C   U   M   E
 N   T   _   U   R   I   /   i
 n   d   e   x   .   h   t   m
 l
...</code></pre></div></div>
<div class="paragraph"><p>Similarly, HTTP/2 is a binary protocol that transports the same information in a yet different format.</p></div>
<div class="sect3"><h4>HTTP/1.1 Transport</h4><div class="paragraph"><p>HTTP/1.1 is the default transport.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// No transport specified, using default.
HttpClient client = new HttpClient();
client.start();</code></pre></div></div>
<div class="paragraph"><p>If you want to customize the HTTP/1.1 transport, you can explicitly configure <code>HttpClient</code> in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">int selectors = 1;
HttpClientTransportOverHTTP transport = new HttpClientTransportOverHTTP(selectors);

HttpClient client = new HttpClient(transport, null);
client.start();</code></pre></div></div>
<div class="paragraph"><p>The example above allows you to customize the number of NIO selectors that <code>HttpClient</code> will be using.</p></div></div>
<div class="sect3"><h4>HTTP/2 Transport</h4><div class="paragraph"><p>The HTTP/2 transport can be configured in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">HTTP2Client h2Client = new HTTP2Client();
h2Client.setSelectors(1);
HttpClientTransportOverHTTP2 transport = new HttpClientTransportOverHTTP2(h2Client);

HttpClient client = new HttpClient(transport, null);
client.start();</code></pre></div></div>
<div class="paragraph"><p><code>HTTP2Client</code> is the lower-level client that provides an API based on HTTP/2 concepts such as <em>sessions</em>, <em>streams</em> and <em>frames</em> that are specific to HTTP/2.</p></div>
<div class="paragraph"><p><code>HttpClientTransportOverHTTP2</code> uses <code>HTTP2Client</code> to format high-level semantic HTTP requests ("GET resource /index.html") into the HTTP/2 specific format.</p></div></div>
<div class="sect3"><h4>FastCGI Transport</h4><div class="paragraph"><p>The FastCGI transport can be configured in this way:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">int selectors = 1;
String scriptRoot = "/var/www/wordpress";
HttpClientTransportOverFCGI transport = new HttpClientTransportOverFCGI(selectors, false, scriptRoot);

HttpClient client = new HttpClient(transport, null);
client.start();</code></pre></div></div>
<div class="paragraph"><p>In order to make requests using the FastCGI transport, you need to have a FastCGI server such as <a href="https://en.wikipedia.org/wiki/PHP#PHPFPM">PHP-FPM</a> (see also <a class="bare" href="http://php.net/manual/en/install.fpm.php">http://php.net/manual/en/install.fpm.php</a>).</p></div>
<div class="paragraph"><p>The FastCGI transport is primarily used by Jetty&#8217;s <a href="#fastcgi">FastCGI support</a> to serve PHP pages (WordPress for example).</p></div></div></div></div>
<div class="sect2"><h3 id="maven-and-jetty">Maven and Jetty</h3><div class="paragraph"><p>This chapter explains how to use Jetty with Maven and the Jetty Maven plugin.</p></div>
<div class="sect2"><h3 id="jetty-maven-helloworld">Using Maven</h3><div class="paragraph"><p><a href="http://maven.apache.org/">Apache Maven</a> is a software project management and comprehension tool.
Based on the concept of a project object model (POM), Maven can manage a project&#8217;s build, reporting and documentation from a central piece of information.</p></div>
<div class="paragraph"><p>It is an ideal tool to build a web application project, and such projects can use the <a href="#jetty-maven-plugin">jetty-maven-plugin</a> to easily run the web application and save time in development.
You can also use Maven to build, test and run a project which embeds Jetty.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Use of Maven and the jetty-maven-plugin is <strong>not</strong> required.
Using Maven for Jetty implementations is a popular choice, but users encouraged to manage their projects in whatever way suits their needs.
Other popular tools include Ant and Gradle.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>First we&#8217;ll have a look at a very simple HelloWorld java application that embeds Jetty, then a simple webapp which makes use of the <a href="#jetty-maven-plugin">jetty-maven-plugin</a> to speed up the development cycle.</p></div>
<div class="sect3"><h4 id="configuring-embedded-jetty-with-maven">Using Embedded Jetty with Maven</h4><div class="paragraph"><p>To understand the basic operations of building and running against Jetty, first review:</p></div>
<div class="ulist"><ul><li><p><a href="#advanced-embedding">Embedding with Jetty</a></p></li><li><p><a href="#jetty-helloworld">Jetty HelloWorld example</a></p></li></ul></div>
<div class="paragraph"><p>Maven uses convention over configuration, so it is best to use the project structure Maven recommends.
You can use <em><a href="#archetypes"><a href="http://maven.apache.org/guides/introduction/introduction-to-archetypes.html">archetypes</a></a></em> to quickly setup Maven projects, but we will set up the structure manually for this simple tutorial example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mkdir JettyMavenHelloWorld
&gt; cd JettyMavenHelloWorld
&gt; mkdir -p src/main/java/org/example</code></pre></div></div>
<div class="sect4"><h5 id="creating-helloworld-class">Creating the HelloWorld Class</h5><div class="paragraph"><p>Use an editor to create the file <code>src/main/java/org/example/HelloWorld.java</code> with the following contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">package org.example;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.ServletException;
import java.io.IOException;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;

public class HelloWorld extends AbstractHandler
{
    public void handle(String target,
                       Request baseRequest,
                       HttpServletRequest request,
                       HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html;charset=utf-8");
        response.setStatus(HttpServletResponse.SC_OK);
        baseRequest.setHandled(true);
        response.getWriter().println("&lt;h1&gt;Hello World&lt;/h1&gt;");
    }

    public static void main(String[] args) throws Exception
    {
        Server server = new Server(8080);
        server.setHandler(new HelloWorld());

        server.start();
        server.join();
    }
}</code></pre></div></div></div>
<div class="sect4"><h5 id="creating-embedded-pom-descriptor">Creating the POM Descriptor</h5><div class="paragraph"><p>The <code>pom.xml</code> file declares the project name and its dependencies.
Use an editor to create the file <code>pom.xml</code> in the <code>JettyMavenHelloWorld</code> directory with the following contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;org.example&lt;/groupId&gt;
  &lt;artifactId&gt;hello-world&lt;/artifactId&gt;
  &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;Jetty HelloWorld&lt;/name&gt;

  &lt;properties&gt;
      &lt;!-- Adapt this to a version found on
           https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-maven-plugin/
        --&gt;
      &lt;jettyVersion&gt;9.3.9.v20160517&lt;/jettyVersion&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;jetty-server&lt;/artifactId&gt;
      &lt;version&gt;${jettyVersion}&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;&lt;goals&gt;&lt;goal&gt;java&lt;/goal&gt;&lt;/goals&gt;&lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;mainClass&gt;org.example.HelloWorld&lt;/mainClass&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre></div></div></div>
<div class="sect4"><h5 id="buildng-and-running-embedded-helloworld">Building and Running Embedded HelloWorld</h5><div class="paragraph"><p>You can now compile and execute the HelloWorld class by using these commands:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mvn clean compile exec:java</code></pre></div></div>
<div class="paragraph"><p>You can point your browser to <code><a class="bare" href="http://localhost:8080">http://localhost:8080</a></code> to see the <em>Hello World</em> page.
You can observe what Maven is doing for you behind the scenes by using the <code>mvn dependency:tree</code> command, which reveals the transitive dependency resolved and downloaded as:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mvn dependency:tree
[INFO] Scanning for projects...
...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Jetty HelloWorld 0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ hello-world ---
...
[INFO] org.example:hello-world:jar:0.1-SNAPSHOT
[INFO] \- org.eclipse.jetty:jetty-server:jar:9.3.9.v20160517:compile
[INFO]    +- javax.servlet:javax.servlet-api:jar:3.1.0:compile
[INFO]    +- org.eclipse.jetty:jetty-http:jar:9.3.9.v20160517:compile
[INFO]    |  \- org.eclipse.jetty:jetty-util:jar:9.3.9.v20160517:compile
[INFO]    \- org.eclipse.jetty:jetty-io:jar:9.3.9.v20160517:compile
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.145 s
[INFO] Finished at: 2016-08-01T13:46:42-04:00
[INFO] Final Memory: 15M/209M
[INFO] ------------------------------------------------------------------------</code></pre></div></div></div></div>
<div class="sect3"><h4 id="developing-standard-webapp-with-jetty-and-maven">Developing a Standard WebApp with Jetty and Maven</h4><div class="paragraph"><p>The previous section demonstrated how to use Maven with an application that embeds Jetty.
Now we will examine instead how to develop a standard webapp with Maven and Jetty.
First create the Maven structure (you can use the maven webapp archetype instead if you prefer):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mkdir JettyMavenHelloWarApp
&gt; cd JettyMavenHelloWebApp
&gt; mkdir -p src/main/java/org/example
&gt; mkdir -p src/main/webapp/WEB-INF</code></pre></div></div>
<div class="sect4"><h5 id="creating-servlet">Creating a Servlet</h5><div class="paragraph"><p>Use an editor to create the file <code>src/main/java/org/example/HelloServlet.java</code> with the following contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">package org.example;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class HelloServlet extends HttpServlet
{
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException
    {
        response.setContentType("text/html");
        response.setStatus(HttpServletResponse.SC_OK);
        response.getWriter().println("&lt;h1&gt;Hello Servlet&lt;/h1&gt;");
        response.getWriter().println("session=" + request.getSession(true).getId());
    }
}</code></pre></div></div>
<div class="paragraph"><p>You need to declare this servlet in the deployment descriptor, so create the file <code>src/main/webapp/WEB-INF/web.xml</code> and add the following contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app
   xmlns="http://xmlns.jcp.org/xml/ns/javaee"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
   metadata-complete="false"
   version="3.1"&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;Hello&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.example.HelloServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Hello&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/hello/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre></div></div></div>
<div class="sect4"><h5 id="creating-plugin-pom-descriptor">Creating the POM Descriptor</h5><div class="paragraph"><p>The <code>pom.xml</code> file declares the project name and its dependencies.
Use an editor to create the file <code>pom.xml</code> with the following contents in the <code>JettyMavenHelloWarApp</code> directory, noting particularly the declaration of the <a href="#jetty-maven-plugin">jetty-maven-plugin</a>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;org.example&lt;/groupId&gt;
  &lt;artifactId&gt;hello-world&lt;/artifactId&gt;
  &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;
  &lt;name&gt;Jetty HelloWorld WebApp&lt;/name&gt;

  &lt;properties&gt;
      &lt;jettyVersion&gt;9.4.15-SNAPSHOT&lt;/jettyVersion&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
      &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
      &lt;version&gt;3.1.0&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
        &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;${jettyVersion}&lt;/version&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

&lt;/project&gt;</code></pre></div></div></div>
<div class="sect4"><h5 id="building-and-running-web-application">Building and Running the Web Application</h5><div class="paragraph"><p>Now you can both build and run the web application without needing to assemble it into a war by using the <a href="#jetty-maven-plugin">jetty-maven-plugin</a> via the command:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mvn jetty:run</code></pre></div></div>
<div class="paragraph"><p>You can see the static and dynamic content at <code><a class="bare" href="http://localhost:8080/hello">http://localhost:8080/hello</a></code></p></div>
<div class="paragraph"><p>There are a great deal of configuration options available for the jetty-maven-plugin to help you build and run your webapp.
The full reference is at <a href="#jetty-maven-plugin">Configuring the Jetty Maven Plugin</a>.</p></div></div>
<div class="sect4"><h5 id="building-war-file">Building a WAR file</h5><div class="paragraph"><p>You can create a Web Application Archive (WAR) file from the project with the command:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; mvn package</code></pre></div></div>
<div class="paragraph"><p>The resulting war file is in the <code>target</code> directory and may be deployed on any standard servlet server, including <a href="#configuring-deployment">Jetty</a>.</p></div></div></div></div>
<div class="sect2"><h3 id="jetty-maven-plugin">Configuring the Jetty Maven Plugin</h3><div class="paragraph"><p>The Jetty Maven plugin is useful for rapid development and testing.
You can add it to any webapp project that is structured according to the Maven defaults.
The plugin can then periodically scan your project for changes and automatically redeploy the webapp if any are found.
This makes the development cycle more productive by eliminating the build and deploy steps: you use your IDE to make changes to the project, and the running web container automatically picks them up, allowing you to test them straight away.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">You should use Maven 3.3+ for this plugin.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>While the Jetty Maven Plugin can be very useful for development we do not recommend its use in a production capacity.
In order for the plugin to work it needs to leverage many internal Maven apis and Maven itself it not a production deployment tool.
We recommend either the traditional distribution deployment approach or using <a href="#advanced-embedding">embedded Jetty.</a></p></div>
<div class="sect3"><h4 id="get-up-and-running">Quick Start: Get Up and Running</h4><div class="paragraph"><p>First, add <code>jetty-maven-plugin</code> to your <code>pom.xml</code> definition:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Then, from the same directory as your root <code>pom.xml</code>, type:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:run</code></pre></div></div>
<div class="paragraph"><p>This starts Jetty and serves up your project on <a class="bare" href="http://localhost:8080/">http://localhost:8080/</a>.</p></div>
<div class="paragraph"><p>Jetty will continue to run until you stop it.
While it runs it periodically scans for changes to your project files
If you save changes and recompile your class files, Jetty redeploys your webapp, and you can instantly test the changes that were just made.</p></div>
<div class="paragraph"><p>You can terminate the plugin with a <code>ctrl-c</code> in the terminal window where it is running.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">The classpath of the running Jetty instance and its deployed webapp are managed by Maven, and may not be exactly what you expect.
For example: a webapp&#8217;s dependent jars might be referenced via the local repository, not the <code>WEB-INF/lib</code> directory.</td></tr></table></div></blockquote></div></div>
<div class="sect3"><h4 id="running-and-deploying">Supported Goals</h4><div class="paragraph"><p>The Jetty Maven plugin has a number of distinct Maven goals.
Arguably the most useful is the <code>run</code> goal which runs Jetty on an unassembled webapp.
There are other goals which help you accomplish different tasks.
For example, you might need to run your webapp in a forked instance of Jetty rather than within the process running Maven; or you may need finer grained control over the maven lifecycle stage in which you wish to deploy your webapp.
There are different goals to accomplish these tasks, as well as several others.</p></div>
<div class="paragraph"><p>To see a list of all goals supported by the Jetty Maven plugin, do:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:help</code></pre></div></div>
<div class="paragraph"><p>To see the detailed list of parameters that can be configured for a particular goal, in addition to its description, do:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:help -Ddetail=true -Dgoal= &lt;goal name&gt;</code></pre></div></div></div>
<div class="sect3"><h4 id="configuring-jetty-container">Configuring the Jetty Container</h4><div class="paragraph"><p>These configuration elements set up the Jetty environment in which your webapp executes.
They are common to most goals:</p></div>
<div class="dlist"><dl><dt class="hdlist1">httpConnector</dt><dd><p>Optional.
If not specified, Jetty will create a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/ServerConnector.html">ServerConnector</a> instance listening on port 8080.
You can change this default port number by using the system property <code>jetty.http.port</code> on the command line, for example, <code>mvn -Djetty.http.port=9999 jetty:run</code>.
Alternatively, you can use this configuration element to set up the information for the ServerConnector.
The following are the valid configuration sub-elements:</p><div class="dlist"><dl><dt class="hdlist1">port</dt><dd><p>The port number for the connector to listen on.
By default it is 8080.</p></dd><dt class="hdlist1">host</dt><dd><p>The particular interface for the connector to listen on.
By default, all interfaces.</p></dd><dt class="hdlist1">name</dt><dd><p>The name of the connector, which is useful for <a href="#serving-webapp-from-particular-port">configuring contexts to respond only on particular connectors</a>.</p></dd><dt class="hdlist1">idleTimeout</dt><dd><p>Maximum idle time for a connection.</p><div class="paragraph"><p>You could instead configure the connectors in a standard <a href="#jetty-xml-config">jetty xml config file</a> and put its location into the <code>jettyXml</code> parameter.
Note that since Jetty 9.0 it is no longer possible to configure a <a href="#maven-config-https">https connector</a> directly in the pom.xml: you need to <a href="#maven-config-https">use jetty xml config files to do it</a>.</p></div></dd></dl></div></dd><dt class="hdlist1">jettyXml</dt><dd><p>Optional.
A comma separated list of locations of Jetty xml files to apply in addition to any plugin configuration parameters.
You might use it if you have other webapps, handlers, specific types of connectors etc., to deploy, or if you have other Jetty objects that you cannot configure from the plugin.</p></dd><dt class="hdlist1">scanIntervalSeconds</dt><dd><p>The pause in seconds between sweeps of the webapp to check for changes and automatically hot redeploy if any are detected.
<strong>By default this is 0, which disables hot deployment scanning.</strong>
A number greater than 0 enables it.</p></dd><dt class="hdlist1">reload</dt><dd><p>Default value is "automatic", used in conjunction with a non-zero <strong><em>`scanIntervalSeconds`</em></strong> causes automatic hot redeploy when changes are detected.
Set to "manual" instead to trigger scanning by typing a linefeed in the console running the plugin.
This might be useful when you are doing a series of changes that you want to ignore until you&#8217;re done.
In that use, use the <code>reload</code> parameter.</p></dd><dt class="hdlist1">dumpOnStart</dt><dd><p>Optional.
Default value is false.
If true, then jetty will dump out the server structure on start.</p></dd><dt class="hdlist1">loginServices</dt><dd><p>Optional.
A list of <code>org.eclipse.jetty.security.LoginService</code> implementations. Note that there is no default realm.
If you use a realm in your <code>web.xml</code> you can specify a corresponding realm here.
You could instead configure the login services in a jetty xml file and add its location to the <code>jettyXml</code> parameter.</p></dd><dt class="hdlist1">requestLog</dt><dd><p>Optional.
An implementation of the <code>org.eclipse.jetty.server.RequestLog</code> request log interface.
An implementation that respects the NCSA format is available as <code>org.eclipse.jetty.server.NCSARequestLog</code>.
There are three other ways to configure the RequestLog:</p><div class="ulist"><ul><li><p>In a jetty xml config file, as specified in the <code>jettyXml</code> parameter.</p></li><li><p>In a context xml config file, as specified in the <code>contextXml</code> parameter.</p></li><li><p>In the <code>webApp</code> element.</p></li></ul></div>
<div class="paragraph"><p>See <a href="#configuring-jetty-request-logs">Configuring Request Logs</a> for more information.</p></div></dd><dt class="hdlist1">server</dt><dd><p>Optional as of Jetty 9.3.1.
This would configure an instance of the <a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/java/org/eclipse/jetty/server/Server.java"><code>org.eclipse.jetty.server.Server</code></a> for the plugin to use, however it is usually NOT necessary to configure this, as the plugin will automatically configure one for you.
In particular, if you use the jettyXml element, then you generally DON&#8217;T want to define this element, as you are probably using the jettyXml file to configure up a Server with a special constructor argument, such as a custom threadpool.
If you define both a server element AND use a jetty xml element which points to a config file that has a line like <code>&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;</code> then the the xml configuration will override what you configure for the server in the <code>pom.xml</code>.</p></dd><dt class="hdlist1">stopPort</dt><dd><p>Optional.
Port to listen on for stop commands.
Useful to use in conjunction with the <a href="#jetty-stop-goal">stop</a> or <a href="#jetty-run-forked-goal">run-forked</a> goals.</p></dd><dt class="hdlist1">stopKey</dt><dd><p>Optional.
Used in conjunction with stopPort for stopping jetty.
Useful when used in conjunction with the stop or run-forked goals.</p></dd><dt class="hdlist1">systemProperties</dt><dd><p>Optional.
Allows you to configure System properties for the execution of the plugin.
For more information, see <a href="#sys_props">Setting System Properties</a>.</p></dd><dt class="hdlist1">systemPropertiesFile</dt><dd><p>Optional.
A file containing System properties to set for the execution of the plugin.
By default, settings that you make here <strong>do not</strong> override any system properties already set on the command line, by the JVM, or in the POM via <code>systemProperties</code>.
Read <a href="#sys_props">Setting System Properties</a> for how to force overrides.</p></dd><dt class="hdlist1">skip</dt><dd><p>Default is false.
If true, the execution of the plugin exits.
Same as setting the SystemProperty <code>-Djetty.skip</code> on the command line.
This is most useful when configuring Jetty for execution during integration testing and you want to skip the tests.</p></dd><dt class="hdlist1">useProvidedScope</dt><dd><p>Default value is <code>false</code>.
If true, the dependencies with <code>&lt;scope&gt;provided&lt;/scope&gt;</code> are placed onto the <em>container classpath</em>.
Be aware that this is NOT the webapp classpath, as "provided" indicates that these dependencies would normally be expected to be provided by the container.
You should very rarely ever need to use this.
Instead, you should copy the provided dependencies as explicit dependencies of the <code>plugin</code> instead.</p></dd><dt class="hdlist1">excludedGoals</dt><dd><p>Optional.
A list of Jetty plugin goal names that will cause the plugin to print an informative message and exit.
Useful if you want to prevent users from executing goals that you know cannot work with your project.</p></dd></dl></div>
<div class="sect4"><h5 id="maven-config-https">Configuring a Https Connector</h5><div class="paragraph"><p>In order to configure an HTTPS connector, you need to use jetty xml configuration files.
This example uses files copied directly from the jetty distribution etc/ directory, although you can of course make up your own xml file or files.
We will use the following files:</p></div>
<div class="dlist"><dl><dt class="hdlist1">jetty.xml</dt><dd><p>Sets up various characteristics of the <a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/java/org/eclipse/jetty/server/Server.java"><code>org.eclipse.jetty.server.Server</code></a> instance for the plugin to use.
Importantly, it sets up the <a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/java/org/eclipse/jetty/server/HttpConfiguration.java"><code>org.eclipse.jetty.server.HttpConfiguration</code></a> element that we can refer to in subsequent xml files that configure the connectors.
Below is the relevant section taken from <a href="https://github.com/eclipse/jetty.project/tree/master/jetty-server/src/main/config/etc/jetty.xml">jetty.xml</a>.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;
  ...
    &lt;New id="httpConfig" class="org.eclipse.jetty.server.HttpConfiguration"&gt;
      &lt;Set name="secureScheme"&gt;&lt;Property name="jetty.httpConfig.secureScheme" default="https" /&gt;&lt;/Set&gt;
      &lt;Set name="securePort"&gt;&lt;Property name="jetty.httpConfig.securePort" deprecated="jetty.secure.port" default="8443" /&gt;&lt;/Set&gt;
      &lt;Set name="outputBufferSize"&gt;&lt;Property name="jetty.httpConfig.outputBufferSize" deprecated="jetty.output.buffer.size" default="32768" /&gt;&lt;/Set&gt;
      &lt;Set name="outputAggregationSize"&gt;&lt;Property name="jetty.httpConfig.outputAggregationSize" deprecated="jetty.output.aggregation.size" default="8192" /&gt;&lt;/Set&gt;
      &lt;Set name="requestHeaderSize"&gt;&lt;Property name="jetty.httpConfig.requestHeaderSize" deprecated="jetty.request.header.size" default="8192" /&gt;&lt;/Set&gt;
      &lt;Set name="responseHeaderSize"&gt;&lt;Property name="jetty.httpConfig.responseHeaderSize" deprecated="jetty.response.header.size" default="8192" /&gt;&lt;/Set&gt;
      &lt;Set name="sendServerVersion"&gt;&lt;Property name="jetty.httpConfig.sendServerVersion" deprecated="jetty.send.server.version" default="true" /&gt;&lt;/Set&gt;
      &lt;Set name="sendDateHeader"&gt;&lt;Property name="jetty.httpConfig.sendDateHeader" deprecated="jetty.send.date.header" default="false" /&gt;&lt;/Set&gt;
      &lt;Set name="headerCacheSize"&gt;&lt;Property name="jetty.httpConfig.headerCacheSize" default="4096" /&gt;&lt;/Set&gt;
      &lt;Set name="delayDispatchUntilContent"&gt;&lt;Property name="jetty.httpConfig.delayDispatchUntilContent" deprecated="jetty.delayDispatchUntilContent" default="true"/&gt;&lt;/Set&gt;
      &lt;Set name="maxErrorDispatches"&gt;&lt;Property name="jetty.httpConfig.maxErrorDispatches" default="10"/&gt;&lt;/Set&gt;
      &lt;Set name="blockingTimeout"&gt;&lt;Property name="jetty.httpConfig.blockingTimeout" default="-1"/&gt;&lt;/Set&gt;
      &lt;Set name="persistentConnectionsEnabled"&gt;&lt;Property name="jetty.httpConfig.persistentConnectionsEnabled" default="true"/&gt;&lt;/Set&gt;
      &lt;Set name="cookieCompliance"&gt;&lt;Call class="org.eclipse.jetty.http.CookieCompliance" name="valueOf"&gt;&lt;Arg&gt;&lt;Property name="jetty.httpConfig.cookieCompliance" default="RFC6265"/&gt;&lt;/Arg&gt;&lt;/Call&gt;&lt;/Set&gt;

      &lt;!-- Uncomment to enable handling of X-Forwarded- style headers
      &lt;Call name="addCustomizer"&gt;
        &lt;Arg&gt;&lt;New class="org.eclipse.jetty.server.ForwardedRequestCustomizer"/&gt;&lt;/Arg&gt;
      &lt;/Call&gt;
      --&gt;
    &lt;/New&gt;
  ...
&lt;/Configure&gt;</code></pre></div></div></dd><dt class="hdlist1">jetty-ssl.xml</dt><dd><p>Sets up ssl which will be used by the https connector.
Here&#8217;s the <code>jetty-ssl.xml</code> file from the jetty-distribution:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;!-- ============================================================= --&gt;
&lt;!-- Base SSL configuration                                        --&gt;
&lt;!-- This configuration needs to be used together with 1 or more   --&gt;
&lt;!-- of jetty-https.xml or jetty-http2.xml                         --&gt;
&lt;!-- ============================================================= --&gt;
&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;

  &lt;!-- =========================================================== --&gt;
  &lt;!-- Add a SSL Connector with no protocol factories              --&gt;
  &lt;!-- =========================================================== --&gt;
  &lt;Call  name="addConnector"&gt;
    &lt;Arg&gt;
      &lt;New id="sslConnector" class="org.eclipse.jetty.server.ServerConnector"&gt;
        &lt;Arg name="server"&gt;&lt;Ref refid="Server" /&gt;&lt;/Arg&gt;
        &lt;Arg name="acceptors" type="int"&gt;&lt;Property name="jetty.ssl.acceptors" deprecated="ssl.acceptors" default="-1"/&gt;&lt;/Arg&gt;
        &lt;Arg name="selectors" type="int"&gt;&lt;Property name="jetty.ssl.selectors" deprecated="ssl.selectors" default="-1"/&gt;&lt;/Arg&gt;
        &lt;Arg name="factories"&gt;
          &lt;Array type="org.eclipse.jetty.server.ConnectionFactory"&gt;
            &lt;!-- uncomment to support proxy protocol
            &lt;Item&gt;
              &lt;New class="org.eclipse.jetty.server.ProxyConnectionFactory"/&gt;
            &lt;/Item&gt;--&gt;
          &lt;/Array&gt;
        &lt;/Arg&gt;

        &lt;Set name="host"&gt;&lt;Property name="jetty.ssl.host" deprecated="jetty.host" /&gt;&lt;/Set&gt;
        &lt;Set name="port"&gt;&lt;Property name="jetty.ssl.port" deprecated="ssl.port" default="8443" /&gt;&lt;/Set&gt;
        &lt;Set name="idleTimeout"&gt;&lt;Property name="jetty.ssl.idleTimeout" deprecated="ssl.timeout" default="30000"/&gt;&lt;/Set&gt;
        &lt;Set name="acceptorPriorityDelta"&gt;&lt;Property name="jetty.ssl.acceptorPriorityDelta" deprecated="ssl.acceptorPriorityDelta" default="0"/&gt;&lt;/Set&gt;
        &lt;Set name="acceptQueueSize"&gt;&lt;Property name="jetty.ssl.acceptQueueSize" deprecated="ssl.acceptQueueSize" default="0"/&gt;&lt;/Set&gt;
        &lt;Get name="SelectorManager"&gt;
          &lt;Set name="connectTimeout"&gt;&lt;Property name="jetty.ssl.connectTimeout" default="15000"/&gt;&lt;/Set&gt;
        &lt;/Get&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;

  &lt;!-- =========================================================== --&gt;
  &lt;!-- Create a TLS specific HttpConfiguration based on the        --&gt;
  &lt;!-- common HttpConfiguration defined in jetty.xml               --&gt;
  &lt;!-- Add a SecureRequestCustomizer to extract certificate and    --&gt;
  &lt;!-- session information                                         --&gt;
  &lt;!-- =========================================================== --&gt;
  &lt;New id="sslHttpConfig" class="org.eclipse.jetty.server.HttpConfiguration"&gt;
    &lt;Arg&gt;&lt;Ref refid="httpConfig"/&gt;&lt;/Arg&gt;
    &lt;Call name="addCustomizer"&gt;
      &lt;Arg&gt;
        &lt;New class="org.eclipse.jetty.server.SecureRequestCustomizer"&gt;
          &lt;Arg name="sniHostCheck" type="boolean"&gt;&lt;Property name="jetty.ssl.sniHostCheck" default="true"/&gt;&lt;/Arg&gt;
          &lt;Arg name="stsMaxAgeSeconds" type="int"&gt;&lt;Property name="jetty.ssl.stsMaxAgeSeconds" default="-1"/&gt;&lt;/Arg&gt;
          &lt;Arg name="stsIncludeSubdomains" type="boolean"&gt;&lt;Property name="jetty.ssl.stsIncludeSubdomains" default="false"/&gt;&lt;/Arg&gt;
        &lt;/New&gt;
      &lt;/Arg&gt;
    &lt;/Call&gt;
  &lt;/New&gt;

&lt;/Configure&gt;</code></pre></div></div></dd><dt class="hdlist1">jetty-https.xml</dt><dd><p>Set up the https connector using the HttpConfiguration from <code>jetty.xml</code> and the ssl configuration from <code>jetty-ssl.xml</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;!-- ============================================================= --&gt;
&lt;!-- Configure a HTTPS connector.                                  --&gt;
&lt;!-- This configuration must be used in conjunction with jetty.xml --&gt;
&lt;!-- and jetty-ssl.xml.                                            --&gt;
&lt;!-- ============================================================= --&gt;
&lt;Configure id="sslConnector" class="org.eclipse.jetty.server.ServerConnector"&gt;

  &lt;Call name="addIfAbsentConnectionFactory"&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.server.SslConnectionFactory"&gt;
        &lt;Arg name="next"&gt;http/1.1&lt;/Arg&gt;
        &lt;Arg name="sslContextFactory"&gt;&lt;Ref refid="sslContextFactory"/&gt;&lt;/Arg&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;

  &lt;Call name="addConnectionFactory"&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.server.HttpConnectionFactory"&gt;
        &lt;Arg name="config"&gt;&lt;Ref refid="sslHttpConfig" /&gt;&lt;/Arg&gt;
        &lt;Arg name="compliance"&gt;&lt;Call class="org.eclipse.jetty.http.HttpCompliance" name="valueOf"&gt;&lt;Arg&gt;&lt;Property name="jetty.http.compliance" default="RFC7230"/&gt;&lt;/Arg&gt;&lt;/Call&gt;&lt;/Arg&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;

&lt;/Configure&gt;</code></pre></div></div></dd></dl></div>
<div class="paragraph"><p>Now you need to let the plugin know to apply the files above:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;jettyXml&gt;jetty.xml,jetty-ssl.xml,jetty-https.xml&lt;/jettyXml&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="quoteblock"><blockquote><div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">Just as with an installed distribution of Jetty, the ordering of the xml files is significant.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>You can also use Jetty xml files to configure a http connector for the plugin to use.
Here we use the same <code>jetty-http.xml</code> file from the Jetty distribution:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;!-- ============================================================= --&gt;
&lt;!-- Configure the Jetty Server instance with an ID "Server"       --&gt;
&lt;!-- by adding a HTTP connector.                                   --&gt;
&lt;!-- This configuration must be used in conjunction with jetty.xml --&gt;
&lt;!-- ============================================================= --&gt;
&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;

  &lt;!-- =========================================================== --&gt;
  &lt;!-- Add a HTTP Connector.                                       --&gt;
  &lt;!-- Configure an o.e.j.server.ServerConnector with a single     --&gt;
  &lt;!-- HttpConnectionFactory instance using the common httpConfig  --&gt;
  &lt;!-- instance defined in jetty.xml                               --&gt;
  &lt;!--                                                             --&gt;
  &lt;!-- Consult the javadoc of o.e.j.server.ServerConnector and     --&gt;
  &lt;!-- o.e.j.server.HttpConnectionFactory for all configuration    --&gt;
  &lt;!-- that may be set here.                                       --&gt;
  &lt;!-- =========================================================== --&gt;
  &lt;Call name="addConnector"&gt;
    &lt;Arg&gt;
      &lt;New id="httpConnector" class="org.eclipse.jetty.server.ServerConnector"&gt;
        &lt;Arg name="server"&gt;&lt;Ref refid="Server" /&gt;&lt;/Arg&gt;
        &lt;Arg name="acceptors" type="int"&gt;&lt;Property name="jetty.http.acceptors" deprecated="http.acceptors" default="-1"/&gt;&lt;/Arg&gt;
        &lt;Arg name="selectors" type="int"&gt;&lt;Property name="jetty.http.selectors" deprecated="http.selectors" default="-1"/&gt;&lt;/Arg&gt;
        &lt;Arg name="factories"&gt;
          &lt;Array type="org.eclipse.jetty.server.ConnectionFactory"&gt;
            &lt;Item&gt;
              &lt;New class="org.eclipse.jetty.server.HttpConnectionFactory"&gt;
                &lt;Arg name="config"&gt;&lt;Ref refid="httpConfig" /&gt;&lt;/Arg&gt;
                &lt;Arg name="compliance"&gt;&lt;Call class="org.eclipse.jetty.http.HttpCompliance" name="valueOf"&gt;&lt;Arg&gt;&lt;Property name="jetty.http.compliance" default="RFC7230_LEGACY"/&gt;&lt;/Arg&gt;&lt;/Call&gt;&lt;/Arg&gt;
              &lt;/New&gt;
            &lt;/Item&gt;
          &lt;/Array&gt;
        &lt;/Arg&gt;
        &lt;Set name="host"&gt;&lt;Property name="jetty.http.host" deprecated="jetty.host" /&gt;&lt;/Set&gt;
        &lt;Set name="port"&gt;&lt;Property name="jetty.http.port" deprecated="jetty.port" default="8080" /&gt;&lt;/Set&gt;
        &lt;Set name="idleTimeout"&gt;&lt;Property name="jetty.http.idleTimeout" deprecated="http.timeout" default="30000"/&gt;&lt;/Set&gt;
        &lt;Set name="acceptorPriorityDelta"&gt;&lt;Property name="jetty.http.acceptorPriorityDelta" deprecated="http.acceptorPriorityDelta" default="0"/&gt;&lt;/Set&gt;
        &lt;Set name="acceptQueueSize"&gt;&lt;Property name="jetty.http.acceptQueueSize" deprecated="http.acceptQueueSize" default="0"/&gt;&lt;/Set&gt;
        &lt;Get name="SelectorManager"&gt;
          &lt;Set name="connectTimeout"&gt;&lt;Property name="jetty.http.connectTimeout" default="15000"/&gt;&lt;/Set&gt;
        &lt;/Get&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;

&lt;/Configure&gt;</code></pre></div></div>
<div class="paragraph"><p>Now we add it to the list of configs for the plugin to apply:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;jettyXml&gt;jetty.xml,jetty-http.xml,jetty-ssl.xml,jetty-https.xml&lt;/jettyXml&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Alternatively, you can use the <a href="#maven-http-connector"><strong>httpConnector</strong></a> configuration element inside the pom instead as described above.</p></div></div></div>
<div class="sect3"><h4 id="configuring-your-webapp">Configuring Your WebApp</h4><div class="paragraph"><p>These configuration parameters apply to your webapp.
They are common to almost all goals.</p></div>
<div class="dlist"><dl><dt class="hdlist1">webApp</dt><dd><p>This is an instance of <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/maven/plugin/JettyWebAppContext.html">org.eclipse.jetty.maven.plugin.JettyWebAppContext</a>, which is an extension to the class  <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.hml"><code>org.eclipse.jetty.webapp.WebAppContext</code></a>.
You can use any of the setter methods on this object to configure your webapp.
Here are a few of the most useful ones:</p><div class="dlist"><dl><dt class="hdlist1">contextPath</dt><dd><p>The context path for your webapp. By default, this is set to <code>/</code>.
If using a custom value for this parameter, you probably want to include the leading <code>/</code>, example <code>/mycontext</code>.</p></dd><dt class="hdlist1">descriptor</dt><dd><p>The path to the <code>web.xml</code> file for your webapp.</p></dd><dt class="hdlist1">defaultsDescriptor</dt><dd><p>The path to a <code>webdefault.xml</code> file that will be applied to your webapp before the <code>web.xml</code>.
If you don&#8217;t supply one, Jetty uses a default file baked into the <code>jetty-webapp.jar</code>.</p></dd><dt class="hdlist1">overrideDescriptor</dt><dd><p>The path to a <code>web.xml</code> file that Jetty applies after reading your <code>web.xml</code>.
You can use this to replace or add configuration.</p></dd><dt class="hdlist1">tempDirectory</dt><dd><p>The path to a dir that Jetty can use to expand or copy jars and jsp compiles when your webapp is running.
The default is <code>${project.build.outputDirectory}/tmp</code>.</p></dd><dt class="hdlist1">baseResource</dt><dd><p>The path from which Jetty serves static resources.
Defaults to <code>src/main/webapp</code>.</p></dd><dt class="hdlist1">resourceBases</dt><dd><p>Use instead of <code>baseResource</code> if you have multiple directories from which you want to serve static content.
This is an array of directory names.</p></dd><dt class="hdlist1">baseAppFirst</dt><dd><p>Defaults to "true".
Controls whether any overlaid wars are added before or after the original base resource(s) of the webapp.
See the section on <a href="#using-overlaid-wars">overlaid wars</a> for more information.</p></dd><dt class="hdlist1">containerIncludeJarPattern</dt><dd><p>Defaults to <code>.<strong>/javax.servlet-[<sup>/]</strong>\.jar$|.<strong>/servlet-api-[</sup>/]</strong>\.jar$|.<strong>javax.servlet.jsp.jstl-[^/]</strong>\.jar|.<strong>taglibs-standard-impl-.</strong>\.jar</code>.
This is a pattern that is applied to the names of the jars on the container&#8217;s classpath (ie the classpath of the plugin, not that of the webapp) that should be scanned for fragments, tlds, annotations etc.
This is analogous to the context attribute <a href="#container-include-jar-pattern">org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</a> that is documented <a href="#container-include-jar-pattern">here</a>.
You can define extra patterns of jars that will be included in the scan.</p></dd><dt class="hdlist1">webInfIncludeJarPattern</dt><dd><p>Defaults to matching <em>all</em> of the dependency jars for the webapp (ie the equivalent of WEB-INF/lib).
You can make this pattern more restrictive to only match certain jars by using this setter.
This is analogous to the context attribute <a href="#web-inf-include-jar-pattern">org.eclipse.jetty.server.webapp.WebInfIncludeJarPattern</a> that is documented <a href="#web-inf-include-jar-pattern">here</a>.</p></dd></dl></div></dd><dt class="hdlist1">contextXml</dt><dd><p>The path to a context xml file that is applied to your webapp AFTER the <code>webApp</code> element.</p></dd></dl></div></div>
<div class="sect3"><h4 id="jetty-run-goal">jetty:run</h4><div class="paragraph"><p>The <code>run</code> goal runs on a webapp that does not have to be built into a WAR.
Instead, Jetty deploys the webapp from its sources.
It looks for the constituent parts of a webapp in the Maven default project locations, although you can override these in the plugin configuration.
For example, by default it looks for:</p></div>
<div class="ulist"><ul><li><p>resources in <code>${project.basedir}/src/main/webapp</code></p></li><li><p>classes in <code>${project.build.outputDirectory}</code></p></li><li><p><code>web.xml</code> in <code>${project.basedir}/src/main/webapp/WEB-INF/</code></p></li></ul></div>
<div class="paragraph"><p>The plugin automatically ensures the classes are rebuilt and up-to-date before deployment.
If you change the source of a class and your IDE automatically compiles it in the background, the plugin picks up the changed class.</p></div>
<div class="paragraph"><p>You do not need to assemble the webapp into a WAR, saving time during the development cycle.
Once invoked, you can configure the plugin to run continuously, scanning for changes in the project and automatically performing a hot redeploy when necessary.
Any changes you make are immediately reflected in the running instance of Jetty, letting you quickly jump from coding to testing, rather than going through the cycle of: code, compile, reassemble, redeploy, test.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">As of Jetty 9.4.7, when using jetty:run in a multi-module build, it is no longer necessary to build each of the modules that form dependencies of the webapp first.
Thus, if your webapp depends on other modules in your project and they are present in the reactor at the same time, jetty will use their compiled classes rather than their jar files from your local maven repository.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>Here is an example, which turns on scanning for changes every ten seconds, and sets the webapp context path to <code>/test</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="sect4"><h5 id="configuring-additional-parameters">Configuration</h5><div class="paragraph"><p>In addition to the <code>webApp</code> element that is common to most goals, the <code>jetty:run</code> goal supports:</p></div>
<div class="dlist"><dl><dt class="hdlist1">classesDirectory</dt><dd><p>Location of your compiled classes for the webapp.
You should rarely need to set this parameter.
Instead, you should set <code>build outputDirectory</code> in your <code>pom.xml</code>.</p></dd><dt class="hdlist1">testClassesDirectory</dt><dd><p>Location of the compiled test classes for your webapp. By default this is <code>${project.build.testOutputDirectory}</code>.</p></dd><dt class="hdlist1">useTestScope</dt><dd><p>If true, the classes from <code>testClassesDirectory</code> and dependencies of scope "test" are placed first on the classpath.
By default this is false.</p></dd><dt class="hdlist1">webAppSourceDirectory</dt><dd><p>By default, this is set to <code>${project.basedir}/src/main/webapp</code>.
If your static sources are in a different location, set this parameter accordingly.</p></dd><dt class="hdlist1">jettyEnvXml</dt><dd><p>Optional.
Location of a <code>jetty-env.xml</code> file, which allows you to make JNDI bindings that satisfy <code>env-entry</code>, <code>resource-env-ref</code>, and <code>resource-ref</code> linkages in the <code>web.xml</code> that are scoped  only to the webapp and not shared with other webapps that you might be deploying at the same time (for example, by using a ` jettyConfig` file).</p></dd><dt class="hdlist1">scanTargets</dt><dd><p>Optional.
A list of files and directories to periodically scan in addition to those the plugin automatically scans.</p></dd><dt class="hdlist1">scanTargetPatterns</dt><dd><p>Optional.
If you have a long list of extra files you want scanned, it is more convenient to use pattern matching expressions to specify them instead of enumerating them with the <code>scanTargetsList</code> of <code>scanTargetPatterns</code>, each consisting of a directory, and including and/or excluding parameters to specify the file matching patterns.</p></dd><dt class="hdlist1">scanClassesPattern</dt><dd><p>Since 9.3.0.
Optional.
Include and exclude patterns that can be applied to the classesDirectory for the purposes of scanning, it does <strong>not</strong> affect the classpath.
If a file or directory is excluded by the patterns then a change in that file (or subtree in the case of a directory) is ignored and will not cause the webapp to redeploy.
Patterns are specified as a relative path using a glob-like syntax as described in the <a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-">javadoc</a> for <a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-">FileSystem.getPathMatcher</a>.</p></dd><dt class="hdlist1">scanTestClassesPattern</dt><dd><p>Since 9.3.0.
Optional.
Include and exclude patterns that can be applied to the testClassesDirectory for the purposes of scanning, it does <strong>not</strong> affect the classpath.
If a file or directory is excluded by the patterns then a change in that file (or subtree in the case of a directory) is ignored and will not cause the webapp to redeploy.
Patterns are specified as a relative path using a glob-like syntax as described in the <a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-">javadoc</a> for <a href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-">FileSystem.getPathMatcher</a>.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s an example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
...
  &lt;plugins&gt;
...
    &lt;plugin&gt;
      &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
      &lt;configuration&gt;
        &lt;webAppSourceDirectory&gt;${project.basedir}/src/staticfiles&lt;/webAppSourceDirectory&gt;
        &lt;webApp&gt;
          &lt;contextPath&gt;/&lt;/contextPath&gt;
          &lt;descriptor&gt;${project.basedir}/src/over/here/web.xml&lt;/descriptor&gt;
          &lt;jettyEnvXml&gt;${project.basedir}/src/over/here/jetty-env.xml&lt;/jettyEnvXml&gt;
        &lt;/webApp&gt;
        &lt;classesDirectory&gt;${project.basedir}/somewhere/else&lt;/classesDirectory&gt;
        &lt;scanClassesPattern&gt;
          &lt;excludes&gt;
             &lt;exclude&gt;**/Foo.class&lt;/exclude&gt;
          &lt;/excludes&gt;
        &lt;/scanClassesPattern&gt;
        &lt;scanTargets&gt;
          &lt;scanTarget&gt;src/mydir&lt;/scanTarget&gt;
          &lt;scanTarget&gt;src/myfile.txt&lt;/scanTarget&gt;
        &lt;/scanTargets&gt;
        &lt;scanTargetPatterns&gt;
          &lt;scanTargetPattern&gt;
            &lt;directory&gt;src/other-resources&lt;/directory&gt;
            &lt;includes&gt;
              &lt;include&gt;**/*.xml&lt;/include&gt;
              &lt;include&gt;**/*.properties&lt;/include&gt;
            &lt;/includes&gt;
            &lt;excludes&gt;
              &lt;exclude&gt;**/myspecial.xml&lt;/exclude&gt;
              &lt;exclude&gt;**/myspecial.properties&lt;/exclude&gt;
            &lt;/excludes&gt;
          &lt;/scanTargetPattern&gt;
        &lt;/scanTargetPatterns&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
...
&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>If, for whatever reason, you cannot run on an unassembled webapp, the goals <code>run-war</code> and <code>run-exploded</code> work on unassembled webapps.</p></div></div></div>
<div class="sect3"><h4 id="running-assembled-webapp-as-war">jetty:run-war</h4><div class="paragraph"><p>This goal first packages your webapp as a WAR file and then deploys it to Jetty.
If you set a non-zero <code>scanInterval</code>, Jetty watches your <code>pom.xml</code> and the WAR file; if either changes, it redeploys the war.</p></div>
<div class="sect4"><h5 id="configuring-war">Configuration</h5><div class="dlist"><dl><dt class="hdlist1">war</dt><dd><p>The location of the built WAR file. This defaults to <code>${project.build.directory}/${project.build.finalName}.war</code>.
If this is not sufficient, set it to your custom location.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s how to set it:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
...
  &lt;plugins&gt;
...
    &lt;plugin&gt;
      &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
      &lt;configuration&gt;
        &lt;war&gt;${project.basedir}/target/mycustom.war&lt;/war&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/project&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="running-assembled-webapp-as-expanded-war">jetty:run-exploded</h4><div class="paragraph"><p>The run-exploded goal first assembles your webapp into an exploded WAR file and then deploys it to Jetty.
If you set a non-zero <code>scanInterval</code>, Jetty watches your <code>pom.xml,`WEB-INF/lib</code>, <code>WEB-INF/</code> and <code>WEB-INF/web.xml</code> for changes and redeploys when necessary.</p></div>
<div class="sect4"><h5 id="configuring-exploded-war">Configuration</h5><div class="dlist"><dl><dt class="hdlist1">war</dt><dd><p>The location of the exploded WAR.
This defaults to <code>${project.build.directory}/${project.build.finalName}</code>, but you can override the default by setting this parameter.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s how to set it:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
...
  &lt;plugins&gt;
...
    &lt;plugin&gt;
      &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
      &lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;
      &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
      &lt;configuration&gt;
        &lt;war&gt;${project.basedir}/target/myfunkywebapp&lt;/war&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/project&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="deploy-war-running-pre-assembled-war">jetty:deploy-war</h4><div class="paragraph"><p>This is basically the same as <code>jetty:run-war</code>, but without assembling the WAR of the current module - you can nominate the location of any war to run.
Unlike <code>run-war</code>, the phase in which this plugin executes is not bound to the "package" phase - you may bind it to any phase to use it.</p></div>
<div class="sect4"><h5>Configuration</h5><div class="dlist"><dl><dt class="hdlist1">war</dt><dd><p>The location of the WAR file. This defaults to <code>${project.build.directory}/${project.build.finalName}</code>, but you can override the default by setting this parameter.</p></dd><dt class="hdlist1">daemon</dt><dd><p>If true, this plugin will start Jetty but let the build continue.
This is useful if you want to start jetty as an execution binding in a particular phase and then stop it in another.
Alternatively, you can set this parameter to false, in which case Jetty will block and you will need to use a ctrl-c to stop it.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s the configuration:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
...
  &lt;plugins&gt;
...
  &lt;plugin&gt;
    &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
    &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
    &lt;configuration&gt;
      &lt;war&gt;/opt/special/some-app.war&lt;/war&gt;
      &lt;stopKey&gt;alpha&lt;/stopKey&gt;
      &lt;stopPort&gt;9099&lt;/stopPort&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;start-jetty&lt;/id&gt;
        &lt;phase&gt;test-compile&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;deploy-war&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;stop-jetty&lt;/id&gt;
        &lt;phase&gt;test&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;stop&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
     &lt;/executions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/project&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="jetty-run-forked-goal">jetty:run-forked</h4><div class="paragraph"><p>This goal allows you to start the webapp in a new JVM, optionally passing arguments to that new JVM.
This goal supports mostly the same configuration parameters as the <code>jetty:run</code> goal with a couple of extras to help configure the forked process.
Unlike the <code>jetty:run</code> goal, the <code>jetty:run-forked</code> goal will not scan the webapp for changes and redeploy.</p></div>
<div class="sect4"><h5>Configuration</h5><div class="paragraph"><p>The available configuration parameters - in addition to those for the <code>jetty:run</code> goal - are:</p></div>
<div class="dlist"><dl><dt class="hdlist1">jvmArgs</dt><dd><p>Optional.
A string representing arbitrary arguments to pass to the forked JVM.</p></dd><dt class="hdlist1">env</dt><dd><p>Optional.
Map of key/value pairs to pass as environment to the forked JVM.</p></dd><dt class="hdlist1">waitForChild</dt><dd><p>Default is <code>true</code>.
This causes the parent process to wait for the forked process to exit.
In this case you can use <code>ctrl-c</code> to terminate both processes.
It is more useful to set it to <code>false</code>, in which case the parent process terminates whilst leaving the child process running.
You use the <code>jetty:stop</code> goal to stop the child process.
In the case where <code>waitForChild</code> is <code>false</code>, the output from the child process is written to <code>target/jetty.out</code>.</p></dd><dt class="hdlist1">maxChildChecks</dt><dd><p>Default is <code>50</code>.
This is maximum number of times the parent process checks to see if the child process has started.
Only relevant if <code>waitForChild</code> is <code>false</code>.</p></dd><dt class="hdlist1">maxChildCheckInterval</dt><dd><p>Default is <code>100</code>.
This is the time in milliseconds between checks to see if the child process has started.
Only relevant if <code>waitForChild</code> is <code>false</code>.</p></dd><dt class="hdlist1">forkWebXml</dt><dd><p>Default is <code>target/fork-web.xml</code>.
This is the name of the file into which jetty generates the effective web.xml for use by the child process.</p></dd><dt class="hdlist1">javaPath</dt><dd><p>Default will be your <code>${java.home}/bin/java</code>
This the java executable used to start the child process</p></dd></dl></div>
<div class="paragraph"><p>The following <code>jetty:run</code> parameters are NOT applicable:</p></div>
<div class="ulist"><ul><li><p><strong>scanTargets</strong></p></li><li><p><strong>scanTargetPatterns</strong></p></li><li><p><strong>scanClassesPattern</strong></p></li><li><p><strong>scanTestClassesPattern</strong></p></li></ul></div>
<div class="paragraph"><p>Some of the container configuration parameters are <strong>NOT</strong> available with this goal:</p></div>
<div class="dlist"><dl><dt class="hdlist1">scanIntervalSeconds</dt><dd><p>Not supported.
The forked jetty will not monitor and redeploy the webapp.</p></dd><dt class="hdlist1">reload</dt><dd><p>Not supported.
The forked jetty will not redeploy the webapp.</p></dd><dt class="hdlist1">httpConnector</dt><dd><p>Not supported.
To define custom connectors use a jetty xml file instead.</p></dd><dt class="hdlist1">loginServices</dt><dd><p>Not supported.
To define LoginServices use a jetty xml or context xml file instead.</p></dd><dt class="hdlist1">requestLog</dt><dd><p>Not supported.
To define a RequestLog setup, use a jetty xml or context xml file instead.</p></dd><dt class="hdlist1">systemProperties</dt><dd><p>Not supported.
Use the <code>jvmArgs</code> parameter to pass system properties to the forked process.</p></dd></dl></div>
<div class="paragraph"><p>To deploy your unassembled web app to Jetty running in a new JVM:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:run-forked</code></pre></div></div>
<div class="paragraph"><p>Jetty continues to execute until you either:</p></div>
<div class="ulist"><ul><li><p>Press <code>ctrl-c</code> in the terminal window to stop the plugin, which also stops the forked JVM (only if you started with <code>waitForChild=true</code>)</p></li><li><p>Use <code>jetty:stop</code> to stop the forked JVM, which also stops the plugin.</p></li></ul></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">If you want to set a custom port for the Jetty connector you need to specify it in a <code>jetty xml</code> file rather than setting the connector and port tags.
You can specify the location of the <code>jetty.xml</code> using the <code>jettyXml</code> parameter.</td></tr></table></div></blockquote></div></div></div>
<div class="sect3"><h4 id="jetty-run-distro-goal">jetty:run-distro</h4><div class="paragraph"><p>Introduced in Jetty 9.4.8, this goal allows you to execute your unassembled webapp in a local distribution of Jetty.
This can be useful if your webapp requires a highly customized environment in which to run.
If your webapp is designed to run in the jetty distribution in production, then this goal is the closest approximation to that environment.</p></div>
<div class="paragraph"><p>Similar to the <code>jetty:run-forked</code> goal, this goal will fork a child process in which to execute your webapp in the distro.</p></div>
<div class="sect4"><h5>Configuration</h5><div class="paragraph"><p>The configuration parameters are mostly the same as the <code>jetty:run</code> goal (although see below for some exceptions), with the addition of:</p></div>
<div class="dlist"><dl><dt class="hdlist1">jettyBase</dt><dd><p>Optional.
The location of an existing jetty base directory to use to deploy the webapp.
The existing base will be copied to the <code>target/</code> directory before the webapp is deployed.
If there is no existing jetty base, a fresh one will be made in <code>target/jetty-base</code>.</p></dd><dt class="hdlist1">jettyHome</dt><dd><p>Optional.
The location of an existing unpacked jetty distribution.
If one does not exist, a fresh jetty distribution will be downloaded from maven and installed to the <code>target</code> directory.</p></dd><dt class="hdlist1">jettyProperties</dt><dd><p>Optional.
An array of jetty properties to specify on the command line for the child process.</p></dd><dt class="hdlist1">jvmArgs</dt><dd><p>Optional.
A string representing arguments that should be passed to the jvm of the child process.</p></dd><dt class="hdlist1">modules</dt><dd><p>Optional.
An array of names of jetty modules that the jetty child process will activate.</p></dd><dt class="hdlist1">waitForChild</dt><dd><p>Default is <code>true</code>.
Like jetty:run-forked, if <code>true</code>, the parent process will wait for the child to exit and echo all of its output to the parent&#8217;s stdout/stderr.
In that case you can terminate both processes with a <code>cntrl-c</code>.
If <code>false</code>, the parent does not wait for the child to finish, and the child will write all of its output to <code>target/jetty.out</code>.
To stop the asynchronously executing child process you can use <code>jetty:stop</code>.</p></dd><dt class="hdlist1">maxChildChecks</dt><dd><p>Default value 10.
This is the maximum number of times the parent will check to see if the child started correctly when <code>waitForChild</code> is <code>false</code>.</p></dd><dt class="hdlist1">maxChildCheckInterval</dt><dd><p>Default value 100.
This is the interval in milliseconds between checks to see if the child started correctly.
Only applicable if <code>waitForChild</code> is <code>false</code>.</p></dd><dt class="hdlist1">javaPath</dt><dd><p>Default will be your <code>${java.home}/bin/java</code>
This the java executable used to start the child process</p></dd></dl></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Use the <code>modules</code> parameter to configure the Jetty distribution appropriately rather than using jetty artifacts as <code>plugin dependencies</code>.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>The following <code>jetty:run</code> parameters are <strong>NOT</strong> applicable to this goal:</p></div>
<div class="ulist"><ul><li><p><strong>scanTargets</strong></p></li><li><p><strong>scanTargetPatterns</strong></p></li><li><p><strong>scanClassesPattern</strong></p></li><li><p><strong>scanTestClassesPattern</strong></p></li></ul></div>
<div class="paragraph"><p>The following container configuration options are <strong>NOT</strong> applicable for this goal:</p></div>
<div class="dlist"><dl><dt class="hdlist1">scanIntervalSeconds</dt><dd><p>Not supported.
This goal will not monitor and redeploy the webapp.</p></dd><dt class="hdlist1">reload</dt><dd><p>Not supported.
This goal will not redeploy the webapp.</p></dd><dt class="hdlist1">httpConnector</dt><dd><p>Not supported.
Use the <code>modules</code> parameter to enable appropriate modules, or the <code>jettyBase</code> parameter to point to an appropriately configured jetty base.</p></dd><dt class="hdlist1">loginServices</dt><dd><p>Not supported.
Use the <code>modules</code> parameter to enable appropriate modules, or the <code>jettyBase</code> parameter to point to an appropriately configured jetty base.</p></dd><dt class="hdlist1">requestLog</dt><dd><p>Not supported.
Use the <code>modules</code> parameter to enable appropriate modules, or the <code>jettyBase</code> parameter to point to an appropriately configured jetty base.</p></dd><dt class="hdlist1">systemProperties</dt><dd><p>Not supported.
Use the <code>jvmArgs</code> parameter to pass system properties to the forked process.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s an example of using the configuration parameters:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
...
  &lt;plugins&gt;
...
  &lt;plugin&gt;
    &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
    &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
    &lt;configuration&gt;
      &lt;stopKey&gt;alpha&lt;/stopKey&gt;
      &lt;stopPort&gt;9099&lt;/stopPort&gt;
      &lt;jettyBase&gt;/my/existing/jetty-base&lt;/jettyBase&gt;
      &lt;contextXml&gt;/some/existing/context.xml&lt;/contextXml&gt;
      &lt;useTestClasspath&gt;true&lt;/useTestClasspath&gt;
      &lt;modules&gt;
       &lt;module&gt;apache-jsp&lt;/module&gt;
       &lt;module&gt;apache-jstl&lt;/module&gt;
       &lt;module&gt;jmx&lt;/module&gt;
      &lt;/modules&gt;
      &lt;jettyProperties&gt;
        &lt;jettyProperty&gt;jetty.server.dumpAfterStart=true&lt;/jettyProperty&gt;
      &lt;/jettyProperties&gt;
      &lt;jvmArgs&gt;-Dorg.eclipse.jetty.webapp.LEVEL=DEBUG&lt;/jvmArgs&gt;
      &lt;webApp&gt;
        &lt;contextPath&gt;/mypath&lt;/contextPath&gt;
      &lt;/webApp&gt;
    &lt;/configuration&gt;
    &lt;/plugin&gt;
...
  &lt;/plugins&gt;
&lt;/project&gt;</code></pre></div></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">When defining modules for this goal, use the standard <a href="#startup-modules">Jetty module</a> names and not the name of the related Jetty sub-project.
For example, in the configuration above support for JMX is configured by adding the <code>jmx</code> Jetty module and not the <code>jetty-jmx</code> sub-project.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>To deploy your unassembled web app to jetty running as a local distribution:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:run-distro</code></pre></div></div></div></div>
<div class="sect3"><h4 id="jetty-start-goal">jetty:start</h4><div class="paragraph"><p>This goal is for use with an execution binding in your <code>pom.xml</code>.
It is similar to the <code>jetty:run</code> goal, however it does NOT first execute the build up until the <code>test-compile</code> phase to ensure that all necessary classes and files of the webapp have been generated.
This is most useful when you want to control the start and stop of Jetty via execution bindings in your <code>pom.xml</code>.</p></div>
<div class="paragraph"><p>For example, you can configure the plugin to start your webapp at the beginning of your unit tests and stop at the end.
To do this, you need to set up a couple of <code>execution</code> scenarios for the Jetty plugin.
You use the <code>pre-integration-test</code> and <code>post-integration-test</code> Maven build phases to trigger the execution and termination of Jetty:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
    &lt;stopKey&gt;foo&lt;/stopKey&gt;
    &lt;stopPort&gt;9999&lt;/stopPort&gt;
  &lt;/configuration&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;start-jetty&lt;/id&gt;
      &lt;phase&gt;pre-integration-test&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;start&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;scanIntervalSeconds&gt;0&lt;/scanIntervalSeconds&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
    &lt;execution&gt;
      &lt;id&gt;stop-jetty&lt;/id&gt;
      &lt;phase&gt;post-integration-test&lt;/phase&gt;
       &lt;goals&gt;
         &lt;goal&gt;stop&lt;/goal&gt;
       &lt;/goals&gt;
     &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre></div></div></div>
<div class="sect3"><h4 id="jetty-stop-goal">jetty:stop</h4><div class="paragraph"><p>The stop goal stops a running instance of Jetty.
To use it, you need to configure the plugin with a special port number and key.
That same port number and key will also be used by the other goals that start jetty.</p></div>
<div class="dlist"><dl><dt class="hdlist1">stopPort</dt><dd><p>A port number for Jetty to listen on to receive a stop command to cause it to shutdown.</p></dd><dt class="hdlist1">stopKey</dt><dd><p>A string value sent to the <code>stopPort</code> to validate the stop command.</p></dd><dt class="hdlist1">stopWait</dt><dd><p>The maximum time in seconds that the plugin will wait for confirmation that Jetty has stopped.
If false or not specified, the plugin does not wait for confirmation but exits after issuing the stop command.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s a configuration example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;stopPort&gt;9966&lt;/stopPort&gt;
    &lt;stopKey&gt;foo&lt;/stopKey&gt;
    &lt;stopWait&gt;10&lt;/stopWait&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Then, while Jetty is running (in another window), type:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">mvn jetty:stop</code></pre></div></div>
<div class="paragraph"><p>The <code>stopPort</code> must be free on the machine you are running on.
If this is not the case, you will get an "Address already in use" error message after the "Started ServerConnector &#8230;&#8203;" message.</p></div></div>
<div class="sect3"><h4 id="jetty-effective-web-xml">jetty:effective-web-xml</h4><div class="paragraph"><p>This goal calculates a synthetic <code>web.xml</code> (the "effective web.xml") according to the rules of the Servlet Specification taking into account all sources of discoverable configuration of web components in your application: descriptors (<code>webdefault.xml</code>, <code>web.xml</code>, <code>web-fragment.xml`s, `web-override.xml</code>) and discovered annotations (<code>@WebServlet</code>, <code>@WebFilter</code>, <code>@WebListener</code>).
Note that no programmatic declarations of servlets, filters and listeners can be taken into account.
The effective <code>web.xml</code> from these combined sources is generated and displayed as maven log output.
Other useful information about your webapp that is produced as part of the analysis is also stored as context parameters in the effective-web.xml.
The effective-web.xml can be used in conjunction with the <a href="#quickstart-webapp">Quickstart</a> feature to quickly start your webapp (note that Quickstart is not appropriate for the mvn jetty goals).</p></div>
<div class="paragraph"><p>The following configuration parameters allow you to save the file:</p></div>
<div class="dlist"><dl><dt class="hdlist1">deleteOnExit</dt><dd><p>By default this is <code>true</code>.
If set to <code>false</code>, the effective web.xml is generated into a file called <code>effective-web.xml</code> in the build <code>target</code> directory.</p></dd><dt class="hdlist1">effectiveWebXml</dt><dd><p>The full path name of a file into which you would like the effective web xml generated.</p></dd></dl></div>
<div class="paragraph"><p>You can also generate the origin of each element into the effective web.xml file.
The origin is either a descriptor eg web.xml,web-fragment.xml,override-web.xml file, or an annotation eg @WebServlet.
Some examples of elements with origin attribute information are:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;listener origin="DefaultsDescriptor(file:///path/to/distro/etc/webdefault.xml):21"&gt;
&lt;listener origin="WebDescriptor(file:///path/to/base/webapps/test-spec/WEB-INF/web.xml):22"&gt;
&lt;servlet-class origin="FragmentDescriptor(jar:file:///path/to/base/webapps/test-spec/WEB-INF/lib/test-web-fragment.jar!/META-INF/web-fragment.xml):23"&gt;
&lt;servlet-class origin="@WebServlet(com.acme.test.TestServlet):24"&gt;</code></pre></div></div>
<div class="paragraph"><p>To generate origin information, use the following configuration parameters on the  <code>webApp</code> element:</p></div>
<div class="dlist"><dl><dt class="hdlist1">originAttribute</dt><dd><p>The name of the attribute that will contain the origin.
By default it is <code>origin</code>.</p></dd><dt class="hdlist1">generateOrigin</dt><dd><p>False by default. If true, will force the generation of the originAttribute onto each element.</p></dd></dl></div></div>
<div class="sect3"><h4 id="using-overlaid-wars">Using Overlaid wars</h4><div class="paragraph"><p>If your webapp depends on other war files, the <a href="#jetty-run-goal">jetty:run</a> and <a href="#jetty-run-forked-goal">jetty:run-forked</a> goals are able to merge resources from all of them.
It can do so based on the settings of the <a href="http://maven.apache.org/plugins/maven-war-plugin/">maven-war-plugin</a>, or if your project does not use the <a href="http://maven.apache.org/plugins/maven-war-plugin/">maven-war-plugin</a> to handle the overlays, it can fall back to a simple algorithm to determine the ordering of resources.</p></div>
<div class="sect4"><h5>With maven-war-plugin</h5><div class="paragraph"><p>The maven-war-plugin has a rich set of capabilities for merging resources.
The <code>jetty:run</code> and <code>jetty:run-forked</code> goals are able to interpret most of them and apply them during execution of your unassembled webapp.
This is probably best seen by looking at a concrete example.</p></div>
<div class="paragraph"><p>Suppose your webapp depends on the following wars:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.acme&lt;/groupId&gt;
  &lt;artifactId&gt;X&lt;/artifactId&gt;
  &lt;type&gt;war&lt;/type&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.acme&lt;/groupId&gt;
  &lt;artifactId&gt;Y&lt;/artifactId&gt;
  &lt;type&gt;war&lt;/type&gt;
&lt;/dependency&gt;</code></pre></div></div>
<div class="paragraph"><p>Containing:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-text" data-lang="text">WebAppX:

 /foo.jsp
 /bar.jsp
 /WEB-INF/web.xml

WebAppY:

 /bar.jsp
 /baz.jsp
 /WEB-INF/web.xml
 /WEB-INF/special.xml</code></pre></div></div>
<div class="paragraph"><p>They are configured for the <a href="http://maven.apache.org/plugins/maven-war-plugin/overlays.html">maven-war-plugin</a>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;overlays&gt;
      &lt;overlay&gt;
        &lt;groupId&gt;com.acme&lt;/groupId&gt;
        &lt;artifactId&gt;X&lt;/artifactId&gt;
        &lt;excludes&gt;
          &lt;exclude&gt;bar.jsp&lt;/exclude&gt;
        &lt;/excludes&gt;
      &lt;/overlay&gt;
      &lt;overlay&gt;
        &lt;groupId&gt;com.acme&lt;/groupId&gt;
        &lt;artifactId&gt;Y&lt;/artifactId&gt;
        &lt;excludes&gt;
          &lt;exclude&gt;baz.jsp&lt;/exclude&gt;
        &lt;/excludes&gt;
      &lt;/overlay&gt;
      &lt;overlay&gt;
      &lt;/overlay&gt;
    &lt;/overlays&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Then executing jetty:run would yield the following ordering of resources: <code>com.acme.X.war : com.acme.Y.war: ${project.basedir}/src/main/webapp</code>.
Note that the current project&#8217;s resources are placed last in the ordering due to the empty &lt;overlay/&gt; element in the maven-war-plugin.
You can either use that, or specify the <code>&lt;baseAppFirst&gt;false&lt;/baseAppFirst&gt;</code> parameter to the jetty-maven-plugin.</p></div>
<div class="paragraph"><p>Moreover, due to the <code>exclusions</code> specified above, a request for the resource ` bar.jsp` would only be satisfied from <code>com.acme.Y.war.</code>
Similarly as <code>baz.jsp</code> is excluded, a request for it would result in a 404 error.</p></div></div>
<div class="sect4"><h5>Without maven-war-plugin</h5><div class="paragraph"><p>The algorithm is fairly simple, is based on the ordering of declaration of the dependent wars, and does not support exclusions.
The configuration parameter <code>&lt;baseAppFirst&gt;</code> (see the section on <a href="#configuring-your-webapp">Configuring Your Webapp</a> for more information) can be used to control whether your webapp&#8217;s resources are placed first or last on the resource path at runtime.</p></div>
<div class="paragraph"><p>For example, suppose our webapp depends on these two wars:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.acme&lt;/groupId&gt;
  &lt;artifactId&gt;X&lt;/artifactId&gt;
  &lt;type&gt;war&lt;/type&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.acme&lt;/groupId&gt;
  &lt;artifactId&gt;Y&lt;/artifactId&gt;
  &lt;type&gt;war&lt;/type&gt;
&lt;/dependency&gt;</code></pre></div></div>
<div class="paragraph"><p>Suppose the webapps contain:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-text" data-lang="text">WebAppX:

 /foo.jsp
 /bar.jsp
 /WEB-INF/web.xml

WebAppY:

 /bar.jsp
 /baz.jsp
 /WEB-INF/web.xml
 /WEB-INF/special.xml</code></pre></div></div>
<div class="paragraph"><p>Then our webapp has available these additional resources:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-text" data-lang="text">/foo.jsp (X)
/bar.jsp (X)
/baz.jsp (Y)
/WEB-INF/web.xml (X)
/WEB-INF/special.xml (Y)</code></pre></div></div></div></div>
<div class="sect3"><h4 id="configuring-security-settings">Configuring Security Settings</h4><div class="paragraph"><p>You can configure LoginServices in the plugin.
Here&#8217;s an example of setting up the HashLoginService for a webapp:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
    &lt;loginServices&gt;
      &lt;loginService implementation="org.eclipse.jetty.security.HashLoginService"&gt;
        &lt;name&gt;Test Realm&lt;/name&gt;
        &lt;config&gt;${project.basedir}/src/etc/realm.properties&lt;/config&gt;
      &lt;/loginService&gt;
    &lt;/loginServices&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div></div>
<div class="sect3"><h4 id="using-multiple-webapp-root-directories">Using Multiple Webapp Root Directories</h4><div class="paragraph"><p>If you have external resources that you want to incorporate in the execution of a webapp, but which are not assembled into war files, you can&#8217;t use the overlaid wars method described above, but you can tell Jetty the directories in which these external resources are located.
At runtime, when Jetty receives a request for a resource, it searches all the locations to retrieve the resource.
It&#8217;s a lot like the overlaid war situation, but without the war.</p></div>
<div class="paragraph"><p>Here is a configuration example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;configuration&gt;
  &lt;webApp&gt;
    &lt;contextPath&gt;/${build.finalName}&lt;/contextPath&gt;
    &lt;baseResource implementation="org.eclipse.jetty.util.resource.ResourceCollection"&gt;
      &lt;resourcesAsCSV&gt;src/main/webapp,/home/johndoe/path/to/my/other/source,/yet/another/folder&lt;/resourcesAsCSV&gt;
    &lt;/baseResource&gt;
  &lt;/webApp&gt;
&lt;/configuration&gt;</code></pre></div></div></div>
<div class="sect3"><h4 id="running-more-than-one-webapp">Running More than One Webapp</h4><div class="sect4"><h5>With jetty:run</h5><div class="paragraph"><p>You can use either a <code>jetty.xml</code> file to configure extra (pre-compiled) webapps that you want to deploy, or you can use the <code>&lt;contextHandlers&gt;</code> configuration element to do so.
If you want to deploy webapp A, and webapps B and C in the same Jetty instance:</p></div>
<div class="paragraph"><p>Putting the configuration in webapp A&#8217;s <code>pom.xml</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
    &lt;contextHandlers&gt;
      &lt;contextHandler implementation="org.eclipse.jetty.maven.plugin.JettyWebAppContext"&gt;
        &lt;war&gt;${project.basedir}../../B.war&lt;/war&gt;
        &lt;contextPath&gt;/B&lt;/contextPath&gt;
      &lt;/contextHandler&gt;
      &lt;contextHandler implementation="org.eclipse.jetty.maven.plugin.JettyWebAppContext"&gt;
        &lt;war&gt;${project.basedir}../../C.war&lt;/war&gt;
        &lt;contextPath&gt;/C&lt;/contextPath&gt;
      &lt;/contextHandler&gt;
    &lt;/contextHandlers&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">If the <code>ContextHandler</code> you are deploying is a webapp, it is <strong>essential</strong> that you use an <code>org.eclipse.jetty.maven.plugin.JettyWebAppContext</code> instance rather than a standard <code>org.eclipse.jetty.webapp.WebAppContext</code> instance.
Only the former will allow the webapp to function correctly in the maven environment.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>Alternatively, add a <code>jetty.xml</code> file to webapp A.
Copy the <code>jetty.xml</code> file from the Jetty distribution, and then add WebAppContexts for the other 2 webapps:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Ref refid="Contexts"&gt;
  &lt;Call name="addHandler"&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.maven.plugin.JettyWebAppContext"&gt;
        &lt;Set name="contextPath"&gt;/B&lt;/Set&gt;
        &lt;Set name="war"&gt;../../B.war&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
  &lt;Call&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.maven.plugin.JettyWebAppContext"&gt;
        &lt;Set name="contextPath"&gt;/C&lt;/Set&gt;
        &lt;Set name="war"&gt;../../C.war&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
&lt;/Ref&gt;</code></pre></div></div>
<div class="paragraph"><p>Then configure the location of this <code>jetty.xml</code> file into webapp A&#8217;s jetty plugin:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
    &lt;jettyXml&gt;src/main/etc/jetty.xml&lt;/jettyXml&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>For either of these solutions, the other webapps must already have been built, and they are not automatically monitored for changes.
You can refer either to the packed WAR file of the pre-built webapps or to their expanded equivalents.</p></div></div>
<div class="sect4"><h5>With jetty:run-distro</h5><div class="paragraph"><p>Simply configure a jetty base that contains all of the other prebuilt webapps you wish to deploy.</p></div></div></div>
<div class="sect3"><h4 id="setting-system-properties">Setting System Properties</h4><div class="paragraph"><p>You can specify property name/value pairs that Jetty sets as System properties for the execution of the plugin.
This feature is useful to tidy up the command line and save a lot of typing.</p></div>
<div class="paragraph"><p>However, <strong>sometimes it is not possible to use this feature to set System properties</strong> - sometimes the software component using the System property is already initialized by the time that maven runs (in which case you will need to provide the System property on the command line), or by the time that Jetty runs.
In the latter case, you can use the <a href="http://www.mojohaus.org/">maven properties plugin</a> to define the system properties instead. Here&#8217;s an example that configures the logback logging system as the Jetty logger:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;properties-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-alpha-2&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;set-system-properties&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;properties&gt;
          &lt;property&gt;
            &lt;name&gt;logback.configurationFile&lt;/name&gt;
            &lt;value&gt;${project.baseUri}/resources/logback.xml&lt;/value&gt;
          &lt;/property&gt;
        &lt;/properties&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">If a System property is already set (for example, from the command line or by the JVM itself), then by default these configured properties <strong>DO NOT</strong> override them (see below for use of the &lt;force&gt; parameter).</td></tr></table></div></blockquote></div>
<div class="sect4"><h5 id="specifying-properties-in-pom">Specifying System Properties in the POM</h5><div class="paragraph"><p>Here&#8217;s an example of how to specify System properties in the POM:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;systemProperties&gt;
      &lt;systemProperty&gt;
        &lt;name&gt;fooprop&lt;/name&gt;
        &lt;value&gt;222&lt;/value&gt;
      &lt;/systemProperty&gt;
    &lt;/systemProperties&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>To change the default behavior so that these system properties override those on the command line, use the <code>&lt;force&gt;</code> parameter:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;systemProperties&gt;
      &lt;force&gt;true&lt;/force&gt;
      &lt;systemProperty&gt;
       &lt;name&gt;fooprop&lt;/name&gt;
       &lt;value&gt;222&lt;/value&gt;
     &lt;/systemProperty&gt;
    &lt;/systemProperties&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div></div>
<div class="sect4"><h5 id="specifying-properties-in-file">Specifying System Properties in a File</h5><div class="paragraph"><p>You can also specify your System properties in a file.
System properties you specify in this way <strong>do not</strong> override System properties that set on the command line, by the JVM, or directly in the POM via <code>systemProperties</code>.</p></div>
<div class="paragraph"><p>Suppose we have a file called <code>mysys.props</code> which contains the following:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-text" data-lang="text">fooprop=222</code></pre></div></div>
<div class="paragraph"><p>This can be configured on the plugin like so:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
  &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;systemPropertiesFile&gt;${project.basedir}/mysys.props&lt;/systemPropertiesFile&gt;
    &lt;webApp&gt;
      &lt;contextPath&gt;/test&lt;/contextPath&gt;
    &lt;/webApp&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>You can instead specify the file by setting the System property <code>jetty.systemPropertiesFile</code> on the command line.</p></div></div></div></div>
<div class="sect2"><h3 id="jetty-maven-scanning">Files Scanned by the Jetty Maven Plugin</h3><div class="paragraph"><p>If you set a non zero <code>scanIntervalSeconds</code> <a href="#jetty-maven-plugin">configuration parameter</a>, the <code>jetty-maven-plugin</code> will scan certain files for changes, and redeploy the webapp if necessary.
The files that are scanned depend on the goal being executed.</p></div>
<div class="sect3"><h4 id="scanner-matrix">Scanner Matrix</h4><table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 33.3333%;"><col style="width: 66.6667%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Goal</th><th class="tableblock halign-left valign-top">Files</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-run-goal">jetty:run</a></p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>pom.xml</p></li><li><p>&lt;dependencies&gt;</p></li><li><p>&lt;classesDirectory&gt;</p></li><li><p>&lt;testClassesDirectory&gt;</p></li><li><p>&lt;webXml&gt; or &lt;webAppSourceDirectory&gt;/WEB-INF/web.xml</p></li><li><p>&lt;jettyEnvXml&gt; or &lt;webAppSourceDirectory&gt;/WEB-INF/jetty-web.xml</p></li><li><p>&lt;webAppSourceDirectory&gt;/WEB-INF/jetty-web.xml</p></li><li><p>&lt;scanTargets&gt;</p></li><li><p>&lt;scanTargetPatterns&gt;</p></li><li><p>any <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html#setDefaultsDescriptor%28java.lang.String%29">defaultsDescriptor</a> for the webapp</p></li><li><p>any <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html#setOverrideDescriptor%28java.lang.String%29">overrideDescriptor</a> for the webapp</p></li><li><p>any dependencies that are wars or zips</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#running-assembled-webapp-as-war">jetty:run-war</a></p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>pom.xml</p></li><li><p>&lt;war&gt;</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#running-assembled-webapp-as-expanded-war">jetty:run-exploded</a></p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>pom.xml</p></li><li><p>&lt;war&gt;/WEB-INF/web.xml</p></li><li><p>&lt;war&gt;/WEB-INF/jetty-web.xml</p></li><li><p>&lt;war&gt;/WEB-INF/jetty-env.xml</p></li><li><p>&lt;war&gt;/WEB-INF/classes</p></li><li><p>&lt;war&gt;/WEB-INF/lib</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#deploy-war-running-pre-assembled-war">jetty:deploy-war</a></p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>pom.xml</p></li><li><p>&lt;war&gt;</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-run-forked-goal">jetty:run-forked</a></p></td><td class="tableblock halign-left valign-top"><div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-effective-web-xml">jetty:effective-web-xml</a></p></td><td class="tableblock halign-left valign-top"><div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-run-distro-goal">jetty:run-distro</a></p></td><td class="tableblock halign-left valign-top"><div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-start-goal">jetty:start</a></p></td><td class="tableblock halign-left valign-top"><div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jetty-stop-goal">jetty:stop</a></p></td><td class="tableblock halign-left valign-top"><div></div></td></tr></tbody></table></div></div>
<div class="sect2"><h3 id="jetty-jspc-maven-plugin">Jetty Jspc Maven Plugin</h3><div class="paragraph"><p>This plugin will help you pre-compile your jsps and works in conjunction with the Maven war plugin to put them inside an assembled war.</p></div>
<div class="sect3"><h4 id="jspc-config">Configuration</h4><div class="paragraph"><p>Here&#8217;s the basic setup required to put the jspc plugin into your build:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
   &lt;artifactId&gt;jetty-jspc-maven-plugin&lt;/artifactId&gt;
   &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
   &lt;executions&gt;
     &lt;execution&gt;
       &lt;id&gt;jspc&lt;/id&gt;
       &lt;goals&gt;
         &lt;goal&gt;jspc&lt;/goal&gt;
       &lt;/goals&gt;
       &lt;configuration&gt;
       &lt;/configuration&gt;
     &lt;/execution&gt;
   &lt;/executions&gt;
 &lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>The configurable parameters are as follows:</p></div>
<div class="dlist"><dl><dt class="hdlist1">webXmlFragment</dt><dd><p>Default value: <code>$\{project.basedir}/target/webfrag.xml</code></p><div class="paragraph"><p>File into which to generate the servlet declarations.
Will be merged with an existing <code>web.xml</code>.</p></div></dd><dt class="hdlist1">webAppSourceDirectory</dt><dd><p>Default value: <code>$\{project.basedir}/src/main/webapp</code></p><div class="paragraph"><p>Root of resources directory where jsps, tags etc are located.</p></div></dd><dt class="hdlist1">webXml</dt><dd><p>Default value: <code>$\{project.basedir}/src/main/webapp/WEB-INF/web.xml</code></p><div class="paragraph"><p>The web.xml file to use to merge with the generated fragments.</p></div></dd><dt class="hdlist1">includes</dt><dd><p>Default value: <code><strong>\/<strong>.jsp, </strong>\/</strong>.jspx</code></p><div class="paragraph"><p>The comma separated list of patterns for file extensions to be processed.</p></div></dd><dt class="hdlist1">excludes</dt><dd><p>Default value: <code><strong>\/.svn\/</strong></code></p><div class="paragraph"><p>The comma separated list of patterns for file extensions to be skipped.</p></div></dd><dt class="hdlist1">classesDirectory</dt><dd><p>Default value: <code>$\{project.build.outputDirectory}</code></p><div class="paragraph"><p>Location of classes for the webapp.</p></div></dd><dt class="hdlist1">generatedClasses</dt><dd><p>Default value: <code>$\{project.build.outputDirectory}</code></p><div class="paragraph"><p>Location to put the generated classes for the jsps.</p></div></dd><dt class="hdlist1">insertionMarker</dt><dd><p>Default value: <em>none</em></p><div class="paragraph"><p>A marker string in the src <code>web.xml</code> file which indicates where to merge in the generated web.xml fragment.
Note that the marker string will NOT be preserved during the insertion.
Can be left blank, in which case the generated fragment is inserted just before the line containing <code>&lt;/web-app&gt;</code>.</p></div></dd><dt class="hdlist1">useProvidedScope</dt><dd><p>Default value: false</p><div class="paragraph"><p>If true, jars of dependencies marked with &lt;scope&gt;provided&lt;/scope&gt; will be placed on the compilation classpath.</p></div></dd><dt class="hdlist1">mergeFragment</dt><dd><p>Default value: true</p><div class="paragraph"><p>Whether or not to merge the generated fragment file with the source web.xml.
The merged file will go into the same directory as the webXmlFragment.</p></div></dd><dt class="hdlist1">keepSources</dt><dd><p>Default value: false</p><div class="paragraph"><p>If true, the generated .java files are not deleted at the end of processing.</p></div></dd><dt class="hdlist1">sourceVersion</dt><dd><p>Introduced in Jetty 9.3.6.
Java version of jsp source files.
Defaults to 1.7.</p></dd><dt class="hdlist1">targetVersion</dt><dd><p>Introduced in Jetty 9.3.6.
Java version of class files generated from jsps.
Defaults to 1.7.</p></dd><dt class="hdlist1">tldJarNamePatterns</dt><dd><p>Default value: <code>.<strong>taglibs[<sup>/]</strong>\.jar|.<strong>jstl-impl[</sup>/]</strong>\.jar$</code></p><div class="paragraph"><p>Patterns of jars on the 'system' (ie container) path that contain tlds.
Use | to separate each pattern.</p></div></dd><dt class="hdlist1">jspc</dt><dd><p>Default value: the <code>org.apache.jasper.JspC</code> instance being configured.</p><div class="paragraph"><p>The JspC class actually performs the pre-compilation.
All setters on the JspC class are available.
You can download the javadoc <a href="https://repo1.maven.org/maven2/org/glassfish/web/javax.servlet.jsp/2.3.2/javax.servlet.jsp-2.3.2-javadoc.jar">here</a>.</p></div></dd></dl></div>
<div class="paragraph"><p>Taking all the default settings, here&#8217;s how to configure the war plugin to use the generated <code>web.xml</code> that includes all of the jsp servlet declarations:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;webXml&gt;${project.basedir}/target/web.xml&lt;/webXml&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre></div></div></div>
<div class="sect3"><h4 id="jspc-production-precompile">Precompiling only for Production Build</h4><div class="paragraph"><p>As compiling jsps is usually done during preparation for a production release and not usually done during development, it is more convenient to put the plugin setup inside a &lt;profile&gt; which which can be deliberately invoked during prep for production.</p></div>
<div class="paragraph"><p>For example, the following profile will only be invoked if the flag <code>-Dprod</code> is present on the run line:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;prod&lt;/id&gt;
      &lt;activation&gt;
        &lt;property&gt;&lt;name&gt;prod&lt;/name&gt;&lt;/property&gt;
      &lt;/activation&gt;
      &lt;build&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
          &lt;artifactId&gt;jetty-jspc-maven-plugin&lt;/artifactId&gt;
          &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
          &lt;!-- put your configuration in here --&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
          &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
          &lt;!-- put your configuration in here --&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;</code></pre></div></div>
<div class="paragraph"><p>The following invocation would cause your code to be compiled, the jsps to be compiled, the &lt;servlet&gt; and &lt;servlet-mapping&gt;s inserted in the <code>web.xml</code> and your webapp assembled into a war:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">$ mvn -Dprod package</code></pre></div></div></div>
<div class="sect3"><h4 id="jspc-overlay-precompile">Precompiling Jsps with Overlaid Wars</h4><div class="paragraph"><p>Precompiling jsps with an overlaid war requires a bit more configuration.
This is because you need to separate the steps of unpacking the overlaid war and then repacking the final target war so the jetty-jspc-maven-plugin has the opportunity to access the overlaid resources.</p></div>
<div class="paragraph"><p>In the example we&#8217;ll show, we will use an overlaid war.
The overlaid war will provide the <code>web.xml</code> file but the jsps will be in <code>src/main/webapp</code> (i.e. part of the project that uses the overlay).
We will unpack the overlaid war file, compile the jsps and merge their servlet definitions into the extracted <code>web.xml</code>, then pack everything into a war.</p></div>
<div class="paragraph"><p>Here&#8217;s an example configuration of the war plugin that separate those phases into an unpack phase, and then a packing phase:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;unpack&lt;/id&gt;
        &lt;goals&gt;&lt;goal&gt;exploded&lt;/goal&gt;&lt;/goals&gt;
        &lt;phase&gt;generate-resources&lt;/phase&gt;
        &lt;configuration&gt;
          &lt;webappDirectory&gt;target/foo&lt;/webappDirectory&gt;
          &lt;overlays&gt;
            &lt;overlay /&gt;
            &lt;overlay&gt;
              &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
              &lt;artifactId&gt;test-jetty-webapp&lt;/artifactId&gt;
            &lt;/overlay&gt;
          &lt;/overlays&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;pack&lt;/id&gt;
        &lt;goals&gt;&lt;goal&gt;war&lt;/goal&gt;&lt;/goals&gt;
        &lt;phase&gt;package&lt;/phase&gt;
        &lt;configuration&gt;
          &lt;warSourceDirectory&gt;target/foo&lt;/warSourceDirectory&gt;
          &lt;webXml&gt;target/web.xml&lt;/webXml&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre></div></div>
<div class="paragraph"><p>Now you also need to configure the <code>jetty-jspc-maven-plugin</code> so that it can use the web.xml that was extracted by the war unpacking and merge in the generated definitions of the servlets.
This is in <code>target/foo/WEB-INF/web.xml</code>.
Using the default settings, the <code>web.xml</code> merged with the jsp servlet definitions will be put into <code>target/web.xml</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
     &lt;artifactId&gt;jetty-jspc-maven-plugin&lt;/artifactId&gt;
     &lt;version&gt;9.4.15-SNAPSHOT&lt;/version&gt;
     &lt;executions&gt;
       &lt;execution&gt;
         &lt;id&gt;jspc&lt;/id&gt;
         &lt;goals&gt;
           &lt;goal&gt;jspc&lt;/goal&gt;
         &lt;/goals&gt;
         &lt;configuration&gt;
            &lt;webXml&gt;target/foo/WEB-INF/web.xml&lt;/webXml&gt;
            &lt;includes&gt;**/*.foo&lt;/includes&gt;
            &lt;excludes&gt;**/*.fff&lt;/excludes&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre></div></div></div></div></div>
<div class="sect2"><h3 id="ant-and-jetty">Ant and Jetty</h3><div class="paragraph"><p>This chapter explains how to use Jetty with Ant and the Jetty Ant tasks.</p></div>
<div class="sect2"><h3 id="jetty-ant">Ant Jetty Plugin</h3><div class="paragraph"><p>The Ant Jetty plugin is a part of Jetty 9 under the <code>jetty-ant</code> module.
This plugin makes it possible to start a Jetty web server directly from the Ant build script, and to embed the Jetty web server inside your build process.
Its purpose is to provide almost the same functionality as the Jetty plugin for Maven: dynamic application reloading, working directly on web application sources, and tightly integrating with the build system.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
   &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;
   &lt;artifactId&gt;jetty-ant&lt;/artifactId&gt;
 &lt;/dependency&gt;</code></pre></div></div>
<div class="sect3"><h4 id="jetty-ant-preparation">Preparing Your Project</h4><div class="paragraph"><p>To set up your project for Ant to run Jetty, you need a Jetty distribution and the jetty-ant Jar:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><a href="https://www.eclipse.org/jetty/download.html">Download</a> a Jetty distribution and unpack it in the local filesystem.</p></li><li><p><a href="https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-ant/">Get</a> the jetty-ant Jar.</p></li><li><p>Make a directory in your project called <code>jetty-lib/</code>.</p></li><li><p>Copy all of the Jars in your Jetty distribution&#8217;s <code>lib</code> directory, and all its subdirectories, into your new <code>jetty-lib</code> dir.
When copying the Jars, <em>don&#8217;t</em> preserve the Jetty distribution&#8217;s lib dir hierarchy – all the jars should be directly inside your ` jetty-lib` dir.</p></li><li><p>Also copy the jetty-ant Jar you downloaded earlier into the <code>jetty-lib</code> dir.</p></li><li><p>Make a directory in your project called <code>jetty-temp</code>.</p></li></ol></div>
<div class="paragraph"><p>Now you&#8217;re ready to edit or create your Ant <code>build.xml</code> file.</p></div></div>
<div class="sect3"><h4>Preparing the <code>build.xml</code> file</h4><div class="paragraph"><p>Begin with an empty <code>build.xml</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;
&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>Add a <code>&lt;taskdef&gt;</code> that imports all available Jetty tasks:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
     &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

  &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>Now you are ready to add a new target for running Jetty:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

  &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run /&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>This is the minimal configuration you need. You can now start Jetty on the default port of 8080.</p></div></div>
<div class="sect3"><h4>Starting Jetty via Ant</h4><div class="paragraph"><p>At the command line enter:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; ant jetty.run</code></pre></div></div></div>
<div class="sect3"><h4>Configuring the Jetty Container</h4><div class="paragraph"><p>A number of configuration options can help you set up the Jetty environment so that your web application has all the resources it needs:</p></div>
<div class="dlist"><dl><dt class="hdlist1">ports and connectors</dt><dd><p>To configure the port that Jetty starts on you need to define a connector.
First you need to configure a <code>&lt;typedef&gt;</code> for the Connector class and then define the connector in the Jetty tags:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

  &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;typedef name="connector" classname="org.eclipse.jetty.ant.types.Connector"
           classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;connectors&gt;
        &lt;connector port="8090"/&gt;
      &lt;/connectors&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="quoteblock"><blockquote><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">You can set the port to 0, which starts the Jetty server connector on an arbitrary available port.
You can then access these values from system properties <code>jetty.ant.server.port</code> and <code>jetty.ant.server.host</code>.</td></tr></table></div></blockquote></div></dd><dt class="hdlist1">login services</dt><dd><p>If your web application requires authentication and authorization services, you can configure these on the Jetty container.
Here&#8217;s an example of how to set up an <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/security/HashLoginService.html">org.eclipse.jetty.security.HashLoginService</a>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="hashLoginService" classname="org.eclipse.jetty.security.HashLoginService"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;loginServices&gt;
        &lt;hashLoginService name="Test Realm" config="${basedir}/realm.properties"/&gt;
      &lt;/loginServices&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">request log</dt><dd><p>The <code>requestLog</code> option allows you to specify a request logger for the Jetty instance.
You can either use the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/NCSARequestLog.html">org.eclipse.jetty.server.NCSARequestLog</a> class, or supply the name of your custom class:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run requestLog="com.acme.MyFancyRequestLog"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">temporary directory</dt><dd><p>You can configure a directory as a temporary file store for uses such as expanding files and compiling JSPs by supplying the <code>tempDirectory</code> option:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run tempDirectory="${basedir}/jetty-temp"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">other context handlers</dt><dd><p>You may need to configure some other context handlers to run at the same time as your web application.
You can specify these other context handlers using the <code>&lt;contextHandlers&gt;</code> element.
You need to supply a <code>&lt;typedef&gt;</code> for it before you can use it:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath"
          resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="contextHandlers" classname="org.eclipse.jetty.ant.types.ContextHandlers"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
     &lt;contextHandlers&gt;
       &lt;contextHandler resourceBase="${basedir}/stuff" contextPath="/stuff"/&gt;
     &lt;/contextHandlers&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">system properties</dt><dd><p>As a convenience, you can configure system properties by using the <code>&lt;systemProperties&gt;</code> element.
Be aware that, depending on the purpose of the system property, setting it from within the Ant execution may mean that it is evaluated too late, as the JVM evaluates some system properties on entry.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;systemProperties&gt;
        &lt;systemProperty name="foo" value="bar"/&gt;
      &lt;/systemProperties&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">jetty XML file</dt><dd><p>If you have a lot of configuration to apply to the Jetty container, it can be more convenient to put it into a standard Jetty XML configuration file and have the Ant plugin apply it before starting Jetty:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run jettyXml="${basedir}/jetty.xml"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">scanning for changes</dt><dd><p>The most useful mode in which to run the Ant plugin is for it to continue to execute Jetty and automatically restart your web application if any part of it changes (for example, your IDE
recompiles the classes of the web application).
The <code>scanIntervalSeconds</code> option controls how frequently the <code>&lt;jetty.run&gt;</code> task scans your web application/WAR file for changes.
The default value of <code>0</code> disables scanning. Here&#8217;s an example where Jetty checks for changes every five seconds:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run scanIntervalSeconds="5"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">stopping</dt><dd><p>In normal mode (<code>daemon="false"</code>), the <code>&lt;jetty.run&gt;</code> task runs until you <code>cntrl-c</code> it. It may be useful to script both the stop AND the start of Jetty.
For such a case, we provide the <code>&lt;jetty.stop&gt;</code> task.
+
To use it, you need to provide a port and an identifying string to both the ` &lt;jetty.run&gt;` and the <code>&lt;jetty.stop&gt;</code> tasks, where <code>&lt;jetty.run&gt;</code> listens on the given port for a stop message containing the given string, and cleanly stops Jetty when it is received.
The <code>&lt;jetty.stop&gt;</code> task sends this stop message.
You can also optionally provide a <code>stopWait</code> value (in seconds), which is the length of time the <code>&lt;jetty.stop&gt;</code> task waits for confirmation that the stop succeeded:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run stopPort="9999" stopKey="9999"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

  &lt;target name="jetty.stop"&gt;
   &lt;jetty.stop stopPort="9999" stopKey="9999" stopWait="10"/&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>To stop jetty via Ant, enter:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">&gt; ant jetty.stop</code></pre></div></div></dd><dt class="hdlist1">execution without pausing ant</dt><dd><p>Usually, the <code>&lt;jetty.run&gt;</code> task runs until you <code>cntrl-c</code> it, pausing the execution of Ant as it does so. In some cases, it may be useful to let Ant continue executing.
For example, to run your unit tests you may need other tasks to execute while Jetty is running.
For this case, we provide the <code>daemon</code> option.
This defaults to <code>false</code>. For <code>true</code>, Ant continues to execute after starting Jetty.
If Ant exits, so does Jetty. Understand that this option does <em>not</em> fork a new process for Jetty.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run daemon="true"&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd></dl></div></div>
<div class="sect3"><h4>Deploying a Web Application</h4><div class="paragraph"><p>Add a <code>&lt;typedef&gt;</code> for the <code>org.eclipse.jetty.ant.AntWebAppContext</code> class with name <em>webApp</em>, then add a <code>&lt;webApp&gt;</code> element to <code>&lt;jetty.run&gt;</code> to describe your web application.
The following example deploys a web application that is expanded in the local directory <code>foo/</code> to context path ` / `:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo" contextPath="/"/&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="dlist"><dl><dt class="hdlist1">deploying a WAR file</dt><dd><p>It is not necessary to expand the web application into a directory.
It is fine to deploy it as a WAR file:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo.war" contextPath="/"/&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">deploying more than one web application</dt><dd><p>You can also deploy more than one web application:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo.war" contextPath="/"/&gt;
      &lt;webApp war="${basedir}/other    contextPath="/other"/&gt;
      &lt;webApp war="${basedir}/bar.war" contextPath="/bar"/&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd></dl></div>
<div class="sect4"><h5>Configuring the Web Application</h5><div class="paragraph"><p>As the <code>org.eclipse.jetty.ant.AntWebAppContext</code> class is an extension of
the
<a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html"><code>org.eclipse.jetty.webapp.WebAppContext</code></a>
class, you can configure it by adding attributes of the same name
(without the <code>set</code> or <code>add</code> prefix) as the setter methods.</p></div>
<div class="paragraph"><p>Here&#8217;s an example that specifies the location of the <code>web.xml</code> file (equivalent to method <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html#setDescriptor%28java.lang.String%29"><code>AntWebAppContext.setDescriptor()</code></a>) and the web application&#8217;s temporary directory (equivalent to method <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/webapp/WebAppContext.html#setTempDirectory%28java.io.File%29"><code>AntWebAppContext.setTempDirectory()</code></a>):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp descriptor="${basedir}/web.xml" tempDirectory="${basedir}/my-temp" war="${basedir}/foo" contextPath="/"/&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div>
<div class="paragraph"><p>Other extra configuration options for the AntWebAppContext include:</p></div>
<div class="dlist"><dl><dt class="hdlist1">extra classes and Jars</dt><dd><p>If your web application&#8217;s classes and Jars do not reside inside <code>WEB-INF</code> of the resource base directory, you can use the &lt;classes&gt; and &lt;jar&gt; elements to tell Ant where to find them. Here&#8217;s an example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp descriptor="${basedir}/web.xml" tempDirectory="${basedir}/my-temp" war="${basedir}/foo" contextPath="/"&gt;
        &lt;classes dir="${basedir}/classes"&gt;
          &lt;include name="**/*.class"/&gt;
          &lt;include name="**/*.properties"/&gt;
        &lt;/classes&gt;
        &lt;lib dir="${basedir}/jars"&gt;
          &lt;include name="**/*.jar"/&gt;
          &lt;exclude name="**/*.dll"/&gt;
        &lt;/lib&gt;
      &lt;/webApp&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">context attributes</dt><dd><p>Jetty allows you to set up ServletContext attributes on your web application.
You configure them in a context XML file that is applied to your WebAppContext instance prior to starting it.
For convenience, the Ant plugin permits you to configure these directly in the build file.
Here&#8217;s an example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo" contextPath="/"&gt;
        &lt;attributes&gt;
          &lt;attribute name="my.param" value="123"/&gt;
        &lt;/attributes&gt;
      &lt;/webApp&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1"><code>jetty-env.xml</code> file</dt><dd><p>If you are using features such as <a href="#configuring_jndi">JNDI</a> with your web application, you may need to configure a <a href="#using_jndi"><code>WEB-INF/jetty-env.xml</code></a> file to define resources. If the structure of your web application project is such that the source of <code>jetty-env.xml</code> file resides somewhere other than <code>WEB-INF</code>, you can use the <code>jettyEnvXml</code> attribute to tell Ant where to find it:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo" contextPath="/" jettyEnvXml="${basedir}/jetty-env.xml"&gt;
        &lt;attributes&gt;
      &lt;/webApp&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd><dt class="hdlist1">context XML file</dt><dd><p>You may prefer or even require to do some advanced configuration of your web application outside of the Ant build file.
In this case, you can use a standard context XML configuration file which the Ant plugin applies to your web application before it is deployed.
Be aware that the settings from the context XML file <em>override</em> those of the attributes and nested elements you defined in the build file.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">project name="Jetty-Ant integration test" basedir="."&gt;

  &lt;path id="jetty.plugin.classpath"&gt;
    &lt;fileset dir="jetty-lib" includes="*.jar"/&gt;
  &lt;/path&gt;

 &lt;taskdef classpathref="jetty.plugin.classpath" resource="tasks.properties" loaderref="jetty.loader" /&gt;

 &lt;typedef name="webApp" classname="org.eclipse.jetty.ant.AntWebAppContext"
          classpathref="jetty.plugin.classpath" loaderref="jetty.loader" /&gt;

  &lt;target name="jetty.run"&gt;
    &lt;jetty.run&gt;
      &lt;webApp war="${basedir}/foo" contextPath="/" contextXml="${basedir}/jetty-env.xml"&gt;
        &lt;attributes&gt;
      &lt;/webApp&gt;
    &lt;/jetty.run&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div></div></dd></dl></div></div></div></div></div>
<div class="sect2"><h3 id="jetty-handlers">Handlers</h3><div class="sect2"><h3 id="writing-custom-handlers">Writing Custom Handlers</h3><div class="paragraph"><p>The Handler is the Jetty component that deals with received requests.</p></div>
<div class="paragraph"><p>Many users of Jetty never need to write a Jetty Handler, but instead use the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/servlet/package-summary.html">Servlet API.</a>
You can reuse the existing Jetty handlers for context, security, sessions and servlets without the need for extension.
However, some users might have special requirements or footprint concerns that prohibit the use of the full servlet API.
For them implementing a Jetty handler is a straight forward way to provide dynamic web content with a minimum of fuss.</p></div>
<div class="paragraph"><p>See the section on <a href="#basic-architecture">[basic-architecture]</a> to understand more about Handlers vs. Servlets.</p></div>
<div class="sect3"><h4 id="handler-api">The Handler API</h4><div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Handler.html">Handler</a> interface provides Jetty&#8217;s core of content generation or manipulation.
Classes that implement this interface are used to coordinate requests, filter requests and generate content.</p></div>
<div class="paragraph"><p>The core API of the Handler interface is:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void handle(String target, Request baseRequest, HttpServletRequest request, HttpServletResponse response)
    throws IOException, ServletException</code></pre></div></div>
<div class="paragraph"><p>An implementation of this method can handle a request and pass the request onto another handler (or servlet), or it can modify and/or wrap the request before passing it on.
This gives three styles of handler:</p></div>
<div class="ulist"><ul><li><p>Coordinating Handlers - Handlers that route requests to other handlers (<code>HandlerCollection</code>, <code>ContextHandlerCollection</code>)</p></li><li><p>Filtering Handlers - Handlers that augment a request and pass it on to other handlers (<code>HandlerWrapper</code>, <code>ContextHandler</code>, <code>SessionHandler</code>)</p></li><li><p>Generating Handlers - Handlers that produce content (<code>ResourceHandler</code> and <code>ServletHandler</code>)</p></li></ul></div>
<div class="sect4"><h5 id="target">The Target</h5><div class="paragraph"><p>The target of a handler is an identifier for the resource that should handle the passed request.
This is normally the URI that is parsed from an HTTP Request.
However, in two key circumstances the target may differ from the URI of the passed request:</p></div>
<div class="ulist"><ul><li><p>If the request has been dispatched to a named resource, such as a named servlet, the target is the name of that resource.</p></li><li><p>If the request is being made by a call to <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/RequestDispatcher.html"><code>RequestDispatcher</code></a>, the target is the URI of the included resource and is different to the URI of the actual request.</p></li></ul></div></div>
<div class="sect4"><h5 id="request-and-response">The Request and Response</h5><div class="paragraph"><p>The request and response objects used in the signature of the handle method are
<a href="http://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html"><code>ServletRequest</code></a> and <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/ServletResponse.html"><code>ServletResponse</code></a>.
These are the standard APIs and are moderately restricted in what they can do to the request and response.
More often than not, access to the Jetty implementations of these classes is required: <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Request.html"><code>Request</code></a> and <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/Response.html"><code>Response</code></a>.
However, as the request and response may be wrapped by handlers, filters and servlets, it is not possible to pass the implementation directly.
The following mantra retrieves the core implementation objects from under any wrappers:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">Request base_request = request instanceof Request ? (Request)request : HttpConnection.getCurrentConnection().getHttpChannel().getRequest();
Response base_response = response instanceof Response ? (Response)response : HttpConnection.getCurrentConnection().getHttpChannel().getResponse();</code></pre></div></div>
<div class="paragraph"><p>Notice that if the handler passes the request on to another handler, it should use the Request/Response objects passed in, and not the base objects.
This is to preserve any wrapping done by up stream handlers.</p></div></div>
<div class="sect4"><h5 id="dispatch">The Dispatch</h5><div class="paragraph"><p>The dispatch argument indicates the state of the handling of the call and may be:</p></div>
<div class="ulist"><ul><li><p><code>REQUEST == 1</code> - An original request received from a connector.</p></li><li><p><code>FORWARD == 2</code> - A request being forwarded by a RequestDispatcher.</p></li><li><p><code>INCLUDE == 4</code> - A request being included by a RequestDispatcher.</p></li><li><p><code>ERROR == 8</code> - A request being forwarded to a error handler by the container.</p></li></ul></div>
<div class="paragraph"><p>These mostly have significance for servlet and related handlers.
For example, the security handler only applies authentication and authorization to REQUEST dispatches.</p></div></div></div>
<div class="sect3"><h4 id="handling-requests">Handling Requests</h4><div class="paragraph"><p>A Handler may handle a request by:</p></div>
<div class="ulist"><ul><li><p><a href="#generating-response">Generating a Response</a></p></li><li><p><a href="#filtering-request-or-response">Filtering the Request and/or Response</a></p></li><li><p><a href="#passing-request-and-response">Passing the Request and Response to Another Handler</a></p></li></ul></div>
<div class="sect4"><h5 id="generating-response">Generating a Response</h5><div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/embedded/OneHandler.html"><code>OneHandler</code></a> embedded example shows how a simple handler can generate a response.</p></div>
<div class="paragraph"><p>You can use the standard servlet response API, which will typically set some status, content headers and then write out the content:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java"> response.setContentType("text/html");
 response.setStatus(HttpServletResponse.SC_OK);
 response.getWriter().println("&lt;h1&gt;Hello OneHandler&lt;/h1&gt;");</code></pre></div></div>
<div class="paragraph"><p>It is also very important that a handler indicate that it has completed handling the request and that the request should not be passed to other handlers:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java"> Request base_request = (request instanceof Request) ? (Request)request:HttpConnection.getCurrentConnection().getHttpChannel().getRequest();
 base_request.setHandled(true);</code></pre></div></div></div>
<div class="sect4"><h5 id="filtering-request-or-response">Filtering the Request and/or Response</h5><div class="paragraph"><p>Once the base request or response object is obtained, you can modify it.
Typically you would make modifications to accomplish:</p></div>
<div class="ulist"><ul><li><p>Breaking the URI into contextPath, servletPath and pathInfo components.</p></li><li><p>Associating a resource base with a request for static content.</p></li><li><p>Associating a session with a request.</p></li><li><p>Associating a security principal with a request.</p></li><li><p>Changing the URI and paths during a request dispatch forward to another resource.</p></li></ul></div>
<div class="paragraph"><p>You can also update the context of the request:</p></div>
<div class="ulist"><ul><li><p>Setting the current threads context classloader.</p></li><li><p>Setting thread locals to identify the current <code>ServletContext</code>.</p></li></ul></div>
<div class="paragraph"><p>Typically Jetty passes a modified request to another handler and undoes modifications in a finally block afterwards:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java"> try
 {
    base_request.setSession(a_session);
    next_handler.handle(target,request,response,dispatch);
 }
 finally
 {
    base_request.setSession(old_session);
 }</code></pre></div></div>
<div class="paragraph"><p>The classes that implement the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerWrapper.html"><code>HandlerWrapper</code></a> class are typically handler filters of this style.</p></div></div>
<div class="sect4"><h5 id="passing-request-and-response">Passing the Request and Response to Another Handler</h5><div class="paragraph"><p>A handler might simply inspect the request and use the target, request URI or other information to select another handler to pass the request to.
These handlers typically implement the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/HandlerContainer.html"><code>HandlerContainer</code></a> interface.</p></div>
<div class="paragraph"><p>Examples include:</p></div>
<div class="ulist"><ul><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerCollection.html">Class <code>HandlerCollection</code></a> -
A collection of handlers, where each handler is called regardless of the state of the request.
This is typically used to pass a request to a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/ContextHandlerCollection.html"><code>ContextHandlerCollection</code>,</a> and then the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/RequestLogHandler.html"><code>RequestLogHandler</code>.</a></p></li><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/HandlerList.html"><code>HandlerList</code></a> - A list of handlers that are called in turn until the request state is set as handled.</p></li><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/server/handler/ContextHandlerCollection.html"><code>ContextHandlerCollection</code></a> - A collection of Handlers, of which one is selected by best match for the context path.</p></li></ul></div></div></div>
<div class="sect3"><h4 id="more-about-handlers">More About Handlers</h4><div class="paragraph"><p>See the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/">latest Jetty JavaDoc</a> for detailed information on each Jetty handler.</p></div></div></div></div>
<div class="sect2"><h3 id="websocket-intro">WebSocket Introduction</h3><div class="paragraph"><p>WebSocket is a new protocol for bidirectional communications initiated via HTTP/1.1 upgrade and providing basic message framing, layered over TCP.
It is based on a low-level framing protocol that delivers messages in either UTF-8 TEXT or BINARY format.</p></div>
<div class="paragraph"><p>A single message in WebSocket can be of any size (the underlying framing however does have a single frame limit of <a href="http://en.wikipedia.org/wiki/9223372036854775807">63-bits</a>).
There can be an unlimited number of messages sent.
Messages are sent sequentially, the base protocol does not support interleaved messages.</p></div>
<div class="paragraph"><p>A WebSocket connection goes through some basic state changes:</p></div>
<table class="tableblock frame-all grid-all" style="width: 50%;"><caption class="title">Table 1. WebSocket connection states</caption><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">State</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CONNECTING</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A HTTP Upgrade to WebSocket is in progress</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">OPEN</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP Upgrade succeeded and the socket is now open and ready to read / write</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CLOSING</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A WebSocket Close Handshake has been started</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">CLOSED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket is now closed, no more read/write possible</p></td></tr></tbody></table>
<div class="paragraph"><p>When a WebSocket is closed, a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/StatusCode.html">status code</a> and short reason string is provided.</p></div>
<div class="sect2"><h3 id="ws-intro-provides">What Jetty provides</h3><div class="paragraph"><p>Jetty provides an implementation of the following standards and specs.</p></div>
<div class="dlist"><dl><dt class="hdlist1"><a href="http://tools.ietf.org/html/rfc6455">RFC-6455</a></dt><dd><p>The WebSocket Protocol</p><div class="paragraph"><p>We support the version 13 of the released and final spec.</p></div>
<div class="paragraph"><p>Jetty tests its WebSocket protocol implementation using the <a href="http://autobahn.ws/testsuite">autobahn testsuite</a>.</p></div></dd></dl></div>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">The early drafts of WebSocket were supported in Jetty 7 and Jetty 8,   but this support has been removed in Jetty 9.
This means that Jetty 9 will not support the old browsers that implemented the early drafts of WebSocket. (such as Safari 5.0 or Opera 12)</td></tr></table></div></blockquote></div>
<div class="quoteblock"><blockquote><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">Want to know if the browser you are targeting supports WebSocket?
Use <a href="http://caniuse.com/websockets">caniuse.com/websockets</a> to find out.</td></tr></table></div></blockquote></div>
<div class="dlist"><dl><dt class="hdlist1"><a href="http://www.jcp.org/en/jsr/detail?id=356">JSR-356</a></dt><dd><p>The Java WebSocket API (<code>javax.websocket</code>)</p><div class="paragraph"><p>This is the official Java API for working with WebSockets.</p></div></dd></dl></div>
<div class="paragraph"><p>Unstable standards and specs:</p></div>
<div class="dlist"><dl><dt class="hdlist1"><a href="https://datatracker.ietf.org/doc/draft-ietf-hybi-websocket-perframe-compression/">perframe-compression</a></dt><dd><p>Per Frame Compression Extension.</p><div class="paragraph"><p>An early extension draft from the Google/Chromium team that would provide WebSocket frame compression.
perframe-compression using deflate algorithm is present on many versions of Chrome/Chromium.</p></div>
<div class="paragraph"><p>Jetty&#8217;s support for perframe-compression is based on the draft-04 spec.
This standard is being replaced with permessage-compression.</p></div></dd><dt class="hdlist1"><a href="https://datatracker.ietf.org/doc/draft-tyoshino-hybi-permessage-compression/">permessage-compression</a></dt><dd><p>Per Frame Compression Extension.</p><div class="paragraph"><p>This is the replacement for perframe-compression, switching the compression to being based on the entire message, not the individual frames.</p></div></dd></dl></div></div>
<div class="sect2"><h3 id="ws-intro-api">WebSocket APIs</h3><div class="paragraph"><p>APIs and libraries to implement your WebSockets using Jetty.</p></div>
<div class="dlist"><dl><dt class="hdlist1">Jetty WebSocket API</dt><dd><p>The basic common API for creating and working with WebSockets using Jetty.</p></dd><dt class="hdlist1">Jetty WebSocket Server API</dt><dd><p>Write WebSocket Server Endpoints for Jetty.</p></dd><dt class="hdlist1">Jetty WebSocket Client API</dt><dd><p>Connect to WebSocket servers with Jetty.</p></dd><dt class="hdlist1">Java WebSocket Client API</dt><dd><p>The new standard Java WebSocket Client API (<code>javax.websocket</code>) [JSR-356]</p></dd><dt class="hdlist1">Java WebSocket Server API</dt><dd><p>The new standard Java WebSocket Server API (<code>javax.websocket.server</code>) [JSR-356]</p></dd></dl></div></div>
<div class="sect2"><h3>Enabling WebSocket</h3><div class="paragraph"><p>To enable Websocket, you need to enable the <code>websocket</code> <a href="#enabling-modules">module</a>.</p></div>
<div class="paragraph"><p>Once this module is enabled for your Jetty base, it will apply to all webapps deployed to that base. If you want to be more selective about which webapps use Websocket, then you can:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Disable JSR-356 for a particular webapp</dt><dd><p>You can disable jsr-356 for a particular webapp by setting the <a href="#context_attributes">context attribute</a> <code>org.eclipse.jetty.websocket.jsr356</code> to <code>false</code>.
This will mean that websockets are not available to your webapp, however deployment time   scanning for websocket-related classes such as endpoints will still occur.
This can be a significant impost if your webapp contains a lot of classes and/or jar files.
To completely disable websockets and avoid all setup costs associated with it for a particular webapp, use instead the context attribute <code>org.eclipse.jetty.containerInitializerExclusionPattern</code>, described next, which allows you to exclude the websocket ServletContainerInitializer that causes the scanning.</p></dd><dt class="hdlist1">Completely disable jsr-356 for a particular webapp</dt><dd><p>Set the <code>org.eclipse.jetty.containerInitializerExclusionPattern</code> <a href="#context_attributes">context attribute</a> to include <code>org.eclipse.jetty.websocket.jsr356.server.deploy.WebSocketServerContainerInitializer</code>.
Here&#8217;s an example of doing this in code, although you can do the <a href="#intro-jetty-configuration-webapps">same in xml</a>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">WebAppContext context = new WebAppContext();
context.setAttribute("org.eclipse.jetty.containerInitializerExclusionPattern",
                     "org.eclipse.jetty.websocket.jsr356.server.deploy.WebSocketServerContainerInitializer|com.acme.*");</code></pre></div></div></dd></dl></div></div></div>
<div class="sect2"><h3 id="websocket-jetty">Jetty Websocket API</h3><div class="paragraph"><p>These pages are works in progress that have not been moved to their respective sections yet.</p></div>
<div class="sect2"><h3 id="jetty-websocket-api">Jetty WebSocket API Usage</h3><div class="paragraph"><p>Jetty provides its own more powerful WebSocket API, with a common core API for both server and client use of WebSockets.</p></div>
<div class="paragraph"><p>It is an event driven API based on WebSocket Messages.</p></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-events">WebSocket Events</h3><div class="paragraph"><p>Every WebSocket can receive various events:</p></div>
<div class="dlist"><dl><dt class="hdlist1">On Connect Event</dt><dd><p>An indication to the WebSocket that the Upgrade has succeeded and the WebSocket is now open.</p><div class="paragraph"><p>You will receive a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>org.eclipse.jetty.websocket.api.Session</code></a> object that references the specific session for this Open Event.</p></div>
<div class="paragraph"><p>For normal WebSockets, it is important to hold onto this Session and use it for communicating with the Remote Endpoint.</p></div>
<div class="paragraph"><p>For Stateless WebSockets, the Session will be passed into each event as it occurs, allowing you to only have 1 instance of a WebSocket serving many Remote Endpoints.</p></div></dd><dt class="hdlist1">On Close Event</dt><dd><p>An indication that the WebSocket is now closed.</p><div class="paragraph"><p>Every Close Event will have a <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/StatusCode.html">Status   Code</a> (and an optional Closure Reason Message)</p></div>
<div class="paragraph"><p>A normal WebSocket closure will go through a Close Handshake where both the Local Endpoint and the Remote Endpoint both send a Close frame to indicate that the connection is closed.</p></div>
<div class="paragraph"><p>It is possible for the Local WebSocket to indicate its desire to Close by issuing a Close frame to the Remote Endpoint, but the Remote Endpoint can continue to send messages until it sends a Close Frame.
This is known as a Half-Open connection, and it is important to note that once the Local Endpoint has send the Close Frame it cannot write anymore WebSocket traffic.</p></div>
<div class="paragraph"><p>On an abnormal closure, such as a connection disconnect or a connection timeout, the low level connection will be terminated without going through a Close Handshake, this will still result in an On Close Event (and likely a corresponding On Error Event).</p></div></dd><dt class="hdlist1">On Error Event</dt><dd><p>If an error occurred, during the implementation, the WebSocket will be notified via this event handler.</p></dd><dt class="hdlist1">On Message Event</dt><dd><p>An indication that a complete message has been received and is ready for handling by your WebSocket.</p><div class="paragraph"><p>This can be a (UTF8) TEXT message or a raw BINARY message.</p></div></dd></dl></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-session">WebSocket Session</h3><div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html">Session</a> object can be used to:</p></div>
<div class="paragraph"><p>The Connection State (is it open or not).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">if(session.isOpen()) {
  // send message
}</code></pre></div></div>
<div class="paragraph"><p>Is the Connection Secure.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">if(session.isSecure()) {
  // connection is using 'wss://'
}</code></pre></div></div>
<div class="paragraph"><p>What was in the Upgrade Request and Response.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">UpgradeRequest req = session.getUpgradeRequest();
String channelName = req.getParameterMap().get("channelName");

UpgradeResponse resp = session.getUpgradeResponse();
String subprotocol = resp.getAcceptedSubProtocol();</code></pre></div></div>
<div class="paragraph"><p>What is the Local and Remote Address.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">InetSocketAddress remoteAddr = session.getRemoteAddress();</code></pre></div></div>
<div class="paragraph"><p>Get and Set the Idle Timeout</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">session.setIdleTimeout(2000); // 2 second timeout</code></pre></div></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-send-message">Send Messages to Remote Endpoint</h3><div class="paragraph"><p>The most important feature of the Session is access to the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/RemoteEndpoint.html"><code>org.eclipse.jetty.websocket.api.RemoteEndpoint</code></a> needed to send messages.</p></div>
<div class="paragraph"><p>With RemoteEndpoint you can choose to send TEXT or BINARY WebSocket messages, or the WebSocket PING and PONG control frames.</p></div>
<div class="sect3"><h4 id="blocking">Blocking Send Message</h4><div class="paragraph"><p>Most calls are blocking in nature, and will not return until the send has completed (or has thrown an exception).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a BINARY message to remote endpoint
ByteBuffer buf = ByteBuffer.wrap(new byte[] { 0x11, 0x22, 0x33, 0x44 });
try
{
    remote.sendBytes(buf);
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint.
This will block until the message is sent, possibly throwing an IOException if unable to send the message.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a TEXT message to remote endpoint
try
{
    remote.sendString("Hello World");
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Text message using the RemoteEndpoint.
This will block until the message is sent, possibly throwing an IOException if unable to send the message.</p></div></div>
<div class="sect3"><h4 id="partial">Send Partial Message</h4><div class="paragraph"><p>If you have a large message to send, and want to send it in pieces and parts, you can utilize the partial message sending methods of RemoteEndpoint.
Just be sure you finish sending your message (<code>isLast == true</code>).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a BINARY message to remote endpoint
// Part 1
ByteBuffer buf1 = ByteBuffer.wrap(new byte[] { 0x11, 0x22 });
// Part 2 (last part)
ByteBuffer buf2 = ByteBuffer.wrap(new byte[] { 0x33, 0x44 });
try
{
    remote.sendPartialBytes(buf1,false);
    remote.sendPartialBytes(buf2,true); // isLast is true
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a Binary message in 2 parts, using the partial message support in RemoteEndpoint.
This will block until each part of the message is sent, possibly throwing an IOException if unable to send the partial message.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a TEXT message to remote endpoint
String part1 = "Hello";
String part2 = " World";
try
{
    remote.sendPartialString(part1,false);
    remote.sendPartialString(part2,true); // last part
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a Text message in 2 parts, using the partial message support in RemoteEndpoint.
This will block until each part of the message is sent, possibly throwing an IOException if unable to send the partial message.</p></div></div>
<div class="sect3"><h4 id="pingpong">Send Ping / Pong Control Frame</h4><div class="paragraph"><p>You can also send Ping and Pong control frames using the RemoteEndpoint.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a PING to remote endpoint
String data = "You There?";
ByteBuffer payload = ByteBuffer.wrap(data.getBytes());
try
{
    remote.sendPing(payload);
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a Ping control frame, with a payload of <code>"You There?"</code> (arriving at Remote Endpoint as a byte array payload).
This will block until the message is sent, possibly throwing an IOException if unable to send the ping frame.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Blocking Send of a PONG to remote endpoint
String data = "Yup, I'm here";
ByteBuffer payload = ByteBuffer.wrap(data.getBytes());
try
{
    remote.sendPong(payload);
}
catch (IOException e)
{
    e.printStackTrace(System.err);
}</code></pre></div></div>
<div class="paragraph"><p>How to send a Pong control frame, with a payload of <code>"Yup I&#8217;m here"</code> (arriving at Remote Endpoint as a byte array payload).
This will block until the message is sent, possibly throwing an IOException if unable to send the pong frame.</p></div>
<div class="paragraph"><p>To be correct in your usage of Pong frames, you should return the same byte array data that you received in the Ping frame.</p></div></div>
<div class="sect3"><h4 id="async">Async Send Message</h4><div class="paragraph"><p>However there are also 2 Async send message methods available:</p></div>
<div class="ulist"><ul><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/RemoteEndpoint.html#sendBytesByFuture(java.nio.ByteBuffer)"><code>RemoteEndpoint.sendBytesByFuture(ByteBuffer message)</code></a></p></li><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/RemoteEndpoint.html#sendStringByFuture(java.lang.String)"><code>RemoteEndpoint.sendStringByFuture(String message)</code></a></p></li></ul></div>
<div class="paragraph"><p>Both return a <code>Future&lt;Void&gt;</code> that can be used to test for success and failure of the message send using standard <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html"><code>java.util.concurrent.Future</code></a> behavior.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a BINARY message to remote endpoint
ByteBuffer buf = ByteBuffer.wrap(new byte[] { 0x11, 0x22, 0x33, 0x44 });
remote.sendBytesByFuture(buf);</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint.
The message will be enqueued for outgoing write, but you will not know if it succeeded or failed.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a BINARY message to remote endpoint
ByteBuffer buf = ByteBuffer.wrap(new byte[] { 0x11, 0x22, 0x33, 0x44 });
try
{
    Future&lt;Void&gt; fut = remote.sendBytesByFuture(buf);
    // wait for completion (forever)
    fut.get();
}
catch (ExecutionException | InterruptedException e)
{
    // Send failed
    e.printStackTrace();
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint, tracking the <code>Future&lt;Void&gt;</code> to know if the send succeeded or failed.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a BINARY message to remote endpoint
ByteBuffer buf = ByteBuffer.wrap(new byte[] { 0x11, 0x22, 0x33, 0x44 });
Future&lt;Void&gt; fut = null;
try
{
    fut = remote.sendBytesByFuture(buf);
    // wait for completion (timeout)
    fut.get(2,TimeUnit.SECONDS);
}
catch (ExecutionException | InterruptedException e)
{
    // Send failed
    e.printStackTrace();
}
catch (TimeoutException e)
{
    // timeout
    e.printStackTrace();
    if (fut != null)
    {
        // cancel the message
        fut.cancel(true);
    }
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint, tracking the <code>Future&lt;Void&gt;</code> and waiting only prescribed amount of time for the send to complete, cancelling the message if the timeout occurs.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a TEXT message to remote endpoint
remote.sendStringByFuture("Hello World");</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Text message using the RemoteEndpoint.
The message will be enqueued for outgoing write, but you will not know if it succeeded or failed.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a TEXT message to remote endpoint
try
{
    Future&lt;Void&gt; fut = remote.sendStringByFuture("Hello World");
    // wait for completion (forever)
    fut.get();
}
catch (ExecutionException | InterruptedException e)
{
    // Send failed
    e.printStackTrace();
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint, tracking the <code>Future&lt;Void&gt;</code> to know if the send succeeded or failed.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">RemoteEndpoint remote = session.getRemote();

// Async Send of a TEXT message to remote endpoint
Future&lt;Void&gt; fut = null;
try
{
    fut = remote.sendStringByFuture("Hello World");
    // wait for completion (timeout)
    fut.get(2,TimeUnit.SECONDS);
}
catch (ExecutionException | InterruptedException e)
{
    // Send failed
    e.printStackTrace();
}
catch (TimeoutException e)
{
    // timeout
    e.printStackTrace();
    if (fut != null)
    {
        // cancel the message
        fut.cancel(true);
    }
}</code></pre></div></div>
<div class="paragraph"><p>How to send a simple Binary message using the RemoteEndpoint, tracking the <code>Future&lt;Void&gt;</code> and waiting only prescribed amount of time for the send to complete, cancelling the message if the timeout occurs.</p></div></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-annotations">Using WebSocket Annotations</h3><div class="paragraph"><p>The most basic form of WebSocket is a marked up POJO with annotations
provided by the Jetty WebSocket API.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples.echo;

import org.eclipse.jetty.websocket.api.Session;
import org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;
import org.eclipse.jetty.websocket.api.annotations.WebSocket;

/**
 * Example EchoSocket using Annotations.
 */
@WebSocket(maxTextMessageSize = 64 * 1024)
public class AnnotatedEchoSocket
{
    @OnWebSocketMessage
    public void onText(Session session, String message)
    {
        if (session.isOpen())
        {
            System.out.printf("Echoing back message [%s]%n",message);
            // echo the message back
            session.getRemote().sendString(message,null);
        }
    }
}</code></pre></div></div>
<div class="paragraph"><p>The above example is a simple WebSocket echo endpoint that will echo back any TEXT messages it receives.</p></div>
<div class="paragraph"><p>This implementation is using a stateless approach to a Echo socket, as the Session is being passed into the Message event as the event occurs.
This would allow you to reuse the single instance of the AnnotatedEchoSocket for working with multiple endpoints.</p></div>
<div class="paragraph"><p>The annotations you have available:</p></div>
<div class="dlist"><dl><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/WebSocket.html">@WebSocket</a></dt><dd><p>A required class level annotation.</p><div class="paragraph"><p>Flags this POJO as being a WebSocket.</p></div>
<div class="paragraph"><p>The class must be not abstract and public.</p></div></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/OnWebSocketConnect.html">@OnWebSocketConnect</a></dt><dd><p>An optional method level annotation.</p><div class="paragraph"><p>Flags one method in the class as receiving the On Connect event.</p></div>
<div class="paragraph"><p>Method must be public, not abstract, return void, and have a single <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html">Session</a> parameter.</p></div></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/OnWebSocketClose.html">@OnWebSocketClose</a></dt><dd><p>An optional method level annotation.</p><div class="paragraph"><p>Flags one method in the class as receiving the On Close event.</p></div>
<div class="paragraph"><p>Method signature must be public, not abstract, and return void.</p></div>
<div class="paragraph"><p>The method parameters:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>Session</code></a> (optional)</p></li><li><p><code>int closeCode</code> (required)</p></li><li><p><code>String closeReason</code> (required)</p></li></ol></div></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/OnWebSocketMessage.html">@OnWebSocketMessage</a></dt><dd><p>An optional method level annotation.</p><div class="paragraph"><p>Flags up to 2 methods in the class as receiving On Message events.</p></div>
<div class="paragraph"><p>You can have 1 method for TEXT messages, and 1 method for BINARY messages.</p></div>
<div class="paragraph"><p>Method signature must be public, not abstract, and return void.</p></div>
<div class="paragraph"><p>The method parameters for Text messages:</p></div>
<div class="ulist"><ul><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>Session</code></a> (optional)</p></li><li><p><code>String text</code> (required)</p><div class="paragraph"><p>The method parameters for Binary messages:</p></div></li><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>Session</code></a> (optional)</p></li><li><p><code>byte buf[]</code> (required)</p></li><li><p><code>int offset</code> (required)</p></li><li><p><code>int length</code> (required)</p></li></ul></div></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/OnWebSocketError.html">@OnWebSocketError</a></dt><dd><p>An optional method level annotation.</p><div class="paragraph"><p>Flags one method in the class as receiving Error events from the WebSocket implementation.</p></div>
<div class="paragraph"><p>Method signatures must be public, not abstract, and return void.</p></div>
<div class="paragraph"><p>The method parameters:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>Session</code></a> (optional)</p></li><li><p><code>Throwable cause</code> (required)</p></li></ol></div></dd><dt class="hdlist1"><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/annotations/OnWebSocketFrame.html">@OnWebSocketFrame</a></dt><dd><p>An optional method level annotation.</p><div class="paragraph"><p>Flags one method in the class as receiving Frame events from the WebSocket implementation after they have been processed by any extensions declared during the Upgrade handshake.</p></div>
<div class="paragraph"><p>Method signatures must be public, not abstract, and return void.</p></div>
<div class="paragraph"><p>The method parameters:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/Session.html"><code>Session</code></a> (optional)</p></li><li><p><a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/extensions/Frame.html"><code>Frame</code></a> (required)</p><div class="paragraph"><p>The Frame received will be notified on this method, then be processed by Jetty, possibly resulting in another event, such as On Close, or On Message.
Changes to the Frame will not be seen by Jetty.</p></div></li></ol></div></dd></dl></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-listener">Using WebSocketListener</h3><div class="paragraph"><p>The basic form of a WebSocket using the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/api/WebSocketListener.html"><code>org.eclipse.jetty.websocket.api.WebSocketListener</code></a> for incoming events.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples.echo;

import org.eclipse.jetty.websocket.api.Session;
import org.eclipse.jetty.websocket.api.WebSocketListener;

/**
 * Example EchoSocket using Listener.
 */
public class ListenerEchoSocket implements WebSocketListener
{
    private Session outbound;

    @Override
    public void onWebSocketBinary(byte[] payload, int offset, int len)
    {
        /* only interested in text messages */
    }

    @Override
    public void onWebSocketClose(int statusCode, String reason)
    {
        this.outbound = null;
    }

    @Override
    public void onWebSocketConnect(Session session)
    {
        this.outbound = session;
    }

    @Override
    public void onWebSocketError(Throwable cause)
    {
        cause.printStackTrace(System.err);
    }

    @Override
    public void onWebSocketText(String message)
    {
        if ((outbound != null) &amp;&amp; (outbound.isOpen()))
        {
            System.out.printf("Echoing back message [%s]%n",message);
            // echo the message back
            outbound.getRemote().sendString(message,null);
        }
    }
}</code></pre></div></div>
<div class="paragraph"><p>This is by far the most basic and best performing (speed and memory wise) WebSocket implementation you can create.
If the listener is too much work for you, you can instead opt for the WebSocketAdapter</p></div></div>
<div class="sect2"><h3 id="jetty-websocket-api-adapter">Using the WebSocketAdapter</h3><div class="paragraph"><p>A basic adapter for managing the Session object on the WebSocketListener.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples.echo;

import java.io.IOException;

import org.eclipse.jetty.websocket.api.WebSocketAdapter;

/**
 * Example EchoSocket using Adapter.
 */
public class AdapterEchoSocket extends WebSocketAdapter
{
    @Override
    public void onWebSocketText(String message)
    {
        if (isConnected())
        {
            try
            {
                System.out.printf("Echoing back message [%s]%n",message);
                // echo the message back
                getRemote().sendString(message);
            }
            catch (IOException e)
            {
                e.printStackTrace(System.err);
            }
        }
    }
}</code></pre></div></div>
<div class="paragraph"><p>This is a convenience class to make using the WebSocketListener easier, and provides some useful methods to check the state of the Session.</p></div></div>
<div class="sect2"><h3 id="jetty-websocket-server-api">Jetty WebSocket Server API</h3><div class="paragraph"><p>Jetty provides the ability to wire up WebSocket endpoints to Servlet Path Specs via the use of a WebSocketServlet bridge servlet.</p></div>
<div class="paragraph"><p>Internally, Jetty manages the HTTP Upgrade to WebSocket and migration from a HTTP Connection to a WebSocket Connection.</p></div>
<div class="paragraph"><p>This will only work when running within the Jetty Container (unlike past Jetty technologies, you cannot get Jetty WebSocket server functionality running Jetty within other containers like JBoss, Tomcat, or WebLogic).</p></div>
<div class="sect3"><h4>The Jetty WebSocketServlet</h4><div class="paragraph"><p>To wire up your WebSocket to a specific path via the WebSocketServlet, you will need to extend org.eclipse.jetty.websocket.servlet.WebSocketServlet and specify what WebSocket object should be created with incoming Upgrade requests.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples;

import javax.servlet.annotation.WebServlet;

import org.eclipse.jetty.websocket.servlet.WebSocketServlet;
import org.eclipse.jetty.websocket.servlet.WebSocketServletFactory;

@SuppressWarnings("serial")
@WebServlet(name = "MyEcho WebSocket Servlet", urlPatterns = { "/echo" })
public class MyEchoServlet extends WebSocketServlet
{
    @Override
    public void configure(WebSocketServletFactory factory)
    {
        // set a 10 second timeout
        factory.getPolicy().setIdleTimeout(10000);

        // register MyEchoSocket as the WebSocket to create on Upgrade
        factory.register(MyEchoSocket.class);
    }
}</code></pre></div></div>
<div class="paragraph"><p>This example will create a Servlet mapped via the <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/annotation/WebServlet.html">@WebServlet</a> annotation to the Servlet path spec of <code>"/echo"</code> (or you can do this manually in the <code>WEB-INF/web.xml</code> of your web application) which will create MyEchoSocket instances when encountering HTTP Upgrade requests.</p></div>
<div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketServlet.html#configure(org.eclipse.jetty.websocket.servlet.WebSocketServletFactory)"><code>WebSocketServlet.configure(WebSocketServletFactory factory)</code></a> is where you put your specific configuration for your WebSocket.
In the example we specify a 10 second idle timeout and register MyEchoSocket with the default WebSocketCreator the WebSocket class we want to be created on Upgrade.</p></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">It is important that you take in account any firewall or router timeouts
when configuring websockets. Be sure the websocket configuration is
lower than your firewall or router.</td></tr></table></div></blockquote></div></div>
<div class="sect3"><h4>Using the WebSocketCreator</h4><div class="paragraph"><p>All WebSocket&#8217;s are created via whatever <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketCreator.html">WebSocketCreator</a> you have registered with the <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketServletFactory.html">WebSocketServletFactory</a>.</p></div>
<div class="paragraph"><p>By default, the WebSocketServletFactory is a simple WebSocketCreator capable of creating a single WebSocket object.
Use <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketServletFactory.html#register(java.lang.Class)"><code>WebSocketCreator.register(Class&lt;?&gt; websocket)</code></a> to tell the WebSocketServletFactory which class it should instantiate (make sure it has a default constructor).</p></div>
<div class="paragraph"><p>If you have a more complicated creation scenario, you might want to provide your own WebSocketCreator that bases the WebSocket it creates off of information present in the UpgradeRequest object.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples;

import org.eclipse.jetty.websocket.servlet.ServletUpgradeRequest;
import org.eclipse.jetty.websocket.servlet.ServletUpgradeResponse;
import org.eclipse.jetty.websocket.servlet.WebSocketCreator;

public class MyAdvancedEchoCreator implements WebSocketCreator
{
    private MyBinaryEchoSocket binaryEcho;
    private MyEchoSocket textEcho;

    public MyAdvancedEchoCreator()
    {
        // Create the reusable sockets
        this.binaryEcho = new MyBinaryEchoSocket();
        this.textEcho = new MyEchoSocket();
    }

    @Override
    public Object createWebSocket(ServletUpgradeRequest req, ServletUpgradeResponse resp)
    {
        for (String subprotocol : req.getSubProtocols())
        {
            if ("binary".equals(subprotocol))
            {
                resp.setAcceptedSubProtocol(subprotocol);
                return binaryEcho;
            }
            if ("text".equals(subprotocol))
            {
                resp.setAcceptedSubProtocol(subprotocol);
                return textEcho;
            }
        }

        // No valid subprotocol in request, ignore the request
        return null;
    }
}</code></pre></div></div>
<div class="paragraph"><p>Here we show a WebSocketCreator that will utilize the <a href="http://tools.ietf.org/html/rfc6455#section-1.9">WebSocket subprotocol</a> information from request to determine what WebSocket type should be
created.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples;

import javax.servlet.annotation.WebServlet;

import org.eclipse.jetty.websocket.servlet.WebSocketServlet;
import org.eclipse.jetty.websocket.servlet.WebSocketServletFactory;

@SuppressWarnings("serial")
@WebServlet(name = "MyAdvanced Echo WebSocket Servlet", urlPatterns = { "/advecho" })
public class MyAdvancedEchoServlet extends WebSocketServlet
{
    @Override
    public void configure(WebSocketServletFactory factory)
    {
        // set a 10 second timeout
        factory.getPolicy().setIdleTimeout(10000);

        // set a custom WebSocket creator
        factory.setCreator(new MyAdvancedEchoCreator());
    }
}</code></pre></div></div>
<div class="paragraph"><p>When you want a custom WebSocketCreator, use <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketServletFactory.html#setCreator(org.eclipse.jetty.websocket.servlet.WebSocketCreator)"><code>WebSocketServletFactory.setCreator(WebSocketCreator creator)</code></a> and the WebSocketServletFactory will use your creator for all incoming Upgrade requests on this servlet.</p></div>
<div class="paragraph"><p>Other uses for a WebSocketCreator:</p></div>
<div class="ulist"><ul><li><p>Controlling the selection of WebSocket subprotocol</p></li><li><p>Performing any WebSocket origin you deem important.</p></li><li><p>Obtaining the HTTP headers from incoming request</p></li><li><p>Obtaining the Servlet HttpSession object (if it exists)</p></li><li><p>Specifying a response status code and reason</p></li></ul></div>
<div class="paragraph"><p>If you don&#8217;t want to accept the upgrade, simply return null from the link:http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/websocket/servlet/WebSocketCreator.html#createWebSocket(org.eclipse.jetty.websocket.api.UpgradeRequest, org.eclipse.jetty.websocket.api.UpgradeResponse)[<code>WebSocketCreator.createWebSocket(UpgradeRequest req, UpgradeResponse resp)</code>] method.</p></div></div></div>
<div class="sect2"><h3 id="jetty-websocket-client-api">Jetty WebSocket Client API</h3><div class="paragraph"><p>Jetty also provides a Jetty WebSocket Client Library to write make talking to WebSocket servers easier.</p></div>
<div class="paragraph"><p>To use the Jetty WebSocket Client on your own Java project you will need the following maven artifacts.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.jetty.websocket&lt;/groupId&gt;
  &lt;artifactId&gt;websocket-client&lt;/artifactId&gt;
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div>
<div class="sect3"><h4>The WebSocketClient</h4><div class="paragraph"><p>To use the WebSocketClient you will need to hook up a WebSocket object instance to a specific destination WebSocket URI.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples;

import java.net.URI;
import java.util.concurrent.TimeUnit;

import org.eclipse.jetty.websocket.client.ClientUpgradeRequest;
import org.eclipse.jetty.websocket.client.WebSocketClient;

/**
 * Example of a simple Echo Client.
 */
public class SimpleEchoClient
{
    public static void main(String[] args)
    {
        String destUri = "ws://echo.websocket.org";
        if (args.length &gt; 0)
        {
            destUri = args[0];
        }

        WebSocketClient client = new WebSocketClient();
        SimpleEchoSocket socket = new SimpleEchoSocket();
        try
        {
            client.start();

            URI echoUri = new URI(destUri);
            ClientUpgradeRequest request = new ClientUpgradeRequest();
            client.connect(socket,echoUri,request);
            System.out.printf("Connecting to : %s%n",echoUri);

            // wait for closed socket connection.
            socket.awaitClose(5,TimeUnit.SECONDS);
        }
        catch (Throwable t)
        {
            t.printStackTrace();
        }
        finally
        {
            try
            {
                client.stop();
            }
            catch (Exception e)
            {
                e.printStackTrace();
            }
        }
    }
}</code></pre></div></div>
<div class="paragraph"><p>The above example connects to a remote WebSocket server and hands off a SimpleEchoSocket to perform the logic on the websocket once connected, waiting for the socket to register that it has closed.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">//
//  ========================================================================
//  Copyright (c) 1995-2018 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package examples;

import java.util.concurrent.CountDownLatch;
import java.util.concurrent.Future;
import java.util.concurrent.TimeUnit;

import org.eclipse.jetty.websocket.api.Session;
import org.eclipse.jetty.websocket.api.StatusCode;
import org.eclipse.jetty.websocket.api.annotations.OnWebSocketClose;
import org.eclipse.jetty.websocket.api.annotations.OnWebSocketConnect;
import org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;
import org.eclipse.jetty.websocket.api.annotations.WebSocket;

/**
 * Basic Echo Client Socket
 */
@WebSocket(maxTextMessageSize = 64 * 1024)
public class SimpleEchoSocket
{
    private final CountDownLatch closeLatch;
    @SuppressWarnings("unused")
    private Session session;

    public SimpleEchoSocket()
    {
        this.closeLatch = new CountDownLatch(1);
    }

    public boolean awaitClose(int duration, TimeUnit unit) throws InterruptedException
    {
        return this.closeLatch.await(duration,unit);
    }

    @OnWebSocketClose
    public void onClose(int statusCode, String reason)
    {
        System.out.printf("Connection closed: %d - %s%n",statusCode,reason);
        this.session = null;
        this.closeLatch.countDown(); // trigger latch
    }

    @OnWebSocketConnect
    public void onConnect(Session session)
    {
        System.out.printf("Got connect: %s%n",session);
        this.session = session;
        try
        {
            Future&lt;Void&gt; fut;
            fut = session.getRemote().sendStringByFuture("Hello");
            fut.get(2,TimeUnit.SECONDS); // wait for send to complete.

            fut = session.getRemote().sendStringByFuture("Thanks for the conversation.");
            fut.get(2,TimeUnit.SECONDS); // wait for send to complete.

            session.close(StatusCode.NORMAL,"I'm done");
        }
        catch (Throwable t)
        {
            t.printStackTrace();
        }
    }

    @OnWebSocketMessage
    public void onMessage(String msg)
    {
        System.out.printf("Got msg: %s%n",msg);
    }
}</code></pre></div></div>
<div class="paragraph"><p>When the SimpleEchoSocket connects, it sends 2 Text messages and then closes the socket.</p></div>
<div class="paragraph"><p>The onMessage(String msg) receives the responses from the remote server WebSocket and outputs them to the console.</p></div></div></div></div>
<div class="sect2"><h3 id="continuations">Continuations</h3><div class="sect2"><h3 id="continuations-intro">Introduction</h3><div class="paragraph"><p>Continuations are a mechanism to implement Asynchronous servlets similar to asynchronous features in Servlet 3.0, but provides a simpler and portable interface.</p></div>
<div class="sect3"><h4>Why Asynchronous Servlets ?</h4><div class="sect4"><h5>Not Asynchronous IO</h5><div class="paragraph"><p>The concept of Asynchronous Servlets is often confused with Asynchronous IO or the use of NIO.
However, Asynchronous Servlets are not primarily motivated by asynchronous IO, since:</p></div>
<div class="ulist"><ul><li><p>HTTP Requests are mostly small and arrive in a single packet. Servlets rarely block on requests.</p></li><li><p>Many responses are small and fit within the server buffers, so servlets often do not block writing responses.</p></li><li><p>Even if we could expose asynchronous IO in a servlet, it is a hard paradigm to program. For example what would an application do if it read 2 bytes of a 3 byte UTF-8 character?
It would have to buffer and wait for more bytes.
This is best done by the container rather than the application.</p></li></ul></div></div>
<div class="sect4"><h5>Asynchronous Waiting</h5><div class="paragraph"><p>The main use-case for asynchronous servlets is waiting for non-IO events or resources.
Many web applications need to wait at some stage during the processing of a HTTP request, for example:</p></div>
<div class="ulist"><ul><li><p>Waiting for a resource to be available before processing the request (e.g., thread, JDBC Connection).</p></li><li><p>Waiting for an application event in an AJAX Comet application (e.g., chat message, price change).</p></li><li><p>Waiting for a response from a remote service (e.g., RESTful or SOAP call to a web service).</p></li></ul></div>
<div class="paragraph"><p>The servlet API (pre 2.5) supports only a synchronous call style, so that any waiting that a servlet needs to do must be with blocking.
Unfortunately this means that the thread allocated to the request must be held during that wait along with all its resources: kernel thread, stack memory and often pooled buffers, character converters, EE authentication context, etc.
It is wasteful of system resources to hold these resources while waiting. Significantly better scalability and quality of service can be achieved if waiting is done asynchronously.</p></div></div></div>
<div class="sect3"><h4>Asynchronous Servlet Examples</h4><div class="sect4"><h5>AJAX Comet Server Push</h5><div class="paragraph"><p>Web 2.0 applications can use the <a href="http://en.wikipedia.org/wiki/Comet_(programming)">comet</a> technique (aka AJAX Push, Server Push, Long Polling) to dynamically update a web page without refreshing the entire page.</p></div>
<div class="paragraph"><p>Consider a stock portfolio web application. Each browser will send a long poll request to the server asking for any of the user&#8217;s stock prices that have changed. The server will receive the long poll requests from all its clients, but will not immediately respond.
Instead the server waits until a stock price changes, at which time it will send a response to each of the clients with that stock in their portfolio.
The clients that receive the long poll response will immediately send another long poll request so they may obtain future price changes.</p></div>
<div class="paragraph"><p>Thus the server will typically hold a long poll request for every connected user, so if the servlet is not asynchronous, there would need more than 1000 threads available to handle 1000 simultaneous users.
1000 threads can consume over 256MB of memory; that would be better used for the application rather than idly waiting for a price to change.</p></div>
<div class="paragraph"><p>If the servlet is asynchronous, then the number of threads needed is governed by the time to generate each response and the frequency of price changes.
If every user receives a price every 10 seconds and the response takes 10ms to generate, then 1000 users can be serviced with just 1 thread, and the 256MB of stack be freed for other purposes.</p></div>
<div class="paragraph"><p>For more on comet see the <a href="http://cometd.org/">cometd</a> project that works asynchronously with Jetty.</p></div></div>
<div class="sect4"><h5>Asynchronous RESTful Web Service</h5><div class="paragraph"><p>Consider a web application that accesses a remote web service (e.g., SOAP service or RESTful service).
Typically a remote web service can take hundreds of milliseconds to produce a response&#8201;&#8212;&#8201;eBay&#8217;s RESTful web service frequently takes 350ms to respond with a list of auctions matching a given keyword&#8201;&#8212;&#8201;while only a few 10s of milliseconds of CPU time are needed to locally process a request and generate a response.</p></div>
<div class="paragraph"><p>To handle 1000 requests per second, which each perform a 200ms web service call, a webapp would needs 1000*(200+20)/1000 = 220 threads and 110MB of stack memory.
It would also be vulnerable to thread starvation if bursts occurred or the web service became slower. If handled asynchronously, the web application would not need to hold a thread while waiting for web service response.
Even if the asynchronous mechanism cost 10ms (which it doesn&#8217;t), then this webapp would need 1000*(20+10)/1000 = 30 threads and 15MB of stack memory.
This is a 86% reduction in the resources required and 95MB more memory would be available for the application.
Furthermore, if multiple web services request are required, the asynchronous approach allows these to be made in parallel rather than serially, without allocating additional threads.</p></div>
<div class="paragraph"><p>For an example of Jetty&#8217;s solution, see the <a href="https://webtide.com/async-rest-jetty-9/">Asynchronous REST example</a></p></div></div>
<div class="sect4"><h5>Quality of Service (e.g., JDBC Connection Pool)</h5><div class="paragraph"><p>Consider a web application handling on average 400 requests per second, with each request interacting with the database for 50ms.
To handle this load, 400*50/1000 = 20 JDBC connections are need on average.
However, requests do not come at an even rate and there are often bursts and pauses.
To protect a database from bursts, often a JDBC connection pool is applied to limit the simultaneous requests made on the database.
So for this application, it would be reasonable to apply a JDBC pool of 30 connections, to provide for a 50% margin.</p></div>
<div class="paragraph"><p>If momentarily the request rate doubled, then the 30 connections would only be able to handle 600 requests per second, and 200 requests per second would join those waiting on the JDBC Connection pool.
Then if the servlet container had a thread pool with 200 threads, that would be entirely consumed by threads waiting for JDBC connections in 1 second of this request rate.
After 1s, the web application would be unable to process any requests at all because no threads would be available.
Even requests that do not use the database would be blocked due to thread starvation.
To double the thread pool would require an additional 100MB of stack memory and would only give the application another 1s of grace under load!</p></div>
<div class="paragraph"><p>This thread starvation situation can also occur if the database runs slowly or is momentarily unavailable.
Thread starvation is a very frequently reported problem, and causes the entire web service to lock up and become unresponsive.
If the web container was able to suspend the requests waiting for a JDBC connection without threads, then thread starvation would not occur, as only 30 threads would be consumed by requests accessing the database and the other 470 threads would be available to process the request that do not access the database.</p></div>
<div class="paragraph"><p>For an example of Jetty&#8217;s solution, see the Quality of Service Filter.</p></div></div></div>
<div class="sect3"><h4>Servlet Threading Model</h4><div class="paragraph"><p>The scalability issues of Java servlets are caused mainly by the server threading model:</p></div>
<div class="sect4"><h5>Thread per connection</h5><div class="paragraph"><p>The traditional IO model of Java associated a thread with every TCP/IP connection.
If you have a few very active threads, this model can scale to a very high number of requests per second.</p></div>
<div class="paragraph"><p>However, the traffic profile typical of many web applications is many persistent HTTP connections that are mostly idle while users read pages or search for the next link to click. With such profiles, the thread-per-connection model can have problems scaling to the thousands of threads required to support thousands of users on large scale deployments.</p></div></div>
<div class="sect4"><h5>Thread per request</h5><div class="paragraph"><p>The Java NIO libraries support asynchronous IO, so that threads no longer need to be allocated to every connection.
When the connection is idle (between requests), then the connection is added to an NIO select set, which allows one thread to scan many connections for activity.
Only when IO is detected on a connection is a thread allocated to it.
However, the servlet 2.5 API model still requires a thread to be allocated for the duration of the request handling.</p></div>
<div class="paragraph"><p>This thread-per-request model allows much greater scaling of connections (users) at the expense of a small reduction to maximum requests per second due to extra scheduling latency.</p></div></div>
<div class="sect4"><h5>Asynchronous Request handling</h5><div class="paragraph"><p>The Jetty Continuation (and the servlet 3.0 asynchronous) API introduce a change in the servlet API that allows a request to be dispatched multiple times to a servlet.
If the servlet does not have the resources required on a dispatch, then the request is suspended (or put into asynchronous mode), so that the servlet may return from the dispatch without a response being sent.
When the waited-for resources become available, the request is re-dispatched to the servlet, with a new thread, and a response is generated.</p></div></div></div></div>
<div class="sect2"><h3 id="continuations-using">Using Continuations</h3><div class="paragraph"><p>Asynchronous servlets were originally introduced with Jetty 6 Continuations, which were a Jetty specific mechanism.
From Jetty 7 onwards, the Continuations API has been extended to be a general purpose API that will work asynchronously on any servlet-3.0 container, as well as on Jetty 6, 7, or 8.
Continuations will also work in blocking mode with any servlet 2.5 container.</p></div>
<div class="sect3"><h4>Obtaining a Continuation</h4><div class="paragraph"><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/continuation/ContinuationSupport.html">ContinuationSupport</a> factory class can be used to obtain a continuation instance associated with a request:</p></div>
<div class="paragraph"><p><code>Continuation continuation = ContinuationSupport.getContinuation(request);</code></p></div></div>
<div class="sect3"><h4>Suspending a Request</h4><div class="paragraph"><p>To suspend a request, the suspend method can be called on the continuation:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">    void doGet(HttpServletRequest request, HttpServletResponse response)
      {
      ...
      // optionally:
      // continuation.setTimeout(long);
      continuation.suspend();
      ...
      }</code></pre></div></div>
<div class="paragraph"><p>The lifecycle of the request will be extended beyond the return to the  container from the <code>Servlet.service(&#8230;&#8203;)</code> method and <code>Filter.doFilter(&#8230;&#8203;)</code> calls. When these dispatch methods return, the suspended request will not yet be committed and a response will not yet be sent to the HTTP client.</p></div>
<div class="paragraph"><p>Once the request has been suspended, the continuation should be registered with an asynchronous service so that it may be used by an asynchronous callback when the waited-for event happens.</p></div>
<div class="paragraph"><p>The request will be suspended until either <code>continuation.resume()</code> or <code>continuation.complete()</code> is called. If neither is called then the continuation will timeout.
The timeout should be set before the suspend, by a call to <code>continuation.setTimeout(long)</code> if no timeout is set, then the default period is used.
If no timeout listeners resume or complete the continuation, then the continuation is resumed with <code>continuation.isExpired()</code> true.</p></div>
<div class="paragraph"><p>Suspension is analogous to the servlet 3.0 <code>request.startAsync()</code> method. Unlike jetty 6 continuations, an exception is not thrown by suspend and the method should return normally.
This allows the registration of the continuation to occur after suspension and avoids the need for a mutex.
If an exception is desirable (to bypass code that is unaware of continuations and may try to commit the response), then <code>continuation.undispatch()</code> may be called to exit the current thread from the current dispatch by throwing a <code>ContinuationThrowable</code>.</p></div></div>
<div class="sect3"><h4>Resuming a Request</h4><div class="paragraph"><p>Once an asynchronous event has occurred, the continuation can be resumed:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">    void myAsyncCallback(Object results)
    {
    continuation.setAttribute("results",results);
    continuation.resume();
    }</code></pre></div></div>
<div class="paragraph"><p>When a continuation is resumed, the request is re-dispatched to the servlet container, almost as if the request had been received again.
However during the re-dispatch, the <code>continuation.isInitial()</code> method returns false and any attributes set by the asynchronous handler are available.</p></div>
<div class="paragraph"><p>Continuation resume is analogous to Servlet 3.0 <code>AsyncContext.dispatch()</code>.</p></div></div>
<div class="sect3"><h4>Completing a Request</h4><div class="paragraph"><p>As an alternative to resuming a request, an asynchronous handler may  write the response itself. After writing the response, the handler must indicate the request handling is complete by calling the complete method:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">    void myAsyncCallback(Object results)
    {
      writeResults(continuation.getServletResponse(),results);
      continuation.complete();
    }</code></pre></div></div>
<div class="paragraph"><p>After complete is called, the container schedules the response to be  committed and flushed. Continuation complete is analogous to Servlet 3.0 <code>AsyncContext.complete()</code>.</p></div></div>
<div class="sect3"><h4>Continuation Listeners</h4><div class="paragraph"><p>An application may monitor the status of a continuation by using a ContinuationListener:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">    void doGet(HttpServletRequest request, HttpServletResponse response)
    {
      ...

      Continuation continuation = ContinuationSupport.getContinuation(request);
      continuation.addContinuationListener(new ContinuationListener()
      {
        public void onTimeout(Continuation continuation) { ... }
        public void onComplete(Continuation continuation) { ... }
      });

      continuation.suspend();
      ...
    }</code></pre></div></div>
<div class="paragraph"><p>Continuation listeners are analogous to Servlet 3.0 AsyncListeners.</p></div></div></div>
<div class="sect2"><h3 id="continuations-patterns">Common Continuation Patterns</h3><div class="sect3"><h4>Suspend Resume Pattern</h4><div class="paragraph"><p>The suspend/resume style is used when a servlet and/or filter is used to generate the response after an asynchronous wait that is terminated by an asynchronous handler.
Typically a request attribute is used to pass results and to indicate if the request has already been suspended.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">void doGet(HttpServletRequest request, HttpServletResponse response)
{
     // if we need to get asynchronous results
     Object results = request.getAttribute("results");
     if (results==null)
     {
       final Continuation continuation = ContinuationSupport.getContinuation(request);

       // if this is not a timeout
       if (continuation.isExpired())
       {
         sendMyTimeoutResponse(response);
         return;
       }

       // suspend the request
       continuation.suspend(); // always suspend before registration

       // register with async service.  The code here will depend on the
       // the service used (see Jetty HttpClient for example)
       myAsyncHandler.register(new MyHandler()
       {
          public void onMyEvent(Object result)
          {
            continuation.setAttribute("results",results);
            continuation.resume();
          }
       });
       return; // or continuation.undispatch();
     }

     // Send the results
     sendMyResultResponse(response,results);
}</code></pre></div></div>
<div class="paragraph"><p>This style is very good when the response needs the facilities of the servlet container (e.g., it uses a web framework) or if one event may resume many requests so the container&#8217;s thread pool can be used to handle each of them.</p></div></div>
<div class="sect3"><h4>Suspend Continue Pattern</h4><div class="paragraph"><p>The suspend/complete style is used when an asynchronous handler is used to generate the response:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">void doGet(HttpServletRequest request, HttpServletResponse response)
{
     final Continuation continuation = ContinuationSupport.getContinuation(request);

     // if this is not a timeout
     if (continuation.isExpired())
     {
       sendMyTimeoutResponse(request,response);
       return;
     }

     // suspend the request
     continuation.suspend(); // response may be wrapped.

     // register with async service.  The code here will depend on the
     // the service used (see Jetty HttpClient for example)
     myAsyncHandler.register(new MyHandler()
     {
       public void onMyEvent(Object result)
       {
         sendMyResultResponse(continuation.getServletResponse(),results);
         continuation.complete();
       }
     });
}</code></pre></div></div>
<div class="paragraph"><p>This style is very good when the response does not need the facilities of the servlet container (e.g., it does not use a web framework) and if an event will resume only one continuation.
If many responses are to be sent (e.g., a chat room), then writing one response may block and cause a DOS on the other responses.</p></div></div>
<div class="sect3"><h4>Examples</h4><div class="ulist"><ul><li><p>The <a href="https://github.com/eclipse/jetty.project/blob/jetty-8/test-jetty-webapp/src/main/java/com/acme/ChatServlet.java">ChatServlet example</a> shows how the suspend/resume style can be used to directly code a chat room (See similar <a href="https://github.com/eclipse/jetty.project/blob/master/tests/test-webapps/test-jetty-webapp/src/main/java/com/acme/ChatServlet.java">example</a> using Async Servlets).
The same principles are applied to frameworks like <a href="http://cometd.org/">cometd</a> which provide an richer environment for such applications, based on Continuations.</p></li><li><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/servlets/QoSFilter.html">QoSFilter</a> uses suspend/resume style to limit the number of requests simultaneously within the filter.
This can be used to protect a JDBC connection pool or other limited resource from too many simultaneous requests.</p><div class="paragraph"><p>If too many requests are received, the extra requests wait for a short time on a semaphore, before being suspended.
As requests within the filter return, they use a priority queue to resume the suspended requests.
This allows your authenticated or priority users to get a better share of your server&#8217;s resources when the machine is under load.</p></div></li><li><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/servlets/DoSFilter.html">DosFilter</a> is similar to the QoSFilter, but protects a web application from a denial of service attack, as much as is possible from within a web application.</p><div class="paragraph"><p>If too many requests are detected coming from one source, then those requests are suspended and a warning generated.
This works on the assumption that the attacker may be written in simple blocking style, so by suspending you are hopefully consuming their resources. True protection from DOS can only be achieved by network devices (or eugenics :)).</p></div></li><li><p>The <a href="http://www.eclipse.org/jetty/javadoc/9.4.15-SNAPSHOT/org/eclipse/jetty/proxy/ProxyServlet.html">ProxyServlet</a> uses the suspend/complete style and the Jetty asynchronous HTTP client to implement a scalable Proxy server (or transparent proxy).</p></li></ul></div></div></div></div>
<div class="sect2"><h3 id="frameworks">Frameworks</h3><div class="sect2"><h3 id="framework-jetty-spring">Spring Setup</h3><div class="paragraph"><p>You can assemble and configure Jetty in code or with almost any IoC style framework including Spring.
If all you want to do is setup a Jetty server in your stock Spring usage, simply look at the xml snippet below as an example.
If you want to replace the jetty-xml being used to start the normal Jetty distribution with spring, you may do so however currently it will not leverage the rest of the module system.</p></div>
<div class="sect3"><h4>Jetty-Spring Module</h4><div class="paragraph"><p>The skeleton of a jetty spring module can be enabled from the jetty-distribution via the <a href="#startup-modules">module mechanism</a>.
For example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">$ java -jar start.jar --add-to-start=spring</code></pre></div></div>
<div class="paragraph"><p>This (or the alternative <a href="#start-jar">--add-to-start</a>=spring command) creates a <code>${jetty.home}/lib/spring</code> directory and populates it with the jetty-spring integration jar.
It does NOT supply the spring jars and their dependencies.
You will need to download these and place them into jetty&#8217;s classpath - you can use the <code>${jetty.home}/lib/spring</code> directory created by spring.mod for this purpose.</p></div></div>
<div class="sect3"><h4>Using Spring to Configure Jetty</h4><div class="paragraph"><p>Configuring Jetty via Spring is simply a matter of calling the API as Spring beans.
The following is an example mimicking the default jetty startup configuration.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;

&lt;!-- =============================================================== --&gt;
&lt;!-- Configure the Jetty Server with Spring                          --&gt;
&lt;!-- This file is the similar to jetty.xml, but written in spring    --&gt;
&lt;!-- XmlBeanFactory format.                                          --&gt;
&lt;!-- =============================================================== --&gt;

&lt;beans&gt;
    &lt;bean id="contexts" class="org.eclipse.jetty.server.handler.ContextHandlerCollection"/&gt;
    &lt;bean id="server" name="Main" class="org.eclipse.jetty.server.Server" init-method="start" destroy-method="stop"&gt;
        &lt;constructor-arg&gt;
            &lt;bean id="threadPool" class="org.eclipse.jetty.util.thread.QueuedThreadPool"&gt;
                &lt;property name="minThreads" value="10"/&gt;
                &lt;property name="maxThreads" value="50"/&gt;
            &lt;/bean&gt;
        &lt;/constructor-arg&gt;
        &lt;property name="connectors"&gt;
            &lt;list&gt;
                &lt;bean id="connector" class="org.eclipse.jetty.server.ServerConnector"&gt;
                    &lt;constructor-arg ref="server"/&gt;
                    &lt;property name="port" value="8080"/&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="handler"&gt;
            &lt;bean id="handlers" class="org.eclipse.jetty.server.handler.HandlerCollection"&gt;
            &lt;property name="handlers"&gt;
                    &lt;list&gt;
                        &lt;ref bean="contexts"/&gt;
                        &lt;bean id="defaultHandler" class="org.eclipse.jetty.server.handler.DefaultHandler"/&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="beans"&gt;
            &lt;list&gt;
                &lt;bean id="deploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager"&gt;
                    &lt;property name="contexts" ref="contexts"/&gt;
                    &lt;property name="appProviders"&gt;
                        &lt;list&gt;
                            &lt;bean id="webAppProvider" class="org.eclipse.jetty.deploy.providers.WebAppProvider"&gt;
                                &lt;property name="monitoredDirName" value="webapps"/&gt;
                                &lt;property name="scanInterval" value="1"/&gt;
                                &lt;property name="extractWars" value="true"/&gt;
                            &lt;/bean&gt;
                        &lt;/list&gt;
                    &lt;/property&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre></div></div></div></div>
<div class="sect2"><h3 id="framework-jetty-osgi">OSGI</h3><div class="sect3"><h4>Introduction</h4><div class="paragraph"><p>The Jetty OSGi infrastructure provides a Jetty container inside an OSGi container.
Traditional JavaEE webapps can be deployed, in addition to Jetty <code>ContextHandlers</code>, along with OSGi web bundles.
In addition, the infrastructure also supports the OSGi <code>HttpService</code> interface.</p></div></div>
<div class="sect3"><h4>General Setup</h4><div class="paragraph"><p>All of the Jetty jars contain manifest entries appropriate to ensure that they can be deployed into an OSGi container as bundles.
You will need to install some jetty jars into your OSGi container.
You can always find the Jetty jars either in the Maven Central repository, or you can <a href="https://www.eclipse.org/jetty/download.html">download</a> a distribution of Jetty.
Here&#8217;s the absolute minimal set of Jetty jars:</p></div>
<table class="tableblock frame-all grid-all spread"><caption class="title">Table 2. Minimal Bundles</caption><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-util</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.util</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-http</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.http</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-io</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.io</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-security</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.security</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-server</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.server</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-servlet</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.servlet</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-webapp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.webapp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-deploy</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.deploy</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-xml</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.xml</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-osgi-servlet-api</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.osgi-servlet-api</p></td></tr></tbody></table>
<div class="paragraph"><p>You <strong>must also install the Apache Aries SPI Fly bundles</strong> as  many parts of Jetty - for example ALPN, websocket, annotations - use the <code>ServiceLoader</code> mechanism, which requires an OSGi Service Loader Mediator like SPI Fly:</p></div>
<table id="spifly" class="tableblock frame-all grid-all spread"><caption class="title">Table 3. SPI Fly Bundles</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.aries.spifly:org.apache.aries.spifly.dynamic.bundle-1.1.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.aries.spifly.dynamic.bundle</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/org/apache/aries/spifly/org.apache.aries.spifly.dynamic.bundle/">Maven central</a></p></td></tr></tbody></table>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">We strongly recommend that you also deploy the <a href="#osgi-annotations">annotation-related</a> jars also, as the Servlet Specification increasingly relies on annotations for functionality.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>You will also need the <strong>OSGi Event Management service</strong> and the <strong>OSGi Configuration Management service</strong>.
If your OSGi container does not automatically make these available, you will need to add them in a way appropriate to your container.</p></div></div>
<div class="sect3"><h4>The Jetty OSGi Container</h4><div class="sect4"><h5>The jetty-osgi-boot jar</h5><div class="paragraph"><p>Now that you have the basic set of Jetty jars installed, you can install the <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-boot/">jetty-osgi-boot.jar</a> bundle, downloadable from the maven central repo <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-boot/">here.</a></p></div>
<div class="paragraph"><p>This bundle will instantiate and make available the Jetty OSGi container when it is started.
If this bundle is not auto-started upon installation into your OSGi container, you should start it manually using a command appropriate for your container.</p></div></div>
<div class="sect4"><h5 id="customize-jetty-container">Customizing the Jetty Container</h5><div class="paragraph"><p>Before going ahead with the install, you may want to customize the Jetty container.
In general this is done by a combination of System properties and the usual Jetty xml configuration files.
The way you define the System properties will depend on which OSGi container you are using, so ensure that you are familiar with how to set them for your environment.
In the following examples, we will assume that the OSGi container allows us to set System properties as simple <code>name=value</code> pairs.</p></div>
<div class="paragraph"><p>The available System properties are:</p></div>
<div class="dlist"><dl><dt class="hdlist1">jetty.http.port</dt><dd><p>If not specified, this defaults to the usual jetty port of 8080.</p></dd><dt class="hdlist1">jetty.home</dt><dd><p>Either this property <em>or</em> the <strong>jetty.home.bundle</strong> <em>must</em> be specified.
This property should point to a file system location that has an <code>etc/</code> directory containing xml files to configure the Jetty container on startup.
For example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">jetty.home=/opt/custom/jetty</code></pre></div></div>
<div class="paragraph"><p>Where <code>/opt/custom/jetty</code> contains:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">etc/jetty.xml
etc/jetty-selector.xml
etc/jetty-deployer.xml
etc/jetty-special.xml</code></pre></div></div></dd><dt class="hdlist1">jetty.home.bundle</dt><dd><p>Either this property <em>or</em> the <strong>jetty.home</strong> property must be specified.
This property should specify the symbolic name of a bundle which contains a directory called <code>jettyhome/</code>.
The <code>jettyhome/</code> directory should have a subdirectory called <code>etc/</code> that contains the xml files to be applied to Jetty on startup.
The jetty-osgi-boot.jar contains a <code>jettyhome/</code> directory with a default set of xml configuration files.
Here&#8217;s how you would specify it:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">jetty.home.bundle=org.eclipse.jetty.osgi.boot</code></pre></div></div>
<div class="paragraph"><p>Here&#8217;s a partial listing of that jar that shows you the names of the xml files contained within it:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">META-INF/MANIFEST.MF
jettyhome/etc/jetty.xml
jettyhome/etc/jetty-deployer.xml
jettyhome/etc/jetty-http.xml</code></pre></div></div></dd><dt class="hdlist1">jetty.etc.config.urls</dt><dd><p>This specifies the paths of the xml files that are to be used.
If not specified, they default to:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">etc/jetty.xml,etc/jetty-http.xml,etc/jetty-deployer.xml</code></pre></div></div>
<div class="paragraph"><p>Note that the paths can either be relative or absolute, or a mixture.
If the path is relative, it is resolved against either <strong>jetty.home</strong> or <strong>jetty.home.bundle</strong>, whichever was specified.
You can use this ability to mix and match jetty configuration files to add functionality, such as adding in a https connector.
Here&#8217;s an example of adding a HTTPS connector, using the relevant files from the jetty-distribution:</p></div>
<div class="literalblock"><div class="content"><pre>etc/jetty.xml, etc/jetty-http.xml, /opt/jetty/etc/jetty-ssl.xml, /opt/jetty/etc/jetty-https.xml, etc/jetty-deployer.xml</pre></div></div>
<div class="paragraph"><p>Note that regardless of whether you set the <strong>jetty.home</strong> or <strong>jetty.home.bundle</strong> property, when Jetty executes the configuration files, it will set an appropriate value for <strong>jetty.home</strong> so that references in xml files to <code>&lt;property name="jetty.home"&gt;</code> will work.
Be careful, however, if you are mixing and matching relative and absolute configuration file paths: the value of <strong>jetty.home</strong> is determined from the resolved location of the <em>relative</em> files only.</p></div></dd></dl></div></div>
<div class="sect4"><h5>The Jetty Container as an OSGi Service</h5><div class="paragraph"><p>You can now go ahead and deploy the jetty-osgi-boot.jar into your OSGi container.
A Jetty server instance will be created, the xml config files applied to it, and then published as an OSGi service.
Normally, you will not need to interact with this service instance, however you can retrieve a reference to it using the usual OSGi API:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">org.osgi.framework.BundleContext bc;
org.osgi.framework.ServiceReference ref = bc.getServiceReference("org.eclipse.jetty.server.Server");</code></pre></div></div>
<div class="paragraph"><p>The Server service has a couple of properties associated with it that you can retrieve using the <code>org.osgi.framework.ServiceReference.getProperty(String)</code> method:</p></div>
<div class="dlist"><dl><dt class="hdlist1">managedServerName</dt><dd><p>The Jetty Server instance created by the jetty-osgi-boot.jar will be called "defaultJettyServer"</p></dd><dt class="hdlist1">jetty.etc.config.urls</dt><dd><p>The list of xml files resolved from either <strong>jetty.home</strong> or <strong>jetty.home.bundle</strong>/jettyhome</p></dd></dl></div></div>
<div class="sect4"><h5>Adding More Jetty Servers</h5><div class="paragraph"><p>As we have seen in the previous section, the jetty-osgi-boot code will create an <code>org.eclipse.jetty.server.Server</code> instance, apply the xml configuration files specified by <strong>jetty.etc.config.urls</strong> System property to it, and then register it as an OSGi Service.
The name associated with this default instance is <code>defaultJettyServer</code>.</p></div>
<div class="paragraph"><p>You can create other Server instances, register them as OSGi Services, and the jetty-osgi-boot code will notice them, and configure them so that they can deploy <code>ContextHandlers</code> and webapp bundles.
When you deploy webapps or <code>ContextHandlers</code> as bundles or Services (see sections below) you can target them to be deployed to a particular server instance via
the Server&#8217;s name.</p></div>
<div class="paragraph"><p>Here&#8217;s an example of how to create a new Server instance and register it with OSGi so that the jetty-osgi-boot code will find it and configure it so it can be a deployment target:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Activator implements BundleActivator
{

    public void start(BundleContext context) throws Exception
    {

        Server server = new Server();
        //do any setup on Server in here
        String serverName = "fooServer";
        Dictionary serverProps = new Hashtable();
        //define the unique name of the server instance
        serverProps.put("managedServerName", serverName);
        serverProps.put("jetty.http.port", "9999");
        //let Jetty apply some configuration files to the Server instance
        serverProps.put("jetty.etc.config.urls", "file:/opt/jetty/etc/jetty.xml,file:/opt/jetty/etc/jetty-selector.xml,file:/opt/jetty/etc/jetty-deployer.xml");
        //register as an OSGi Service for Jetty to find
        context.registerService(Server.class.getName(), server, serverProps);

    }
}</code></pre></div></div>
<div class="paragraph"><p>Now that we have created a new Server called "fooServer", we can deploy webapps and <code>ContextHandlers</code> as Bundles or Services to it (see below for more information on this). Here&#8217;s an example of deploying a webapp as a Service and targeting it to the "fooServer" Server we created above:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Activator implements BundleActivator
{

    public void start(BundleContext context) throws Exception
    {

        //Create a webapp context as a Service and target it at the "fooServer" Server instance
        WebAppContext webapp = new WebAppContext();
        Dictionary props = new Hashtable();
        props.put("war",".");
        props.put("contextPath","/acme");
        props.put("managedServerName", "fooServer");
        context.registerService(ContextHandler.class.getName(),webapp,props);
    }
}</code></pre></div></div></div></div>
<div class="sect3"><h4>Deploying Bundles as Webapps</h4><div class="paragraph"><p>The Jetty OSGi container listens for the installation of bundles, and will automatically attempt to deploy any that appear to be webapps.</p></div>
<div class="paragraph"><p>Any of the following criteria are sufficient for Jetty to deploy the bundle as a webapp:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Bundle contains a WEB-INF/web.xml file</dt><dd><p>If the bundle contains a web descriptor, then it is automatically deployed.
This is an easy way to deploy classic JavaEE webapps.</p></dd><dt class="hdlist1">Bundle MANIFEST contains Jetty-WarFolderPath (for releases prior tojetty-9.3) or Jetty-WarResourcePath</dt><dd><p>This is the location within the bundle of the webapp resources.
Typically this would be used if the bundle is not a pure webapp, but rather the webapp is a component of the bundle.
Here&#8217;s an example of a bundle where the resources of the webapp are not located at the root of the bundle, but rather inside the subdirectory <code>web/</code> :</p><div class="paragraph"><p><code>MANIFEST</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Bundle-Name: Web
Jetty-WarResourcePath: web
Import-Package: javax.servlet;version="3.1",
 javax.servlet.resources;version="3.1"
Bundle-SymbolicName: com.acme.sample.web</code></pre></div></div>
<div class="paragraph"><p>Bundle contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">META-INF/MANIFEST.MF
web/index.html
web/foo.html
web/WEB-INF/web.xml
com/acme/sample/web/MyStuff.class
com/acme/sample/web/MyOtherStuff.class</code></pre></div></div></dd><dt class="hdlist1">Bundle MANIFEST contains Web-ContextPath</dt><dd><p>This header can be used in conjunction with either of the two preceding headers to control the context path to which the webapp is deployed, or alone to identify that the bundle&#8217;s contents should be published as a webapp.
This header is part of the RFC-66 specification for using webapps with OSGi.
Here&#8217;s an example based on the previous one where we use the <code>Web-ContextPath</code> header to set its deployment context path to be "/sample" :</p><div class="paragraph"><p><code>MANIFEST</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Bundle-Name: Web
Jetty-WarResourcePath: web
Web-ContextPath: /sample
Import-Package: javax.servlet;version="3.1",
 javax.servlet.resources;version="3.1"
Bundle-SymbolicName: com.acme.sample.web</code></pre></div></div></dd></dl></div>
<div class="paragraph"><p>You can also define extra headers in your bundle MANIFEST that help
customize the web app to be deployed:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Jetty-defaultWebXmlFilePath</dt><dd><p>The location of a <code>webdefault.xml</code> file to apply to the webapp.
The location can be either absolute (either absolute path or file: url), or relative (in which case it is interpreted as relative to the bundle root).
Defaults to the <code>webdefault.xml</code> file built into the Jetty OSGi container.</p></dd><dt class="hdlist1">Jetty-WebXmlFilePath</dt><dd><p>The location of the <code>web.xml</code> file.
The location can be either absolute (either absolute path or file: url), or relative (in which case it is interpreted as relative to the bundle root).
Defaults to <code>WEB-INF/web.xml</code></p></dd><dt class="hdlist1">Jetty-extraClassPath</dt><dd><p>A classpath of additional items to add to the webapp&#8217;s classloader.</p></dd><dt class="hdlist1">Jetty-bundleInstall</dt><dd><p>The path to the base folder that overrides the computed bundle installation - mostly useful for those OSGi frameworks that unpack bundles by default.</p></dd><dt class="hdlist1">Require-TldBundle</dt><dd><p>A comma separated list of bundle symbolic names of bundles containing TLDs that this webapp depends upon.</p></dd><dt class="hdlist1">managedServerName</dt><dd><p>The name of the Server instance to which to deploy this webapp bundle.
If not specified, defaults to the default Server instance called "defaultJettyServer".</p></dd><dt class="hdlist1">Jetty-WarFragmentResourcePath</dt><dd><p>The path within a fragment hosted by the web-bundle that contains static resources for the webapp.
The path is appended to the base resource for the webapp (see Jetty-WarResourcePath).</p></dd><dt class="hdlist1">Jetty-WarPrependFragmentResourcePath</dt><dd><p>The path within a fragment hosted by the web-bundle that contains static resources for the webapp.
The path is prepended to the base resource for the webapp (see Jetty-WarResourcePath).</p></dd><dt class="hdlist1">Jetty-ContextFilePath</dt><dd><p>A comma separated list of paths within the webapp bundle to Jetty context files that will be applied to the webapp.
Alternatively you may include a single Jetty context file called <code>jetty-webapp-context.xml</code> in the webapp bundle&#8217;s META-INF directory and it will be automatically applied to the webapp.</p></dd></dl></div>
<div class="sect4"><h5>Determining the Context Path for a Webapp Bundle</h5><div class="paragraph"><p>As we have seen in the previous section, if the bundle <code>MANIFEST</code> contains the RFC-66 header <strong>Web-ContextPath</strong>, Jetty will use that as the context path.
If the <code>MANIFEST</code> does not contain that header, then Jetty will concoct a context path based on the last element of the bundle&#8217;s location (by calling <code>Bundle.getLocation()</code>) after stripping off any file extensions.</p></div>
<div class="paragraph"><p>For example, suppose we have a bundle whose location is:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">file://some/where/over/the/rainbow/oz.war</code></pre></div></div>
<div class="paragraph"><p>The corresponding synthesized context path would be:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">/oz</code></pre></div></div></div>
<div class="sect4"><h5>Extra Properties Available for Webapp Bundles</h5><div class="paragraph"><p>You can further customize your webapp by including a Jetty context xml file that is applied to the webapp.
This xml file must be placed in <code>META-INF</code> of the bundle, and must be called <code>jetty-webapp-context.xml</code>.</p></div>
<div class="paragraph"><p>Here&#8217;s an example of a webapp bundle listing containing such a file:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">META-INF/MANIFEST.MF
META-INF/jetty-webapp-context.xml
web/index.html
web/foo.html
web/WEB-INF/web.xml
com/acme/sample/web/MyStuff.class
com/acme/sample/web/MyOtherStuff.class</code></pre></div></div>
<div class="paragraph"><p>Here&#8217;s an example of the contents of a <code>META-INF/jetty-webapp-context.xml</code> file:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;Set name="defaultsDescriptor"&gt;&lt;Property name="bundle.root"/&gt;META-INF/webdefault.xml&lt;/Set&gt;
&lt;/Configure&gt;</code></pre></div></div>
<div class="paragraph"><p>As you can see, it is a normal context xml file used to set up a webapp.
There are, however, some additional useful properties that can be referenced</p></div>
<div class="dlist"><dl><dt class="hdlist1">Server</dt><dd><p>This is a reference to the Jetty <code>org.eclipse.jetty.server.Server</code> instance to which the webapp being configured in the context xml file will be deployed.</p></dd><dt class="hdlist1">bundle.root</dt><dd><p>This is a reference to the <code>org.eclipse.jetty.util.resource.Resource</code> that represents the location of the Bundle.
Note that this could be either a directory in the file system if the OSGi container automatically unpacks bundles, or it may be a jar:file: url if the bundle remains packed.</p></dd></dl></div></div></div>
<div class="sect3"><h4>Deploying Bundles as Jetty ContextHandlers</h4><div class="paragraph"><p>In addition to deploying webapps, the Jetty OSGi container listens for the installation of bundles that are not heavyweight webapps, but rather use the flexible Jetty-specific concept of <code>ContextHandlers</code>.</p></div>
<div class="paragraph"><p>The following is the criteria used to decide if a bundle can be deployed as a <code>ContextHandler</code>:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Bundle MANIFEST contains Jetty-ContextFilePath</dt><dd><p>A comma separated list of names of context files - each one of which represents a ContextHandler that should be deployed by Jetty.
The context files can be inside the bundle, external to the bundle somewhere on the file system, or external to the bundle in the <strong>jetty.home</strong> directory.</p><div class="paragraph"><p>A context file that is inside the bundle:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Jetty-ContextFilePath: ./a/b/c/d/foo.xml</code></pre></div></div>
<div class="paragraph"><p>A context file that is on the file system:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Jetty-ContextFilePath: /opt/app/contexts/foo.xml</code></pre></div></div>
<div class="paragraph"><p>A context file that is relative to jetty.home:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Jetty-ContextFilePath: contexts/foo.xml</code></pre></div></div>
<div class="paragraph"><p>A number of different context files:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Jetty-ContextFilePath: ./a/b/c/d/foo.xml,/opt/app/contexts/foo.xml,contexts/foo.xml</code></pre></div></div></dd></dl></div>
<div class="paragraph"><p>Other <code>MANIFEST</code> properties that can be used to configure the deployment of the <code>ContextHandler</code>:</p></div>
<div class="dlist"><dl><dt class="hdlist1">managedServerName</dt><dd><p>The name of the Server instance to which to deploy this webapp bundle.
If not specified, defaults to the default Server instance called "defaultJettyServer".</p></dd></dl></div>
<div class="sect4"><h5>Determining the Context Path for a ContextHandler Bundle</h5><div class="paragraph"><p>Usually, the context path for the ContextHandler will be set by the context xml file.
However, you can override any path set in the context xml file by using the <strong>Web-ContextPath</strong> header in the <code>MANIFEST</code>.</p></div></div>
<div class="sect4"><h5>Extra Properties Available for Context Xml Files</h5><div class="paragraph"><p>Before the Jetty OSGi container applies a context xml file found in a <strong>Jetty-ContextFilePath</strong> <code>MANIFEST</code> header, it sets a few useful propertiesthat can be referred to within the xml file:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Server</dt><dd><p>This is a reference to the Jetty <code>org.eclipse.jetty.server.Server</code> instance to which the <code>ContextHandler</code> being configured in the context xml file will be deployed.</p></dd><dt class="hdlist1">bundle.root</dt><dd><p>This is a reference to the <code>org.eclipse.jetty.util.resource.Resource</code> that represents the location of the Bundle (obtained by calling <code>Bundle.getLocation()</code>).
Note that this could be either a directory in the file system if the OSGi container automatically unpacks bundles, or it may be a jar:file: url if the bundle remains packed.</p></dd></dl></div>
<div class="paragraph"><p>Here&#8217;s an example of a context xml file that makes use of these properties:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;Configure class="org.eclipse.jetty.server.handler.ContextHandler"&gt;

  &lt;!-- Get root for static content, could be on file system or this bundle --&gt;
  &lt;Call id="res" class="org.eclipse.jetty.util.resource.Resource" name="newResource"&gt;
    &lt;Arg&gt;&lt;Property name="bundle.root"/&gt;&lt;/Arg&gt;
  &lt;/Call&gt;

  &lt;Ref refid="res"&gt;
    &lt;Call id="base" name="addPath"&gt;
      &lt;Arg&gt;/static/&lt;/Arg&gt;
    &lt;/Call&gt;
  &lt;/Ref&gt;

  &lt;Set name="contextPath"&gt;/unset&lt;/Set&gt;

  &lt;!-- Set up the base resource for static files relative to inside bundle --&gt;
  &lt;Set name="baseResource"&gt;
     &lt;Ref refid="base"/&gt;
  &lt;/Set&gt;

  &lt;Set name="handler"&gt;
    &lt;New class="org.eclipse.jetty.server.handler.ResourceHandler"&gt;
      &lt;Set name="welcomeFiles"&gt;
        &lt;Array type="String"&gt;
          &lt;Item&gt;index.html&lt;/Item&gt;
        &lt;/Array&gt;
      &lt;/Set&gt;
      &lt;Set name="cacheControl"&gt;max-age=3600,public&lt;/Set&gt;
    &lt;/New&gt;
  &lt;/Set&gt;

&lt;/Configure&gt;</code></pre></div></div></div></div>
<div class="sect3"><h4 id="services-as-webapps">Deploying Services as Webapps</h4><div class="paragraph"><p>In addition to listening for bundles whose format or <code>MANIFEST</code> entries define a webapp or <code>ContextHandler</code> for to be deployed, the Jetty OSGi container also listens for the registration of OSGi services that are instances of <code>org.eclipse.jetty.webapp.WebAppContext</code>.
So you may programmatically create a <code>WebAppContext</code>, register it as a service, and have Jetty pick it up and deploy it.</p></div>
<div class="paragraph"><p>Here&#8217;s an example of doing that with a simple bundle that serves static content, and an <code>org.osgi.framework.BundleActivator</code> that instantiates the <code>WebAppContext</code>:</p></div>
<div class="paragraph"><p>The bundle contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">META-INF/MANIFEST.MF
index.html
com/acme/osgi/Activator.class</code></pre></div></div>
<div class="paragraph"><p>The <code>MANIFEST.MF</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Bundle-Classpath: .
Bundle-Name: Jetty OSGi Test WebApp
DynamicImport-Package: org.eclipse.jetty.*;version="[9.0,10.0)"
Bundle-Activator: com.acme.osgi.Activator
Import-Package: org.eclipse.jetty.server.handler;version="[9.0,10)",
 org.eclipse.jetty.webapp;version="[9.0,10)",
 org.osgi.framework;version= "[1.5,2)",
 org.osgi.service.cm;version="1.2.0",
 org.osgi.service.packag eadmin;version="[1.2,2)",
 org.osgi.service.startlevel;version="1.0.0",
 org.osgi.service.url;version="1.0.0",
 org.osgi.util.tracker;version= "1.3.0",
 org.xml.sax,org.xml.sax.helpers
Bundle-SymbolicName: com.acme.testwebapp</code></pre></div></div>
<div class="paragraph"><p>The Activator code:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void start(BundleContext context) throws Exception
{
    WebAppContext webapp = new WebAppContext();
    Dictionary props = new Hashtable();
    props.put("Jetty-WarResourcePath",".");
    props.put("contextPath","/acme");
    context.registerService(WebAppContext.class.getName(),webapp,props);
}</code></pre></div></div>
<div class="paragraph"><p>The above setup is sufficient for Jetty to recognize and deploy the <code>WebAppContext</code> at /acme.</p></div>
<div class="paragraph"><p>As the example shows, you can use OSGi Service properties in order to communicate extra configuration information to Jetty:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Jetty-WarFolderPath (for releases prior to 9.3) or Jetty-WarResourcePath</dt><dd><p>The location within the bundle of the root of the static resources for the webapp</p></dd><dt class="hdlist1">Web-ContextPath</dt><dd><p>The context path at which to deploy the webapp.</p></dd><dt class="hdlist1">Jetty-defaultWebXmlFilePath</dt><dd><p>The location within the bundle of a <code>webdefault.xml</code> file to apply to the webapp.
Defaults to that of the Jetty OSGi container.</p></dd><dt class="hdlist1">Jetty-WebXmlFilePath</dt><dd><p>The location within the bundle of the <code>web.xml</code> file.
Defaults to <code>WEB-INF/web.xml</code></p></dd><dt class="hdlist1">Jetty-extraClassPath</dt><dd><p>A classpath of additional items to add to the webapp&#8217;s classloader.</p></dd><dt class="hdlist1">Jetty-bundleInstall</dt><dd><p>The path to the base folder that overrides the computed bundle installation - mostly useful for those OSGi frameworks that unpack bundles by default.</p></dd><dt class="hdlist1">Require-TldBundle</dt><dd><p>A comma separated list of bundle symbolic names of bundles containing TLDs that this webapp depends upon.</p></dd><dt class="hdlist1">managedServerName</dt><dd><p>The name of the Server instance to which to deploy this webapp.
If not specified, defaults to the default Server instance called "defaultJettyServer".</p></dd><dt class="hdlist1">Jetty-WarFragmentResourcePath</dt><dd><p>The path within a fragment hosted by the web-bundle that contains static resources for the webapp.
The path is appended to the base resource for the webapp (see Jetty-WarResourcePath).</p></dd><dt class="hdlist1">Jetty-WarPrependFragmentResourcePath</dt><dd><p>The path within a fragment hosted by the web-bundle that contains static resources for the webapp.
The path is prepended to the base resource for the webapp (see Jetty-WarResourcePath).</p></dd></dl></div></div>
<div class="sect3"><h4>Deploying Services as ContextHandlers</h4><div class="paragraph"><p>Similarly to WebApp`Contexts, the Jetty OSGi container can detect the registration of an OSGi Service that represents a <code>ContextHandler</code> and ensure that it is deployed.
The <code>ContextHandler</code> can either be fully configured before it is registered as an OSGi service - in which case the Jetty OSGi container will merely deploy it - or the <code>ContextHandler</code> can be partially configured, with the Jetty OSGi container completing the configuration via a context xml file and properties associated with the Service.</p></div>
<div class="paragraph"><p>Here&#8217;s an example of doing that with a simple bundle that serves static content with an <code>org.osgi.framework.BundleActivator</code> that instantiates a <code>ContextHandler</code> and registers it as an OSGi Service, passing in properties that define a context xml file and context path for Jetty to apply upon deployment:</p></div>
<div class="paragraph"><p>The bundle contents:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">META-INF/MANIFEST.MF
static/index.html
acme.xml
com/acme/osgi/Activator.class
com/acme/osgi/Activator$1.class</code></pre></div></div>
<div class="paragraph"><p>The <code>MANIFEST</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Bundle-Classpath: .
Bundle-Name: Jetty OSGi Test Context
DynamicImport-Package: org.eclipse.jetty.*;version="[9.0,10.0)"
Bundle-Activator: com.acme.osgi.Activator
Import-Package: javax.servlet;version="2.6.0",
 javax.servlet.resources;version="2.6.0",
 org.eclipse.jetty.server.handler;version="[9.0,10)",
 org.osgi.framework;version="[1.5,2)",
 org.osgi.service.cm;version="1.2.0",
 org.osgi.service.packageadmin;version="[1.2,2)",
 org.osgi.service.startlevel;version="1.0.0.o",
 org.osgi.service.url;version="1.0.0",
 org.osgi.util.tracker;version="1.3.0",
 org.xml.sax,org.xml.sax.helpers
Bundle-SymbolicName: com.acme.testcontext</code></pre></div></div>
<div class="paragraph"><p>The Activator code:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void start(final BundleContext context) throws Exception
{
    ContextHandler ch = new ContextHandler();
    ch.addEventListener(new ServletContextListener () {

            @Override
            public void contextInitialized(ServletContextEvent sce)
            {
               System.err.println("Context is initialized");
            }

            @Override
            public void contextDestroyed(ServletContextEvent sce)
            {
                System.err.println("Context is destroyed!");
            }

    });
    Dictionary props = new Hashtable();
    props.put("Web-ContextPath","/acme");
    props.put("Jetty-ContextFilePath", "acme.xml");
    context.registerService(ContextHandler.class.getName(),ch,props);
}</code></pre></div></div>
<div class="paragraph"><p>The contents of the <code>acme.xml</code> context file:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;

&lt;Configure class="org.eclipse.jetty.server.handler.ContextHandler"&gt;

  &lt;!-- Get root for static content, could be on file system or this bundle --&gt;
  &lt;Call id="res" class="org.eclipse.jetty.util.resource.Resource" name="newResource"&gt;
    &lt;Arg&gt;&lt;Property name="bundle.root"/&gt;&lt;/Arg&gt;
  &lt;/Call&gt;

  &lt;Ref refid="res"&gt;
    &lt;Call id="base" name="addPath"&gt;
      &lt;Arg&gt;/static/&lt;/Arg&gt;
    &lt;/Call&gt;
  &lt;/Ref&gt;

  &lt;Set name="contextPath"&gt;/unset&lt;/Set&gt;

  &lt;!-- Set up the base resource for static files relative to inside bundle --&gt;
  &lt;Set name="baseResource"&gt;
     &lt;Ref refid="base"/&gt;
  &lt;/Set&gt;

  &lt;Set name="handler"&gt;
    &lt;New class="org.eclipse.jetty.server.handler.ResourceHandler"&gt;
      &lt;Set name="welcomeFiles"&gt;
        &lt;Array type="String"&gt;
          &lt;Item&gt;index.html&lt;/Item&gt;
        &lt;/Array&gt;
      &lt;/Set&gt;
      &lt;Set name="cacheControl"&gt;max-age=3600,public&lt;/Set&gt;
    &lt;/New&gt;
  &lt;/Set&gt;

&lt;/Configure&gt;</code></pre></div></div>
<div class="paragraph"><p>You may also use the following OSGi Service properties:</p></div>
<div class="dlist"><dl><dt class="hdlist1">managedServerName</dt><dd><p>The name of the Server instance to which to deploy this webapp.
If not specified, defaults to the default Server instance called "defaultJettyServer".</p></dd></dl></div>
<div class="sect4"><h5>Extra Properties Available for Context Xml Files</h5><div class="paragraph"><p>Before the Jetty OSGi container applies a context xml file found in a <code>Jetty-ContextFilePath</code> property, it sets a few useful properties that can be referred to within the xml file:</p></div>
<div class="dlist"><dl><dt class="hdlist1">Server</dt><dd><p>This is a reference to the Jetty <code>org.eclipse.jetty.server.Server</code> instance to which the <code>ContextHandler</code> being configured in the context xml file will be deployed.</p></dd><dt class="hdlist1">bundle.root</dt><dd><p>This is a reference to the <code>org.eclipse.jetty.util.resource.Resource</code> that represents the location of the Bundle publishing the <code>ContextHandler</code> as a Service (obtained by calling <code>Bundle.getLocation()</code>).
Note that this could be either a directory in the file system if the OSGi container automatically unpacks bundles, or it may be a jar:file: url if the bundle remains packed.</p></dd></dl></div>
<div class="paragraph"><p>In the example above, you can see both of these properties being used in the context xml file.</p></div></div></div>
<div class="sect3"><h4>Support for the OSGi Service Platform Enterprise Specification</h4><div class="paragraph"><p>The Jetty OSGi container implements several aspects of the Enterprise Specification v4.2 for the <code>WebAppContexts</code> and <code>ContextHandlers</code> that it deploys from either bundles or OSGi services as outlined in foregoing sections.</p></div>
<div class="sect4"><h5>Context Attributes</h5><div class="paragraph"><p>For each <code>WebAppContext</code> or <code>ContextHandler</code>, the following context attribute is set, as required by section <em>128.6.1 Bundle Context</em> page 427:</p></div>
<div class="dlist"><dl><dt class="hdlist1">osgi-bundleContext</dt><dd><p>The value of this attribute is the <code>BundleContext</code> representing the Bundle associated with the <code>WebAppContext</code> or <code>ContextHandler</code>.</p></dd></dl></div></div>
<div class="sect4"><h5>Service Attributes</h5><div class="paragraph"><p>As required by the specification section <em>128.3.4 Publishing the Servlet Context</em> page 421, each <code>WebAppContext</code> and <code>ContextHandler</code> deployed by the Jetty OSGi container is also published as an OSGi service (unless it has been already - see sections 1.6 and 1.7).
The following properties are associated with these services:</p></div>
<div class="dlist"><dl><dt class="hdlist1">osgi.web.symbolicname</dt><dd><p>The symbolic name of the Bundle associated with the <code>WebAppContext</code> or <code>ContextHandler</code></p></dd><dt class="hdlist1">osgi.web.version</dt><dd><p>The Bundle-Version header from the Bundle associated with the <code>WebAppContext</code> or <code>ContextHandler</code></p></dd><dt class="hdlist1">osgi.web.contextpath</dt><dd><p>The context path of the <code>WebAppContext</code> or <code>ContextHandler</code></p></dd></dl></div></div>
<div class="sect4"><h5>OSGi Events</h5><div class="paragraph"><p>As required by the specification section <em>128.5 Events</em> pg 426, the
following OSGi Event Admin events will be posted:</p></div>
<div class="dlist"><dl><dt class="hdlist1">org/osgi/service/web/DEPLOYING</dt><dd><p>The Jetty OSGi container is about to deploy a <code>WebAppContext</code> or <code>ContextHandler</code></p></dd><dt class="hdlist1">org/osgi/service/web/DEPLOYED</dt><dd><p>The Jetty OSGi container has finished deploying a <code>WebAppContext</code> or <code>ContextHandler</code> and it is in service</p></dd><dt class="hdlist1">org/osgi/service/web/UNDEPLOYING</dt><dd><p>The Jetty OSGi container is about to undeploy a <code>WebAppContext</code> or <code>ContextHandler</code></p></dd><dt class="hdlist1">org/osgi/service/web/UNDEPLOYED</dt><dd><p>The Jetty OSGi container has finished undeploying a <code>WebAppContext</code> or <code>ContextHandler</code> and it is no longer in service</p></dd><dt class="hdlist1">org/osgi/service/web/FAILED</dt><dd><p>The Jetty OSGi container failed to deploy a <code>WebAppContext</code> or <code>ContextHandler</code></p></dd></dl></div></div></div>
<div class="sect3"><h4>Using JSPs</h4><div class="sect4"><h5>Setup</h5><div class="paragraph"><p>In order to use JSPs with your webapps and bundles you will need to install the JSP and JSTL jars and their dependencies into your OSGi container.
Some you will find in the Jetty distribution, whereas others you will need to download from <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/orbit/">Maven central</a>.
Here is the list of recommended jars (NOTE the version numbers may change in future):</p></div>
<table id="osgi-jsp" class="tableblock frame-all grid-all spread"><caption class="title">Table 4. Jars Required for JSP</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#osgi-annotations">annotation jars</a></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.mortbay.jasper:apache-el</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.mortbay.jasper.apache-el</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jsp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.mortbay.jasper:apache-jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.mortbay.jasper.apache-jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jsp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty:apache-jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.apache-jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jsp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jdt.core-3.8.2.v20130121.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jdt.core.compiler.batch</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jsp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.osgi:jetty-osgi-boot-jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.osgi.boot.jsp</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-boot-jsp">Maven central</a></p></td></tr></tbody></table>
<div class="quoteblock"><blockquote><div class="olist NOTE"><ol class="NOTE"><li><p>As of Jetty 9.2.3 the jetty-osgi-boot-jsp bundle changed to using Apache Jasper as the JSP implementation.
Prior to this the Glassfish Jasper implementation was used, which had a different set of dependencies - pay careful attention to the jars listed both at the top of this page and in this section, as deployment of other jars can cause incomplete or incorrect package resolution in the OSGi container.</p></li><li><p>The order of deployment is important.
Deploy these bundles in the order shown or you may experience strange failures in the compilation of jsps.
This can be hard to diagnose but is almost always caused by the <code>ServletContainerInitializer</code> in the <code>org.eclipse.jetty.apache-jsp</code> bundle for the jsp container not being invoked due to incorrect startup of the annotation jars.</p></li></ol></div></blockquote></div>
<div class="paragraph"><p>For the JSTL library, we recommend the use of the implementation from Glassfish, as it has fewer dependencies:</p></div>
<table class="tableblock frame-all grid-all spread"><caption class="title">Table 5. Jars Required for Glassfish JSTL</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">The <a href="#osgi-jsp">jsp jars</a></th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.orbit:javax.servlet.jsp.jstl-1.2.0.v201105211821.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">javax.servlet.jsp.jstl</p></td></tr></tbody></table>
<div class="paragraph"><p>However, if you wish, you may use the JSTL implementation from Apache instead, although you will need to source some dependency jars with suitable OSGi manifests:</p></div>
<table class="tableblock frame-all grid-all spread"><caption class="title">Table 6. Jars Required for Apache JSTL</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#osgi-jsp">jsp jars</a></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.taglibs:taglibs-standard-spec:jar:1.2.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.taglibs.taglibs-standard-spec</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jstl</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.taglibs:taglibs-standard-spec:jar:1.2.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.taglibs.standard-impl</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/apache-jstl</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.xalan 2.7.1</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Try
<a href="http://download.eclipse.org/tools/orbit/downloads/drops/R20140525021250/repository/plugins/org.apache.xalan_2.7.1.v201005080400.jar">Eclipse
Orbit</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.xml.serializer 2.7.1</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Try
<a href="http://download.eclipse.org/tools/orbit/downloads/drops/R20140525021250/repository/plugins/org.apache.xml.serializer_2.7.1.v201005080400.jar">Eclipse
Orbit</a></p></td></tr></tbody></table></div>
<div class="sect4"><h5>The jetty-osgi-boot-jsp jar</h5><div class="paragraph"><p>To be able to use JSPs you will need to also install the <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-boot-jsp/">jetty-osgi-boot-jsp.jar</a> into your OSGi container.
This jar can be obtained from maven central <a href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-boot-jsp/">here</a>.</p></div>
<div class="paragraph"><p>This bundle acts as a fragment extension to the jetty-osgi-boot.jar and adds in support for using JSP.</p></div>
<div class="sect5"><h6>Using TagLibs</h6><div class="paragraph"><p>The Jetty JSP OSGi container will make available the JSTL tag library to all webapps.
If you only use this tag library, then your webapp will work without any further modification.</p></div>
<div class="paragraph"><p>However, if you make use of other taglibs, you will need to ensure that they are installed into the OSGi container, and also define some System properties and/or <code>MANIFEST</code> headers in your webapp.
This is necessary because the classloading regime used by the OSGi container is very different than that used by JSP containers, and the <code>MANIFEST</code> of a normal webapp does not contain enough information for the OSGi environment to allow a JSP container to find and resolve TLDs referenced in the webapp&#8217;s .jsp files.</p></div>
<div class="paragraph"><p>Firstly, lets look at an example of a web bundle&#8217;s modified <code>MANIFEST</code> file so you get an idea of what is required.
This example is a web bundle that uses the Spring servlet framework:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">Bundle-SymbolicName: com.acme.sample
Bundle-Name: WebSample
Web-ContextPath: taglibs
Import-Bundle: org.springframework.web.servlet
Require-TldBundle: org.springframework.web.servlet
Bundle-Version: 1.0.0
Import-Package: org.eclipse.virgo.web.dm;version="[3.0.0,4.0.0)",org.s
 pringframework.context.config;version="[2.5.6,4.0.0)",org.springframe
 work.stereotype;version="[2.5.6,4.0.0)",org.springframework.web.bind.
 annotation;version="[2.5.6,4.0.0)",org.springframework.web.context;ve
 rsion="[2.5.6,4.0.0)",org.springframework.web.servlet;version="[2.5.6
 ,4.0.0)",org.springframework.web.servlet.view;version="[2.5.6,4.0.0)"</code></pre></div></div>
<div class="paragraph"><p>The <strong>Require-TldBundle</strong> header tells the Jetty OSGi container that this bundle contains TLDs that need to be passed over to the JSP container for processing.
The <strong>Import-Bundle</strong> header ensures that the implementation classes for these TLDs will be available to the webapp on the OSGi classpath.</p></div>
<div class="paragraph"><p>The format of the <strong>Require-TldBundle</strong> header is a comma separated list of one or more symbolic names of bundles containing TLDs.</p></div></div>
<div class="sect5"><h6>Container Path Taglibs</h6><div class="paragraph"><p>Some TLD jars are required to be found on the Jetty OSGi container&#8217;s classpath, rather than considered part of the web bundle&#8217;s classpath.
For example, this is true of JSTL and Java Server Faces.
The Jetty OSGi container takes care of JSTL for you, but you can control which other jars are considered as part of the container&#8217;s classpath by using the System property <strong>org.eclipse.jetty.osgi.tldbundles</strong>:</p></div>
<div class="dlist"><dl><dt class="hdlist1">org.eclipse.jetty.osgi.tldbundles</dt><dd><p>System property defined on the OSGi environment that is a comma separated list of symbolic names of bundles containing taglibs that will be treated as if they are on the container&#8217;s classpath for web bundles.
For example:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">org.eclipse.jetty.osgi.tldbundles=com.acme.special.tags,com.foo.web,org.bar.web.framework</code></pre></div></div>
<div class="paragraph"><p>You will still need to define the <strong>Import-Bundle</strong> header in the <code>MANIFEST</code> file for the web bundle to ensure that the TLD bundles are on the OSGi classpath.</p></div></dd></dl></div>
<div class="paragraph"><p>Alternatively or additionally, you can define a pattern as a context attribute that will match symbolic bundle names in the OSGi environment containing TLDs that should be considered as discovered from the container&#8217;s classpath.</p></div>
<div class="dlist"><dl><dt class="hdlist1">org.eclipse.jetty.server.webapp.containerIncludeBundlePattern</dt><dd><p>This pattern must be specified as a context attribute of the <code>WebAppContext</code> representing the web bundle.
Unless you are deploying your own <code>WebAppContext</code> (see <a href="#services-as-webapps">Deploying Services as Webapps</a>), you won&#8217;t have a reference to the <code>WebAppContext</code> to do this.
In that case, it can be specified on the <code>org.eclipse.jetty.deploy.DeploymentManager</code>, where it will be applied to <em>every</em> webapp deployed by the Jetty OSGi container.
The <code>jetty-osgi-boot.jar</code> contains the default <code>jettyhome/etc/jetty-deploy.xml</code> file where the <code>DeploymentManager</code> is defined.
To set the pattern, you will need to provide your own etc files - see the section on <a href="#customize-jetty-container">customizing the jetty container</a> for how to do this. Here&#8217;s how the <code>jetty-deploy.xml</code> file would look if we defined a pattern that matched all bundle symbolic names ending in "tag" and "web":</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;
&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;
    &lt;Call name="addBean"&gt;
      &lt;Arg&gt;
        &lt;New id="DeploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager"&gt;
          &lt;Set name="contexts"&gt;
            &lt;Ref refid="Contexts" /&gt;
          &lt;/Set&gt;
          &lt;Call name="setContextAttribute"&gt;
            &lt;Arg&gt;org.eclipse.jetty.server.webapp.ContainerIncludeBundlePattern&lt;/Arg&gt;
            &lt;Arg&gt;.*\.tag$|.*\.web$&lt;/Arg&gt;
          &lt;/Call&gt;
        &lt;/New&gt;
      &lt;/Arg&gt;
    &lt;/Call&gt;
&lt;/Configure&gt;</code></pre></div></div>
<div class="paragraph"><p>Again, you will still need to define suitable <strong>Import-Bundle</strong> headers in your web bundle <code>MANIFEST</code> to ensure that bundles matching the pattern are available on the OSGi class path.</p></div></dd></dl></div></div></div></div>
<div class="sect3"><h4 id="osgi-annotations">Using Annotations/ServletContainerInitializers</h4><div class="paragraph"><p>Annotations are very much part of the Servlet 3.0 and 3.1 specifications.
In order to use them with Jetty in OSGi, you will need to deploy some extra jars into your OSGi container:</p></div>
<table class="tableblock frame-all grid-all spread"><caption class="title">Table 7. Jars Required for Annotations</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#spifly">spifly jars</a></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.ow2.asm:asm-7.0.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.objectweb.asm</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/org/ow2/asm/asm">Maven central</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.ow2.asm:asm-commons-7.0.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.objectweb.asm.commons</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/org/ow2/asm/asm-commons">Maven central</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">org.ow2.asm:asm-tree-7.0.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.objectweb.asm.tree</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/org/ow2/asm/asm-tree">Maven central</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">javax.annotation:javax.annotation-api-1.2.jar</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">javax.annotation-api</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/javax/annotation/javax.annotation-api/">Maven
central</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jta api version 1.1.1 (eg
org.apache.geronimo.specs:geronimo-jta_1.1_spec-1.1.1.jar)<sup>*</sup></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Maven
central</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">javax mail api version 1.4.1 (eg
org.eclipse.jetty.orbit:javax.mail.glassfish-1.4.1.v201005082020.jar)<sup>*</sup></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Maven central</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-jndi</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.jndi</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-plus</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.plus</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jetty-annotations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty.annotations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Distribution lib/</p></td></tr></tbody></table>
<div class="quoteblock"><blockquote><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">If you wish to use JSPs you will need to deploy these annotation-related jars.</td></tr></table></div></blockquote></div>
<div class="quoteblock"><blockquote><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You may be able to deploy later versions or other providers of these specifications, however these particular versions are known to have correct manifests and have been tested and known to work with OSGi.</td></tr></table></div></blockquote></div>
<div class="paragraph"><p>Even if your webapp itself does not not use annotations, you may need to deploy these jars because your webapp depends on a Jetty module or a 3rd party library that uses a <a href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html">javax.servlet.ServletContainerInitializer</a>.
This interface requires annotation support.
It is implemented by providers of code that extend the capabilities of the container.
An example of this is the Jetty JSR356 Websocket implementation, although it is being used increasingly commonly in popular libraries like <a href="http://projects.spring.io/spring-framework/">Spring</a>, <a href="https://jersey.java.net/">Jersey</a> and JSP containers.</p></div>
<div class="paragraph"><p>To find <code>ServletContainerInitializers</code> on the classpath, Jetty uses the Java <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html"><code>ServiceLoader</code></a>
mechanism.
For this to function in OSGi, you will need an OSGi R5 compatible container, and have support for the <a href="http://blog.osgi.org/2013/02/javautilserviceloader-in-osgi.html">Service Loader Mediator</a>.
Jetty has been tested with the <a href="http://aries.apache.org/modules/spi-fly.html">Aries SpiFly</a> module, which is the reference implementation of the Service Loader Mediator, and is listed in the jars above.</p></div></div>
<div class="sect3"><h4>OSGi Containers</h4><div class="sect4"><h5>Felix</h5><div class="paragraph"><p>The Jetty OSGi integration has been successfully tested against <a href="http://felix.apache.org/">Felix</a> 5.0.0.</p></div>
<div class="paragraph"><p>You will require the following extra Felix services, available as separately downloadable jars:</p></div>
<div class="ulist"><ul><li><p><a href="http://felix.apache.org/documentation/subprojects/apache-felix-config-admin.html">Felix Configuration Admin Service</a></p></li><li><p><a href="http://felix.apache.org/documentation/subprojects/apache-felix-event-admin.html">Felix Event Admin Service</a></p></li></ul></div>
<div class="paragraph"><p>Unfortunately, as of Felix 4.x there is a difficultly with the resolution of the <code>javax.transaction</code> package.
A <a href="http://mail-archives.apache.org/mod_mbox/felix-users/201211.mbox/%3CCAPr=90M+5vYjPqAvyTU+gYHr64y_FosBYELeUYcU_rFEJF3Cxw&#64;mail.gmail.com%3E">description of the problem</a> and hint to solving it is described [<a href="http://mail-archives.apache.org/mod_mbox/felix-users/201211.mbox/%3CCAPr=90M+5vYjPqAvyTU+gYHr64y_FosBYELeUYcU_rFEJF3Cxw&#64;mail.gmail.com%3E">here</a>].</p></div>
<div class="paragraph"><p>The simplest solution for this is to extract the <code>default.properties</code> file from the <code>felix.jar</code>, change the declaration of the <code>javax.sql</code> and <code>javax.transaction</code> packages and set the changed lines as the value of the <code>org.osgi.framework.system.packages</code> property in the <code>conf/config.properties</code> file.</p></div>
<div class="paragraph"><p>The <code>default.properties</code> file defines the default <code>org.osgi.framework.system.packages</code> property like this:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-properties" data-lang="properties"># Default packages exported by system bundle.
org.osgi.framework.system.packages=org.osgi.framework; version=1.7.0, \
 org.osgi.framework.hooks.bundle; version=1.1.0, \
 org.osgi.framework.hooks.resolver; version=1.0.0, \
 org.osgi.framework.hooks.service; version=1.1.0, \
 org.osgi.framework.hooks.weaving; version=1.0.0, \
 org.osgi.framework.launch; version=1.1.0, \
 org.osgi.framework.namespace; version=1.0.0, \
 org.osgi.framework.startlevel; version=1.0.0, \
 org.osgi.framework.wiring; version=1.1.0, \
 org.osgi.resource; version=1.0.0, \
 org.osgi.service.packageadmin; version=1.2.0, \
 org.osgi.service.startlevel; version=1.1.0, \
 org.osgi.service.url; version=1.0.0, \
 org.osgi.util.tracker; version=1.5.1 \
 ${jre-${java.specification.version}}</code></pre></div></div>
<div class="paragraph"><p>The last line must be substituted for one of the definitions further down in the file that is suitable for the jvm you are using.</p></div>
<div class="paragraph"><p>You will take these lines and copy them into the <code>conf/config.properties</code> file, after having replaced the line <code>$\{jre-$\{java.specification.version}}</code> with all of the lines relevant to your version of the jvm.</p></div>
<div class="paragraph"><p>For example, for a 1.7 jvm, you will find this property definition:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-properties" data-lang="properties">jre-1.7=, \
 javax.accessibility;uses:="javax.swing.text";version="0.0.0.1_007_JavaSE", \
 javax.activation;version="0.0.0.1_007_JavaSE", \
 javax.activity;version="0.0.0.1_007_JavaSE", \
 javax.annotation.processing;uses:="javax.tools,javax.lang.model,javax.lang.model.element,javax.lang.model.util";version="0.0.0.1_007_JavaSE", \
 javax.annotation;version="0.0.0.1_007_JavaSE", \
 javax.crypto.interfaces;uses:="javax.crypto.spec,javax.crypto";version="0.0.0.1_007_JavaSE", \
 javax.crypto.spec;uses:="javax.crypto";version="0.0.0.1_007_JavaSE", \
 javax.crypto;uses:="javax.crypto.spec";version="0.0.0.1_007_JavaSE", \
 javax.imageio.event;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", \
 javax.imageio.metadata;uses:="org.w3c.dom,javax.imageio";version="0.0.0.1_007_JavaSE", \
 javax.imageio.plugins.bmp;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", \
 javax.imageio.plugins.jpeg;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", \
 javax.imageio.spi;uses:="javax.imageio.stream,javax.imageio,javax.imageio.metadata";version="0.0.0.1_007_JavaSE", \
 javax.imageio.stream;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", \
 javax.imageio;uses:="javax.imageio.metadata,javax.imageio.stream,javax.imageio.spi,javax.imageio.event";version="0.0.0.1_007_JavaSE", \
 javax.jws.soap;version="0.0.0.1_007_JavaSE", \
 javax.jws;version="0.0.0.1_007_JavaSE", \
 javax.lang.model.element;uses:="javax.lang.model.type,javax.lang.model";version="0.0.0.1_007_JavaSE", \
 javax.lang.model.type;uses:="javax.lang.model.element,javax.lang.model";version="0.0.0.1_007_JavaSE", \
 javax.lang.model.util;uses:="javax.lang.model,javax.lang.model.element,javax.annotation.processing,javax.lang.model.type";version="0.0.0.1_007_JavaSE", \
 javax.lang.model;version="0.0.0.1_007_JavaSE", \
 javax.management.loading;uses:="javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management.modelmbean;uses:="javax.management,javax.management.loading";version="0.0.0.1_007_JavaSE", \
 javax.management.monitor;uses:="javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management.openmbean;uses:="javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management.relation;uses:="javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management.remote.rmi;uses:="javax.management.remote,javax.security.auth,javax.management,javax.management.loading,javax.naming,javax.rmi.ssl,org.omg.CORBA,org.omg.CORBA_2_3.portable,org.omg.CORBA.portable,javax.rmi.CORBA,javax.rmi";version="0.0.0.1_007_JavaSE", \
 javax.management.remote;uses:="javax.security.auth,javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management.timer;uses:="javax.management";version="0.0.0.1_007_JavaSE", \
 javax.management;uses:="javax.management.loading,javax.management.openmbean";version="0.0.0.1_007_JavaSE", \
 javax.naming.directory;uses:="javax.naming";version="0.0.0.1_007_JavaSE", \
 javax.naming.event;uses:="javax.naming,javax.naming.directory";version="0.0.0.1_007_JavaSE", \
 javax.naming.ldap;uses:="javax.naming,javax.naming.directory,javax.net.ssl,javax.naming.event";version="0.0.0.1_007_JavaSE", \
 javax.naming.spi;uses:="javax.naming,javax.naming.directory";version="0.0.0.1_007_JavaSE", \
 javax.naming;uses:="javax.naming.spi";version="0.0.0.1_007_JavaSE", \
 javax.net.ssl;uses:="javax.security.cert,javax.security.auth.x500,javax.net";version="0.0.0.1_007_JavaSE", \
 javax.net;version="0.0.0.1_007_JavaSE", \
 javax.print.attribute.standard;uses:="javax.print.attribute";version="0.0.0.1_007_JavaSE", \
 javax.print.attribute;version="0.0.0.1_007_JavaSE", \
 javax.print.event;uses:="javax.print,javax.print.attribute";version="0.0.0.1_007_JavaSE", \
 javax.print;uses:="javax.print.attribute,javax.print.event,javax.print.attribute.standard";version="0.0.0.1_007_JavaSE", \
 javax.rmi.CORBA;uses:="org.omg.CORBA,org.omg.CORBA_2_3.portable,org.omg.CORBA.portable,org.omg.SendingContext";version="0.0.0.1_007_JavaSE", \
 javax.rmi.ssl;uses:="javax.net,javax.net.ssl";version="0.0.0.1_007_JavaSE", \
 javax.rmi;uses:="org.omg.CORBA,javax.rmi.CORBA";version="0.0.0.1_007_JavaSE", \
 javax.script;version="0.0.0.1_007_JavaSE", \
 javax.security.auth.callback;version="0.0.0.1_007_JavaSE", \
 javax.security.auth.kerberos;uses:="javax.security.auth,javax.crypto";version="0.0.0.1_007_JavaSE", \
 javax.security.auth.login;uses:="javax.security.auth,javax.security.auth.callback";version="0.0.0.1_007_JavaSE", \
 javax.security.auth.spi;uses:="javax.security.auth.callback,javax.security.auth.login,javax.security.auth";version="0.0.0.1_007_JavaSE", \
 javax.security.auth.x500;uses:="javax.security.auth";version="0.0.0.1_007_JavaSE", \
 javax.security.auth;version="0.0.0.1_007_JavaSE", \
 javax.security.cert;version="0.0.0.1_007_JavaSE", \
 javax.security.sasl;uses:="javax.security.auth.callback";version="0.0.0.1_007_JavaSE", \
 javax.sound.midi.spi;uses:="javax.sound.midi";version="0.0.0.1_007_JavaSE", \
 javax.sound.midi;uses:="javax.sound.midi.spi";version="0.0.0.1_007_JavaSE", \
 javax.sound.sampled.spi;uses:="javax.sound.sampled";version="0.0.0.1_007_JavaSE", \
 javax.sound.sampled;uses:="javax.sound.sampled.spi";version="0.0.0.1_007_JavaSE", \
 javax.sql.rowset.serial;uses:="javax.sql.rowset";version="0.0.0.1_007_JavaSE", \
 javax.sql.rowset.spi;uses:="javax.sql,javax.naming,javax.sql.rowset";version="0.0.0.1_007_JavaSE", \
 javax.sql.rowset;uses:="javax.sql,javax.sql.rowset.serial,javax.sql.rowset.spi";version="0.0.0.1_007_JavaSE", \
 javax.sql;uses:="javax.transaction.xa";version="0.0.0.1_007_JavaSE", \
 javax.swing.border;uses:="javax.swing";version="0.0.0.1_007_JavaSE", \
 javax.swing.colorchooser;uses:="javax.swing,javax.swing.border,javax.swing.event,javax.swing.text";version="0.0.0.1_007_JavaSE", \
 javax.swing.event;uses:="javax.swing,javax.swing.text,javax.swing.table,javax.swing.tree,javax.swing.undo";version="0.0.0.1_007_JavaSE", \
 javax.swing.filechooser;uses:="javax.swing";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf.basic;uses:="javax.swing.border,javax.swing,javax.swing.plaf,javax.swing.text,javax.swing.event,javax.swing.colorchooser,javax.accessibility,javax.swing.filechooser,javax.swing.text.html,javax.sound.sampled,javax.swing.table,javax.swing.plaf.synth,javax.swing.tree";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf.metal;uses:="javax.swing.plaf,javax.swing,javax.swing.border,javax.swing.text,javax.swing.plaf.basic,javax.swing.filechooser,javax.swing.event,javax.swing.tree";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf.multi;uses:="javax.accessibility,javax.swing,javax.swing.plaf,javax.swing.filechooser,javax.swing.text,javax.swing.tree";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf.nimbus;uses:="javax.swing,javax.swing.plaf,javax.swing.border,javax.swing.plaf.synth";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf.synth;uses:="javax.swing,javax.swing.plaf,javax.swing.text,javax.swing.border,javax.swing.plaf.basic,javax.swing.colorchooser,javax.swing.event,javax.xml.parsers,org.xml.sax,org.xml.sax.helpers,javax.swing.table,javax.swing.tree";version="0.0.0.1_007_JavaSE", \
 javax.swing.plaf;uses:="javax.swing,javax.swing.border,javax.accessibility,javax.swing.filechooser,javax.swing.text,javax.swing.tree";version="0.0.0.1_007_JavaSE", \
 javax.swing.table;uses:="javax.swing.event,javax.swing.plaf,javax.swing.border,javax.swing,javax.accessibility";version="0.0.0.1_007_JavaSE", \
 javax.swing.text.html.parser;uses:="javax.swing.text,javax.swing.text.html";version="0.0.0.1_007_JavaSE", \
 javax.swing.text.html;uses:="javax.swing.event,javax.swing.text,javax.accessibility,javax.swing,javax.swing.plaf,javax.swing.border,javax.swing.undo";version="0.0.0.1_007_JavaSE", \
 javax.swing.text.rtf;uses:="javax.swing.text";version="0.0.0.1_007_JavaSE", \
 javax.swing.text;uses:="javax.swing.event,javax.swing.tree,javax.swing.undo,javax.swing,javax.swing.plaf,javax.swing.plaf.basic,javax.print,javax.print.attribute,javax.accessibility,javax.swing.text.html";version="0.0.0.1_007_JavaSE", \
 javax.swing.tree;uses:="javax.swing.event,javax.swing,javax.swing.border,javax.swing.plaf,javax.swing.plaf.basic";version="0.0.0.1_007_JavaSE", \
 javax.swing.undo;uses:="javax.swing,javax.swing.event";version="0.0.0.1_007_JavaSE", \
 javax.swing;uses:="javax.swing.event,javax.accessibility,javax.swing.text,javax.swing.plaf,javax.swing.border,javax.swing.tree,javax.swing.table,javax.swing.colorchooser,javax.swing.plaf.basic,javax.swing.text.html,javax.swing.filechooser,javax.print,javax.print.attribute,javax.swing.plaf.metal";version="0.0.0.1_007_JavaSE", \
 javax.tools;uses:="javax.lang.model.element,javax.annotation.processing,javax.lang.model";version="0.0.0.1_007_JavaSE", \
 javax.transaction.xa;version="0.0.0.1_007_JavaSE", \
 javax.transaction;version="0.0.0.1_007_JavaSE", \
 javax.xml.bind.annotation.adapters;uses:="javax.xml.bind";version="0.0.0.1_007_JavaSE", \
 javax.xml.bind.annotation;uses:="javax.xml.transform,javax.xml.bind,javax.xml.parsers,javax.xml.transform.dom,org.w3c.dom";version="0.0.0.1_007_JavaSE", \
 javax.xml.bind.attachment;uses:="javax.activation";version="0.0.0.1_007_JavaSE", \
 javax.xml.bind.helpers;uses:="javax.xml.bind.annotation.adapters,javax.xml.transform.dom,org.w3c.dom,org.xml.sax,javax.xml.bind.attachment,javax.xml.stream,javax.xml.transform,javax.xml.transform.stream,javax.xml.validation,javax.xml.transform.sax,javax.xml.bind,javax.xml.parsers";version="0.0.0.1_007_JavaSE", \
 javax.xml.bind.util;uses:="javax.xml.transform.sax,javax.xml.bind,org.xml.sax,org.xml.sax.ext,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", \
 javax.xml.bind;uses:="javax.xml.validation,javax.xml.namespace,javax.xml.datatype,javax.xml.transform,javax.xml.bind.annotation,javax.xml.transform.stream,org.w3c.dom,javax.xml.bind.attachment,javax.xml.stream,javax.xml.bind.annotation.adapters,org.xml.sax";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto.dom;uses:="javax.xml.crypto,org.w3c.dom";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto.dsig.dom;uses:="javax.xml.crypto.dsig,javax.xml.crypto,org.w3c.dom,javax.xml.crypto.dom";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto.dsig.keyinfo;uses:="javax.xml.crypto";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto.dsig.spec;uses:="javax.xml.crypto";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto.dsig;uses:="javax.xml.crypto,javax.xml.crypto.dsig.spec,javax.xml.crypto.dsig.keyinfo";version="0.0.0.1_007_JavaSE", \
 javax.xml.crypto;uses:="javax.xml.crypto.dsig.keyinfo";version="0.0.0.1_007_JavaSE", \
 javax.xml.datatype;uses:="javax.xml.namespace";version="0.0.0.1_007_JavaSE", \
 javax.xml.namespace;version="0.0.0.1_007_JavaSE", \
 javax.xml.parsers;uses:="javax.xml.validation,org.w3c.dom,org.xml.sax,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", \
 javax.xml.soap;uses:="javax.activation,javax.xml.namespace,org.w3c.dom,javax.xml.transform.dom,javax.xml.transform";version="0.0.0.1_007_JavaSE", \
 javax.xml.stream.events;uses:="javax.xml.namespace,javax.xml.stream";version="0.0.0.1_007_JavaSE", \
 javax.xml.stream.util;uses:="javax.xml.stream,javax.xml.stream.events,javax.xml.namespace";version="0.0.0.1_007_JavaSE", \
 javax.xml.stream;uses:="javax.xml.stream.events,javax.xml.namespace,javax.xml.stream.util,javax.xml.transform";version="0.0.0.1_007_JavaSE", \
 javax.xml.transform.dom;uses:="javax.xml.transform,org.w3c.dom";version="0.0.0.1_007_JavaSE", \
 javax.xml.transform.sax;uses:="org.xml.sax.ext,javax.xml.transform,org.xml.sax,javax.xml.transform.stream";version="0.0.0.1_007_JavaSE", \
 javax.xml.transform.stax;uses:="javax.xml.stream,javax.xml.transform,javax.xml.stream.events";version="0.0.0.1_007_JavaSE", \
 javax.xml.transform.stream;uses:="javax.xml.transform";version="0.0.0.1_007_JavaSE", \
 javax.xml.transform;version="0.0.0.1_007_JavaSE", \
 javax.xml.validation;uses:="org.w3c.dom.ls,javax.xml.transform,javax.xml.transform.stream,org.xml.sax,org.w3c.dom";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.handler.soap;uses:="javax.xml.ws.handler,javax.xml.namespace,javax.xml.soap,javax.xml.bind";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.handler;uses:="javax.xml.ws,javax.xml.namespace";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.http;uses:="javax.xml.ws";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.soap;uses:="javax.xml.ws.spi,javax.xml.ws,javax.xml.soap";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.spi.http;version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.spi;uses:="javax.xml.ws,javax.xml.ws.wsaddressing,javax.xml.transform,org.w3c.dom,javax.xml.namespace,javax.xml.ws.handler,javax.xml.bind";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws.wsaddressing;uses:="javax.xml.bind.annotation,javax.xml.namespace,org.w3c.dom,javax.xml.transform,javax.xml.bind,javax.xml.ws,javax.xml.ws.spi";version="0.0.0.1_007_JavaSE", \
 javax.xml.ws;uses:="javax.xml.ws.handler,javax.xml.ws.spi,javax.xml.ws.spi.http,javax.xml.transform,org.w3c.dom,javax.xml.bind.annotation,javax.xml.transform.stream,javax.xml.bind,javax.xml.namespace";version="0.0.0.1_007_JavaSE", \
 javax.xml.xpath;uses:="org.xml.sax,javax.xml.namespace";version="0.0.0.1_007_JavaSE", \
 javax.xml;version="0.0.0.1_007_JavaSE", \
 org.ietf.jgss;version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA.DynAnyPackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA.ORBPackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA.TypeCodePackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA.portable;uses:="org.omg.CORBA,org.omg.CORBA_2_3.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA;uses:="org.omg.CORBA.portable,org.omg.CORBA.DynAnyPackage,org.omg.CORBA.ORBPackage,org.omg.CORBA_2_3.portable,org.omg.CORBA.TypeCodePackage";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA_2_3.portable;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.CORBA_2_3;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.CosNaming.NamingContextExtPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.CosNaming.NamingContextPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.CosNaming";version="0.0.0.1_007_JavaSE", \
 org.omg.CosNaming;uses:="org.omg.CORBA.portable,org.omg.CORBA,org.omg.PortableServer,org.omg.CosNaming.NamingContextPackage,org.omg.CosNaming.NamingContextExtPackage";version="0.0.0.1_007_JavaSE", \
 org.omg.Dynamic;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.DynamicAny.DynAnyFactoryPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.DynamicAny.DynAnyPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.DynamicAny;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.DynamicAny.DynAnyFactoryPackage,org.omg.DynamicAny.DynAnyPackage";version="0.0.0.1_007_JavaSE", \
 org.omg.IOP.CodecFactoryPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.IOP.CodecPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.IOP;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.IOP.CodecFactoryPackage,org.omg.IOP.CodecPackage";version="0.0.0.1_007_JavaSE", \
 org.omg.Messaging;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableInterceptor.ORBInitInfoPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableInterceptor;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.IOP,org.omg.PortableInterceptor.ORBInitInfoPackage,org.omg.CORBA_2_3.portable,org.omg.Dynamic";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer.CurrentPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer.POAManagerPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer.POAPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer.ServantLocatorPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer.portable;uses:="org.omg.CORBA,org.omg.PortableServer";version="0.0.0.1_007_JavaSE", \
 org.omg.PortableServer;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.PortableServer.CurrentPackage,org.omg.PortableServer.POAManagerPackage,org.omg.PortableServer.POAPackage,org.omg.PortableServer.portable,org.omg.CORBA_2_3,org.omg.PortableServer.ServantLocatorPackage";version="0.0.0.1_007_JavaSE", \
 org.omg.SendingContext;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", \
 org.omg.stub.java.rmi;uses:="javax.rmi.CORBA";version="0.0.0.1_007_JavaSE", \
 org.w3c.dom.bootstrap;uses:="org.w3c.dom";version="0.0.0.1_007_JavaSE", \
 org.w3c.dom.events;uses:="org.w3c.dom,org.w3c.dom.views";version="0.0.0.1_007_JavaSE", \
 org.w3c.dom.ls;uses:="org.w3c.dom,org.w3c.dom.events,org.w3c.dom.traversal";version="0.0.0.1_007_JavaSE", \
 org.w3c.dom;version="0.0.0.1_007_JavaSE", \
 org.xml.sax.ext;uses:="org.xml.sax,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", \
 org.xml.sax.helpers;uses:="org.xml.sax";version="0.0.0.1_007_JavaSE", \
 org.xml.sax;version="0.0.0.1_007_JavaSE"</code></pre></div></div>
<div class="paragraph"><p>Remove the definition for the <code>javax.transaction</code> packages, and remove the <code>uses:=</code> clause for the <code>javax.sql</code> packages (but leaving the <code>version</code> clause). Concatenate all the lines together.
You&#8217;ll wind up with something like this in your <code>conf/config.properties</code> file:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-properties" data-lang="properties">org.osgi.framework.system.packages=org.osgi.framework;version=1.7.0, org.osgi.framework.hooks.bundle;version=1.1.0, org.osgi.framework.hooks.resolver;version=1.0.0, org.osgi.framework.hooks.service;version=1.1.0, org.osgi.framework.hooks.weaving;version=1.0.0, org.osgi.framework.launch;version=1.1.0, org.osgi.framework.namespace;version=1.0.0, org.osgi.framework.startlevel;version=1.0.0, org.osgi.framework.wiring;version=1.1.0, org.osgi.resource;version=1.0.0, org.osgi.service.packageadmin; version=1.2.0, org.osgi.service.startlevel; version=1.1.0, org.osgi.service.url;version=1.0.0, org.osgi.util.tracker;version=1.5.1 javax.accessibility;uses:="javax.swing.text";version="0.0.0.1_007_JavaSE", javax.activation;version="0.0.0.1_007_JavaSE", javax.activity;version="0.0.0.1_007_JavaSE", javax.annotation.processing;uses:="javax.tools,javax.lang.model,javax.lang.model.element,javax.lang.model.util";version="0.0.0.1_007_JavaSE", javax.annotation;version="0.0.0.1_007_JavaSE", javax.crypto.interfaces;uses:="javax.crypto.spec,javax.crypto";version="0.0.0.1_007_JavaSE", javax.crypto.spec;uses:="javax.crypto";version="0.0.0.1_007_JavaSE", javax.crypto;uses:="javax.crypto.spec";version="0.0.0.1_007_JavaSE", javax.imageio.event;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", javax.imageio.metadata;uses:="org.w3c.dom,javax.imageio";version="0.0.0.1_007_JavaSE", javax.imageio.plugins.bmp;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", javax.imageio.plugins.jpeg;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", javax.imageio.spi;uses:="javax.imageio.stream,javax.imageio,javax.imageio.metadata";version="0.0.0.1_007_JavaSE", javax.imageio.stream;uses:="javax.imageio";version="0.0.0.1_007_JavaSE", javax.imageio;uses:="javax.imageio.metadata,javax.imageio.stream,javax.imageio.spi,javax.imageio.event";version="0.0.0.1_007_JavaSE", javax.jws.soap;version="0.0.0.1_007_JavaSE", javax.jws;version="0.0.0.1_007_JavaSE", javax.lang.model.element;uses:="javax.lang.model.type,javax.lang.model";version="0.0.0.1_007_JavaSE", javax.lang.model.type;uses:="javax.lang.model.element,javax.lang.model";version="0.0.0.1_007_JavaSE", javax.lang.model.util;uses:="javax.lang.model,javax.lang.model.element,javax.annotation.processing,javax.lang.model.type";version="0.0.0.1_007_JavaSE", javax.lang.model;version="0.0.0.1_007_JavaSE", javax.management.loading;uses:="javax.management";version="0.0.0.1_007_JavaSE", javax.management.modelmbean;uses:="javax.management,javax.management.loading";version="0.0.0.1_007_JavaSE", javax.management.monitor;uses:="javax.management";version="0.0.0.1_007_JavaSE", javax.management.openmbean;uses:="javax.management";version="0.0.0.1_007_JavaSE", javax.management.relation;uses:="javax.management";version="0.0.0.1_007_JavaSE", javax.management.remote.rmi;uses:="javax.management.remote,javax.security.auth,javax.management,javax.management.loading,javax.naming,javax.rmi.ssl,org.omg.CORBA,org.omg.CORBA_2_3.portable,org.omg.CORBA.portable,javax.rmi.CORBA,javax.rmi";version="0.0.0.1_007_JavaSE", javax.management.remote;uses:="javax.security.auth,javax.management";version="0.0.0.1_007_JavaSE", javax.management.timer;uses:="javax.management";version="0.0.0.1_007_JavaSE", javax.management;uses:="javax.management.loading,javax.management.openmbean";version="0.0.0.1_007_JavaSE", javax.naming.directory;uses:="javax.naming";version="0.0.0.1_007_JavaSE", javax.naming.event;uses:="javax.naming,javax.naming.directory";version="0.0.0.1_007_JavaSE", javax.naming.ldap;uses:="javax.naming,javax.naming.directory,javax.net.ssl,javax.naming.event";version="0.0.0.1_007_JavaSE", javax.naming.spi;uses:="javax.naming,javax.naming.directory";version="0.0.0.1_007_JavaSE", javax.naming;uses:="javax.naming.spi";version="0.0.0.1_007_JavaSE", javax.net.ssl;uses:="javax.security.cert,javax.security.auth.x500,javax.net";version="0.0.0.1_007_JavaSE", javax.net;version="0.0.0.1_007_JavaSE", javax.print.attribute.standard;uses:="javax.print.attribute";version="0.0.0.1_007_JavaSE", javax.print.attribute;version="0.0.0.1_007_JavaSE", javax.print.event;uses:="javax.print,javax.print.attribute";version="0.0.0.1_007_JavaSE", javax.print;uses:="javax.print.attribute,javax.print.event,javax.print.attribute.standard";version="0.0.0.1_007_JavaSE", javax.rmi.CORBA;uses:="org.omg.CORBA,org.omg.CORBA_2_3.portable,org.omg.CORBA.portable,org.omg.SendingContext";version="0.0.0.1_007_JavaSE", javax.rmi.ssl;uses:="javax.net,javax.net.ssl";version="0.0.0.1_007_JavaSE", javax.rmi;uses:="org.omg.CORBA,javax.rmi.CORBA";version="0.0.0.1_007_JavaSE", javax.script;version="0.0.0.1_007_JavaSE", javax.security.auth.callback;version="0.0.0.1_007_JavaSE", javax.security.auth.kerberos;uses:="javax.security.auth,javax.crypto";version="0.0.0.1_007_JavaSE", javax.security.auth.login;uses:="javax.security.auth,javax.security.auth.callback";version="0.0.0.1_007_JavaSE", javax.security.auth.spi;uses:="javax.security.auth.callback,javax.security.auth.login,javax.security.auth";version="0.0.0.1_007_JavaSE", javax.security.auth.x500;uses:="javax.security.auth";version="0.0.0.1_007_JavaSE", javax.security.auth;version="0.0.0.1_007_JavaSE", javax.security.cert;version="0.0.0.1_007_JavaSE", javax.security.sasl;uses:="javax.security.auth.callback";version="0.0.0.1_007_JavaSE", javax.sound.midi.spi;uses:="javax.sound.midi";version="0.0.0.1_007_JavaSE", javax.sound.midi;uses:="javax.sound.midi.spi";version="0.0.0.1_007_JavaSE", javax.sound.sampled.spi;uses:="javax.sound.sampled";version="0.0.0.1_007_JavaSE", javax.sound.sampled;uses:="javax.sound.sampled.spi";version="0.0.0.1_007_JavaSE", javax.sql.rowset.serial;version="0.0.0.1_007_JavaSE", javax.sql.rowset.spi;version="0.0.0.1_007_JavaSE", javax.sql.rowset;version="0.0.0.1_007_JavaSE", javax.sql;version="0.0.0.1_007_JavaSE", javax.swing.border;uses:="javax.swing";version="0.0.0.1_007_JavaSE", javax.swing.colorchooser;uses:="javax.swing,javax.swing.border,javax.swing.event,javax.swing.text";version="0.0.0.1_007_JavaSE", javax.swing.event;uses:="javax.swing,javax.swing.text,javax.swing.table,javax.swing.tree,javax.swing.undo";version="0.0.0.1_007_JavaSE", javax.swing.filechooser;uses:="javax.swing";version="0.0.0.1_007_JavaSE", javax.swing.plaf.basic;uses:="javax.swing.border,javax.swing,javax.swing.plaf,javax.swing.text,javax.swing.event,javax.swing.colorchooser,javax.accessibility,javax.swing.filechooser,javax.swing.text.html,javax.sound.sampled,javax.swing.table,javax.swing.plaf.synth,javax.swing.tree";version="0.0.0.1_007_JavaSE", javax.swing.plaf.metal;uses:="javax.swing.plaf,javax.swing,javax.swing.border,javax.swing.text,javax.swing.plaf.basic,javax.swing.filechooser,javax.swing.event,javax.swing.tree";version="0.0.0.1_007_JavaSE", javax.swing.plaf.multi;uses:="javax.accessibility,javax.swing,javax.swing.plaf,javax.swing.filechooser,javax.swing.text,javax.swing.tree";version="0.0.0.1_007_JavaSE", javax.swing.plaf.nimbus;uses:="javax.swing,javax.swing.plaf,javax.swing.border,javax.swing.plaf.synth";version="0.0.0.1_007_JavaSE", javax.swing.plaf.synth;uses:="javax.swing,javax.swing.plaf,javax.swing.text,javax.swing.border,javax.swing.plaf.basic,javax.swing.colorchooser,javax.swing.event,javax.xml.parsers,org.xml.sax,org.xml.sax.helpers,javax.swing.table,javax.swing.tree";version="0.0.0.1_007_JavaSE", javax.swing.plaf;uses:="javax.swing,javax.swing.border,javax.accessibility,javax.swing.filechooser,javax.swing.text,javax.swing.tree";version="0.0.0.1_007_JavaSE", javax.swing.table;uses:="javax.swing.event,javax.swing.plaf,javax.swing.border,javax.swing,javax.accessibility";version="0.0.0.1_007_JavaSE", javax.swing.text.html.parser;uses:="javax.swing.text,javax.swing.text.html";version="0.0.0.1_007_JavaSE", javax.swing.text.html;uses:="javax.swing.event,javax.swing.text,javax.accessibility,javax.swing,javax.swing.plaf,javax.swing.border,javax.swing.undo";version="0.0.0.1_007_JavaSE", javax.swing.text.rtf;uses:="javax.swing.text";version="0.0.0.1_007_JavaSE", javax.swing.text;uses:="javax.swing.event,javax.swing.tree,javax.swing.undo,javax.swing,javax.swing.plaf,javax.swing.plaf.basic,javax.print,javax.print.attribute,javax.accessibility,javax.swing.text.html";version="0.0.0.1_007_JavaSE", javax.swing.tree;uses:="javax.swing.event,javax.swing,javax.swing.border,javax.swing.plaf,javax.swing.plaf.basic";version="0.0.0.1_007_JavaSE", javax.swing.undo;uses:="javax.swing,javax.swing.event";version="0.0.0.1_007_JavaSE", javax.swing;uses:="javax.swing.event,javax.accessibility,javax.swing.text,javax.swing.plaf,javax.swing.border,javax.swing.tree,javax.swing.table,javax.swing.colorchooser,javax.swing.plaf.basic,javax.swing.text.html,javax.swing.filechooser,javax.print,javax.print.attribute,javax.swing.plaf.metal";version="0.0.0.1_007_JavaSE", javax.tools;uses:="javax.lang.model.element,javax.annotation.processing,javax.lang.model";version="0.0.0.1_007_JavaSE", javax.xml.bind.annotation.adapters;uses:="javax.xml.bind";version="0.0.0.1_007_JavaSE", javax.xml.bind.annotation;uses:="javax.xml.transform,javax.xml.bind,javax.xml.parsers,javax.xml.transform.dom,org.w3c.dom";version="0.0.0.1_007_JavaSE", javax.xml.bind.attachment;uses:="javax.activation";version="0.0.0.1_007_JavaSE", javax.xml.bind.helpers;uses:="javax.xml.bind.annotation.adapters,javax.xml.transform.dom,org.w3c.dom,org.xml.sax,javax.xml.bind.attachment,javax.xml.stream,javax.xml.transform,javax.xml.transform.stream,javax.xml.validation,javax.xml.transform.sax,javax.xml.bind,javax.xml.parsers";version="0.0.0.1_007_JavaSE", javax.xml.bind.util;uses:="javax.xml.transform.sax,javax.xml.bind,org.xml.sax,org.xml.sax.ext,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", javax.xml.bind;uses:="javax.xml.validation,javax.xml.namespace,javax.xml.datatype,javax.xml.transform,javax.xml.bind.annotation,javax.xml.transform.stream,org.w3c.dom,javax.xml.bind.attachment,javax.xml.stream,javax.xml.bind.annotation.adapters,org.xml.sax";version="0.0.0.1_007_JavaSE", javax.xml.crypto.dom;uses:="javax.xml.crypto,org.w3c.dom";version="0.0.0.1_007_JavaSE", javax.xml.crypto.dsig.dom;uses:="javax.xml.crypto.dsig,javax.xml.crypto,org.w3c.dom,javax.xml.crypto.dom";version="0.0.0.1_007_JavaSE", javax.xml.crypto.dsig.keyinfo;uses:="javax.xml.crypto";version="0.0.0.1_007_JavaSE", javax.xml.crypto.dsig.spec;uses:="javax.xml.crypto";version="0.0.0.1_007_JavaSE", javax.xml.crypto.dsig;uses:="javax.xml.crypto,javax.xml.crypto.dsig.spec,javax.xml.crypto.dsig.keyinfo";version="0.0.0.1_007_JavaSE", javax.xml.crypto;uses:="javax.xml.crypto.dsig.keyinfo";version="0.0.0.1_007_JavaSE", javax.xml.datatype;uses:="javax.xml.namespace";version="0.0.0.1_007_JavaSE", javax.xml.namespace;version="0.0.0.1_007_JavaSE", javax.xml.parsers;uses:="javax.xml.validation,org.w3c.dom,org.xml.sax,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", javax.xml.soap;uses:="javax.activation,javax.xml.namespace,org.w3c.dom,javax.xml.transform.dom,javax.xml.transform";version="0.0.0.1_007_JavaSE", javax.xml.stream.events;uses:="javax.xml.namespace,javax.xml.stream";version="0.0.0.1_007_JavaSE", javax.xml.stream.util;uses:="javax.xml.stream,javax.xml.stream.events,javax.xml.namespace";version="0.0.0.1_007_JavaSE", javax.xml.stream;uses:="javax.xml.stream.events,javax.xml.namespace,javax.xml.stream.util,javax.xml.transform";version="0.0.0.1_007_JavaSE", javax.xml.transform.dom;uses:="javax.xml.transform,org.w3c.dom";version="0.0.0.1_007_JavaSE", javax.xml.transform.sax;uses:="org.xml.sax.ext,javax.xml.transform,org.xml.sax,javax.xml.transform.stream";version="0.0.0.1_007_JavaSE", javax.xml.transform.stax;uses:="javax.xml.stream,javax.xml.transform,javax.xml.stream.events";version="0.0.0.1_007_JavaSE", javax.xml.transform.stream;uses:="javax.xml.transform";version="0.0.0.1_007_JavaSE", javax.xml.transform;version="0.0.0.1_007_JavaSE", javax.xml.validation;uses:="org.w3c.dom.ls,javax.xml.transform,javax.xml.transform.stream,org.xml.sax,org.w3c.dom";version="0.0.0.1_007_JavaSE", javax.xml.ws.handler.soap;uses:="javax.xml.ws.handler,javax.xml.namespace,javax.xml.soap,javax.xml.bind";version="0.0.0.1_007_JavaSE", javax.xml.ws.handler;uses:="javax.xml.ws,javax.xml.namespace";version="0.0.0.1_007_JavaSE", javax.xml.ws.http;uses:="javax.xml.ws";version="0.0.0.1_007_JavaSE", javax.xml.ws.soap;uses:="javax.xml.ws.spi,javax.xml.ws,javax.xml.soap";version="0.0.0.1_007_JavaSE", javax.xml.ws.spi.http;version="0.0.0.1_007_JavaSE", javax.xml.ws.spi;uses:="javax.xml.ws,javax.xml.ws.wsaddressing,javax.xml.transform,org.w3c.dom,javax.xml.namespace,javax.xml.ws.handler,javax.xml.bind";version="0.0.0.1_007_JavaSE", javax.xml.ws.wsaddressing;uses:="javax.xml.bind.annotation,javax.xml.namespace,org.w3c.dom,javax.xml.transform,javax.xml.bind,javax.xml.ws,javax.xml.ws.spi";version="0.0.0.1_007_JavaSE", javax.xml.ws;uses:="javax.xml.ws.handler,javax.xml.ws.spi,javax.xml.ws.spi.http,javax.xml.transform,org.w3c.dom,javax.xml.bind.annotation,javax.xml.transform.stream,javax.xml.bind,javax.xml.namespace";version="0.0.0.1_007_JavaSE", javax.xml.xpath;uses:="org.xml.sax,javax.xml.namespace";version="0.0.0.1_007_JavaSE", javax.xml;version="0.0.0.1_007_JavaSE", org.ietf.jgss;version="0.0.0.1_007_JavaSE", org.omg.CORBA.DynAnyPackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", org.omg.CORBA.ORBPackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", org.omg.CORBA.TypeCodePackage;uses:="org.omg.CORBA";version="0.0.0.1_007_JavaSE", org.omg.CORBA.portable;uses:="org.omg.CORBA,org.omg.CORBA_2_3.portable";version="0.0.0.1_007_JavaSE", org.omg.CORBA;uses:="org.omg.CORBA.portable,org.omg.CORBA.DynAnyPackage,org.omg.CORBA.ORBPackage,org.omg.CORBA_2_3.portable,org.omg.CORBA.TypeCodePackage";version="0.0.0.1_007_JavaSE", org.omg.CORBA_2_3.portable;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.CORBA_2_3;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.CosNaming.NamingContextExtPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.CosNaming.NamingContextPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.CosNaming";version="0.0.0.1_007_JavaSE", org.omg.CosNaming;uses:="org.omg.CORBA.portable,org.omg.CORBA,org.omg.PortableServer,org.omg.CosNaming.NamingContextPackage,org.omg.CosNaming.NamingContextExtPackage";version="0.0.0.1_007_JavaSE", org.omg.Dynamic;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.DynamicAny.DynAnyFactoryPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.DynamicAny.DynAnyPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.DynamicAny;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.DynamicAny.DynAnyFactoryPackage,org.omg.DynamicAny.DynAnyPackage";version="0.0.0.1_007_JavaSE", org.omg.IOP.CodecFactoryPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.IOP.CodecPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.IOP;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.IOP.CodecFactoryPackage,org.omg.IOP.CodecPackage";version="0.0.0.1_007_JavaSE", org.omg.Messaging;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableInterceptor.ORBInitInfoPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableInterceptor;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.IOP,org.omg.PortableInterceptor.ORBInitInfoPackage,org.omg.CORBA_2_3.portable,org.omg.Dynamic";version="0.0.0.1_007_JavaSE", org.omg.PortableServer.CurrentPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableServer.POAManagerPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableServer.POAPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableServer.ServantLocatorPackage;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.PortableServer.portable;uses:="org.omg.CORBA,org.omg.PortableServer";version="0.0.0.1_007_JavaSE", org.omg.PortableServer;uses:="org.omg.CORBA,org.omg.CORBA.portable,org.omg.PortableServer.CurrentPackage,org.omg.PortableServer.POAManagerPackage,org.omg.PortableServer.POAPackage,org.omg.PortableServer.portable,org.omg.CORBA_2_3,org.omg.PortableServer.ServantLocatorPackage";version="0.0.0.1_007_JavaSE", org.omg.SendingContext;uses:="org.omg.CORBA,org.omg.CORBA.portable";version="0.0.0.1_007_JavaSE", org.omg.stub.java.rmi;uses:="javax.rmi.CORBA";version="0.0.0.1_007_JavaSE", org.w3c.dom.bootstrap;uses:="org.w3c.dom";version="0.0.0.1_007_JavaSE", org.w3c.dom.events;uses:="org.w3c.dom,org.w3c.dom.views";version="0.0.0.1_007_JavaSE", org.w3c.dom.ls;uses:="org.w3c.dom,org.w3c.dom.events,org.w3c.dom.traversal";version="0.0.0.1_007_JavaSE", org.w3c.dom;version="0.0.0.1_007_JavaSE", org.xml.sax.ext;uses:="org.xml.sax,org.xml.sax.helpers";version="0.0.0.1_007_JavaSE", org.xml.sax.helpers;uses:="org.xml.sax";version="0.0.0.1_007_JavaSE", org.xml.sax;version="0.0.0.1_007_JavaSE"</code></pre></div></div>
<div class="paragraph"><p>You should now be able to start Felix, and deploy all the jars listed on this page.
You should see output similar to this on the console, using the <code>felix:lb</code> command:</p></div>
<div class="literalblock"><div class="content"><pre>    ID|State      |Level|Name
    0|Active     |    0|System Bundle (4.4.1)
    1|Active     |    1|ASM (7.0)
    2|Active     |    1|ASM commons classes (7.0)
    3|Active     |    1|ASM Tree class visitor (7.0)
    4|Active     |    1|geronimo-jta_1.1_spec (1.1.1)
    5|Active     |    1|javax.annotation API (1.2.0)
    6|Active     |    1|javax.mail bundle from Glassfish (1.4.1.v201005082020)
    7|Active     |    1|Java Server Pages Standard Tag Library API Bundle (1.2.0.v201105211821)
    8|Active     |    1|JavaServer Pages (TM) TagLib Implementation (1.2.2)
    9|Active     |    1|Jetty :: Servlet Annotations (9.4.14)
   10|Active     |    1|Jetty :: Deployers (9.4.14)
   11|Active     |    1|Jetty :: Http Utility (9.4.14)
   12|Active     |    1|Jetty :: IO Utility (9.4.14)
   13|Active     |    1|Jetty :: JNDI Naming (9.4.14)
   14|Active     |    1|Jetty :: OSGi :: Boot (9.4.14)
   15|Resolved   |    1|Jetty-OSGi-Jasper Integration (9.4.14)
   16|Active     |    1|Jetty Servlet API and Schemas for OSGi (3.1.0)
   17|Active     |    1|Jetty :: Plus (9.4.14)
   18|Active     |    1|Jetty :: Security (9.4.14)
   19|Active     |    1|Jetty :: Server Core (9.4.14)
   20|Active     |    1|Jetty :: Servlet Handling (9.4.14)
   21|Active     |    1|Jetty :: Utility Servlets and Filters (9.4.14)
   22|Active     |    1|Jetty :: Utilities (9.4.14)
   23|Active     |    1|Jetty :: Webapp Application Support (9.4.14)
   24|Active     |    1|Jetty :: XML utilities (9.4.14)
   25|Active     |    1|Apache Aries SPI Fly Dynamic Weaving Bundle (1.1)
   27|Active     |    1|Apache Felix Bundle Repository (2.0.2)
   28|Active     |    1|Apache Felix Configuration Admin Service (1.8.0)
   29|Active     |    1|Apache Felix EventAdmin (1.3.2)
   30|Active     |    1|Apache Felix Gogo Command (0.14.0)
   31|Active     |    1|Apache Felix Gogo Runtime (0.12.1)
   32|Active     |    1|Apache Felix Gogo Shell (0.10.0)
   33|Active     |    1|Apache Felix Log Service (1.0.1)
   34|Active     |    1|Jetty :: Apache JSP (9.4.14)
   35|Active     |    1|Eclipse Compiler for Java(TM) (3.8.2.v20130121-145325)
   36|Active     |    1|Mortbay EL API and Implementation (8.5.33.1)
   37|Active     |    1|Mortbay Jasper (8.5.33.1)</pre></div></div></div>
<div class="sect4"><h5>Eclipse</h5><div class="paragraph"><p>The Jetty OSGi integration has been successfully tested against <a href="https://www.eclipse.org/equinox/">Equinox</a> Mars RC1.</p></div>
<div class="paragraph"><p>Ensure that these services are present:</p></div>
<div class="ulist"><ul><li><p><a href="https://www.eclipse.org/equinox/bundles/">Configuration Admin</a></p></li><li><p><a href="https://www.eclipse.org/equinox/bundles/">Event Admin</a></p></li></ul></div>
<div class="sect5"><h6>Eclipse Update Site</h6><div class="paragraph"><p>There is a list of Eclipse P2 sites for the jetty releases maintained at <a class="bare" href="http://download.eclipse.org/jetty/updates/jetty-bundles-9.x/">http://download.eclipse.org/jetty/updates/jetty-bundles-9.x/</a></p></div>
<div class="paragraph"><p>Each P2 repo has one big feature group that defines most of the Jetty jars.
<strong>Beware: No 3rd party dependency jars are included, so you will need to have installed the dependencies listed previously in this document.</strong></p></div>
<div class="paragraph"><p>In addition, as the feature group includes websocket, you will need to download and have installed the <code>javax.websocket-api</code> jar:</p></div>
<table class="tableblock frame-all grid-all spread"><caption class="title">Table 8. Extra Jars Required for Websocket</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Jar</th><th class="tableblock halign-left valign-top">Bundle Symbolic Name</th><th class="tableblock halign-left valign-top">Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">javax.websocket-api</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">javax.websocket-api</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://repo1.maven.org/maven2/javax/websocket/websocket-api">Maven
central</a></p></td></tr></tbody></table></div></div></div></div>
<div class="sect2"><h3 id="framework-weld">Weld</h3><div class="paragraph"><p><a href="http://seamframework.org/Weld">Weld</a> can be used to add support for CDI (Contexts and Dependency Injection) to Servlets, Listeners and Filters.
It is easily configured with Jetty 9.</p></div>
<div class="sect3"><h4 id="weld-setup-distro">Weld Setup</h4><div class="paragraph"><p>The easiest way to configure weld is within the jetty distribution itself:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Enable the startup <a href="#startup-modules">module</a> called "cdi".</p></li><li><p>Ensure your <code>WEB-INF/web.xml</code> contains the following:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">  &lt;listener&gt;
    &lt;listener-class&gt;org.jboss.weld.environment.servlet.Listener&lt;/listener-class&gt;
  &lt;/listener&gt;

  &lt;resource-env-ref&gt;
    &lt;description&gt;Object factory for the CDI Bean Manager&lt;/description&gt;
    &lt;resource-env-ref-name&gt;BeanManager&lt;/resource-env-ref-name&gt;
    &lt;resource-env-ref-type&gt;javax.enterprise.inject.spi.BeanManager&lt;/resource-env-ref-type&gt;
  &lt;/resource-env-ref&gt;</code></pre></div></div></li></ol></div>
<div class="paragraph"><p>That should be it so when you start up your jetty distribution with the webapp you should see output similar to the following (providing your logging is the default configuration):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">2015-06-18 12:13:54.924:INFO::main: Logging initialized @485ms
2015-06-18 12:13:55.231:INFO:oejs.Server:main: jetty-9.3.1-SNAPSHOT
2015-06-18 12:13:55.264:INFO:oejdp.ScanningAppProvider:main: Deployment monitor [file:///tmp/cdi-demo/webapps/] at interval 1
2015-06-18 12:13:55.607:WARN:oeja.AnnotationConfiguration:main: ServletContainerInitializers: detected. Class hierarchy: empty
Jun 18, 2015 12:13:55 PM org.jboss.weld.environment.servlet.EnhancedListener onStartup
INFO: WELD-ENV-001008: Initialize Weld using ServletContainerInitializer
Jun 18, 2015 12:13:55 PM org.jboss.weld.bootstrap.WeldStartup &lt;clinit&gt;
INFO: WELD-000900: 2.2.9 (Final)
Jun 18, 2015 12:13:55 PM org.jboss.weld.environment.servlet.deployment.WebAppBeanArchiveScanner scan
WARN: WELD-ENV-001004: Found both WEB-INF/beans.xml and WEB-INF/classes/META-INF/beans.xml. It's not portable to use both locations at the same time. Weld is going to use file:/tmp/jetty-0.0.0.0-8080-cdi-webapp.war-_cdi-webapp-any-8161614308407422636.dir/webapp/WEB-INF/beans.xml.
Jun 18, 2015 12:13:55 PM org.jboss.weld.bootstrap.WeldStartup startContainer
INFO: WELD-000101: Transactional services not available. Injection of @Inject UserTransaction not available. Transactional observers will be invoked synchronously.
Jun 18, 2015 12:13:55 PM org.jboss.weld.interceptor.util.InterceptionTypeRegistry &lt;clinit&gt;
WARN: WELD-001700: Interceptor annotation class javax.ejb.PostActivate not found, interception based on it is not enabled
Jun 18, 2015 12:13:55 PM org.jboss.weld.interceptor.util.InterceptionTypeRegistry &lt;clinit&gt;
WARN: WELD-001700: Interceptor annotation class javax.ejb.PrePassivate not found, interception based on it is not enabled
Jun 18, 2015 12:13:56 PM org.jboss.weld.bootstrap.MissingDependenciesRegistry handleResourceLoadingException
Jun 18, 2015 12:13:56 PM org.jboss.weld.environment.servlet.WeldServletLifecycle findContainer
INFO: WELD-ENV-001002: Container detection skipped - custom container class loaded: org.jboss.weld.environment.jetty.JettyContainer.
Jun 18, 2015 12:13:56 PM org.jboss.weld.environment.jetty.JettyContainer initialize
INFO: WELD-ENV-001200: Jetty 7.2+ detected, CDI injection will be available in Servlets and Filters. Injection into Listeners should work on Jetty 9.1.1 and newer.
Jun 18, 2015 12:13:56 PM org.jboss.weld.environment.servlet.Listener contextInitialized
INFO: WELD-ENV-001006: org.jboss.weld.environment.servlet.EnhancedListener used for ServletContext notifications
Jun 18, 2015 12:13:56 PM org.jboss.weld.environment.servlet.EnhancedListener contextInitialized
INFO: WELD-ENV-001009: org.jboss.weld.environment.servlet.Listener used for ServletRequest and HttpSession notifications
2015-06-18 12:13:56.535:INFO:oejsh.ContextHandler:main: Started o.e.j.w.WebAppContext@6574b225{/cdi-webapp,file:///tmp/jetty-0.0.0.0-8080-cdi-webapp.war-_cdi-webapp-any-8161614308407422636.dir/webapp/,AVAILABLE}{/cdi-webapp.war}
2015-06-18 12:13:56.554:INFO:oejs.ServerConnector:main: Started ServerConnector@7112f81c{HTTP/1.1,[http/1.1]}{0.0.0.0:8080}
2015-06-18 12:13:56.587:INFO:oejus.SslContextFactory:main: x509={jetty.eclipse.org=jetty} wild={} alias=null for SslContextFactory@3214ee6(file:///tmp/cdi-demo/etc/keystore,file:///tmp/cdi-demo/etc/keystore)
2015-06-18 12:13:56.821:INFO:oejs.ServerConnector:main: Started ServerConnector@69176a9b{SSL,[ssl, http/1.1]}{0.0.0.0:8443}
2015-06-18 12:13:56.822:INFO:oejs.Server:main: Started @2383ms</code></pre></div></div>
<div class="paragraph"><p>For use with the jetty-maven-plugin, the best idea is to make the org.jboss.weld.servlet:weld-servlet artifact a <em>plugin</em> dependency (<em>not</em> a webapp dependency), then follow step 2 above.</p></div></div></div>
<div class="sect2"><h3 id="framework-metro">Metro</h3><div class="paragraph"><p><a href="https://metro.java.net/">Metro</a> is the reference implementation for <a href="http://jcp.org/en/jsr/detail?id=109">web services</a>.
You can easily use Metro with Jetty to integrate web services with your web applications.</p></div>
<div class="sect3"><h4 id="metro-setup-distro">Metro Setup</h4><div class="olist arabic"><ol class="arabic"><li><p><a href="https://metro.java.net/latest/download.html">Download</a> the Metro distribution and unpack it to your disk.
We&#8217;ll refer to the unpacked location as <code>$metro.home</code>.</p></li><li><p>Create the directory <code>$jetty.home/lib/metro</code></p></li><li><p>Copy the jars from $metro.home/lib to <code>$jetty.home/lib/metro</code></p></li><li><p>Edit the start.ini file and add an OPTION line for metro near the end.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-plain" data-lang="plain">OPTIONS=metro</code></pre></div></div></li></ol></div>
<div class="paragraph"><p>That&#8217;s all the setup you need to do to integrate Jetty and Metro.</p></div>
<div class="paragraph"><p>Now read the <a href="https://metro.java.net/discover/">Metro documentation</a> on <a href="https://metro.java.net/getting-started/">how to create web services</a>.
The Metro distribution you downloaded should also contain several example web applications in the $metro.home/samples directory that you can build and deploy to Jetty (simply by copying the war file produced by the build).</p></div>
<div class="paragraph"><p>Here&#8217;s an example of the log output from Jetty when one of the sample Metro wars (from <code>$metro.home/samples/async</code>) is deployed to Jetty:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-screen" data-lang="screen">[2093] java -jar start.jar

2013-07-26 15:47:53.480:INFO:oejs.Server:main: jetty-9.0.4.v20130625
2013-07-26 15:47:53.549:INFO:oejdp.ScanningAppProvider:main: Deployment monitor [file:/home/user/jetty-distribution-9.4.15-SNAPSHOT/webapps/] at interval 1
Jul 26, 2013 3:47:53 PM com.sun.xml.ws.transport.http.servlet.WSServletContextListener contextInitialized
INFO: WSSERVLET12: JAX-WS context listener initializing
Jul 26, 2013 3:47:56 PM com.sun.xml.ws.server.MonitorBase createRoot
INFO: Metro monitoring rootname successfully set to: com.sun.metro:pp=/,type=WSEndpoint,name=/metro-async-AddNumbersService-AddNumbersImplPort
Jul 26, 2013 3:47:56 PM com.sun.xml.ws.transport.http.servlet.WSServletDelegate &lt;init&gt;
INFO: WSSERVLET14: JAX-WS servlet initializing
2013-07-26 15:47:56.800:INFO:oejsh.ContextHandler:main: Started o.e.j.w.WebAppContext@75707c77{/metro-async,file:/tmp/jetty-0.0.0.0-8080-metro-async.war-_metro-async-any-/webapp/,AVAILABLE}{/metro-async.war}
2013-07-26 15:47:56.853:INFO:oejs.ServerConnector:main: Started ServerConnector@47dce809{HTTP/1.1}{0.0.0.0:8080}</code></pre></div></div></div></div></div></div><div id="footer"><div id="footer-text">Version 1.0<br>Last updated 2019-01-09 13:48:47 CST</div></div></div></main><a href="#" class="scrollup">Back to the top</a></body></html>