<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;36.&nbsp;Upgrading Jetty</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="jetty-ref-guide.html" title="Part&nbsp;V.&nbsp;Jetty Reference Guide"><link rel="prev" href="release-testing.html" title="Testing a Jetty Release"><link xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tr><td style="width: 25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty Logo"></a><br><span style="font-size: small">
            Version: 9.4.0-SNAPSHOT</span></td><td style="width: 50%"><script type="text/javascript">  (function() {
            var cx = '016459005284625897022:obd4lsai2ds';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            })();
          </script><gcse:search></gcse:search></td></tr></table><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;36.&nbsp;Upgrading Jetty</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="release-testing.html"><i class="fa fa-chevron-left" aria-hidden="true"></i> Previous</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;Jetty Reference Guide<br><a accesskey="p" href="index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a></th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="jetty-callout"><h5 class="callout"><a href="http://www.webtide.com/">Contact the core Jetty developers at
          <span class="website">www.webtide.com</span></a></h5><p>
 private support for your internal/customer projects ... custom extensions and distributions ... versioned snapshots for indefinite support ...
 scalability guidance for your apps and Ajax/Comet projects ... development services for sponsored feature development
      </p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="upgrading-jetty"></a>Chapter&nbsp;36.&nbsp;Upgrading Jetty</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="upgrading-jetty.html#_upgrading_from_jetty_9_3_to_jetty_9_4">Upgrading from Jetty 9.3 to Jetty 9.4</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_upgrading_from_jetty_9_3_to_jetty_9_4"></a>Upgrading from Jetty 9.3 to Jetty 9.4</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="upgrading-jetty.html#_jetty_sh">jetty.sh</a></span></dt><dt><span class="section"><a href="upgrading-jetty.html#_module_changes_in_jetty_9_4">Module Changes in Jetty 9.4</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jetty_sh"></a>jetty.sh</h3></div></div></div><p>The file <code class="literal">jetty.sh</code>, typically used to start Jetty as a service in Linux/Unix
machines underwent only small changes, such as the addition of
<a class="link" href="https://wiki.debian.org/LSBInitScripts" target="_top">LSB tags</a>.</p><p>You can safely replace Jetty 9.3&#8217;s <code class="literal">jetty.sh</code> with 9.4&#8217;s.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_module_changes_in_jetty_9_4"></a>Module Changes in Jetty 9.4</h3></div></div></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">9.3 Module</th><th align="left" valign="top">9.4 Module</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">logging</code></p></td><td align="left" valign="top"><p><code class="literal">console-capture</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">infinispan</code></p></td><td align="left" valign="top"><p><code class="literal">session-store-infinispan-embedded</code> or <code class="literal">session-store-infinispan-remote</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">jdbc-sessions</code></p></td><td align="left" valign="top"><p><code class="literal">session-store-jdbc</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">gcloud-memcached-sessions</code>, <code class="literal">gcloud-session-idmgr</code> and <code class="literal">gcloud-sessions</code></p></td><td align="left" valign="top"><p><code class="literal">session-store-gcloud</code> and <code class="literal">session-store-cache</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">nosql</code></p></td><td align="left" valign="top"><p><code class="literal">session-store-mongo</code></p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_logging_modules"></a>Logging Modules</h4></div></div></div><p>The module <code class="literal">logging</code> is no longer available in Jetty 9.4.</p><p>The logging module structure present in Jetty 9.3 has been replaced with
a more fine-grained structure in Jetty 9.4, so that you have now more choices
available that are also easier to configure.</p><p>The migration path is different depending on whether you have completely
customized this module or not.</p><p>If you have a Jetty 9.3 installation, and you have both
<code class="literal">$jetty.base/modules/logging.mod</code> and <code class="literal">$jetty.base/etc/jetty-logging.xml</code>,
then this module is local to your <code class="literal">$jetty.base</code> setup and will be used
by Jetty 9.4 as before.
No changes are required for your implementation.</p><p>If either <code class="literal">$jetty.base/modules/logging.mod</code> or <code class="literal">$jetty.base/etc/jetty-logging.xml</code>
are missing, then you were relying on those present in <code class="literal">$jetty.home</code>,
which were present in Jetty 9.3, but are no longer available in Jetty 9.4.</p><p>The Jetty 9.3 <code class="literal">logging</code> module has been renamed to <code class="literal">console-capture</code> in Jetty 9.4.
You need to open your Jetty 9.3 <code class="literal">start.ini</code> and replace the references to the
<code class="literal">logging</code> modules with <code class="literal">console-capture</code>.</p><p>For example, in an existing 9.3 <code class="literal">start.ini</code> file the module declaration for logging would look like this:</p><div class="screenexample"><pre class="screen">--module=logging
jetty.logging.retainDays=7</pre></div><p>In 9.4, it should be replaced by:</p><div class="screenexample"><pre class="screen">--module=console-capture
jetty.console-capture.retainDays=7</pre></div><p>The properties that may be present in your Jetty 9.3&#8217;s <code class="literal">start.ini</code>, such as <code class="literal">jetty.logging.retainDays</code> will still be working in Jetty 9.4, but a warning will be printed at Jetty 9.4 startup, saying to replace them with correspondent <code class="literal">jetty.console-capture.*</code> properties such as <code class="literal">jetty.console-capture.retainDays</code>.</p><p>For information on logging modules in the Jetty 9.4 architecture please see the section on <a class="link" href="configuring-logging-modules.html" title="Jetty Logging Integrations (SLF4J, Log4j, Logback, JCL, JUL)">configuring logging modules.</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_session_management"></a>Session Management</h4></div></div></div><p>Session management received a significant overhaul in Jetty 9.4.
Session functionality has been refactored to promote code-reuse, easier configuration and easier customization.
Whereas previously users needed to edit xml configuration files, in Jetty 9.4 all session behavior is controlled by properties that are exposed by the various session modules.
Users now configure session management by selecting a composition of session modules.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_change_overview"></a>Change Overview</h5></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">SessionIdManager</span></dt><dd>Previously there was a different class of SessionIdManager - with different configuration options - depending upon which type of clustering technology chosen.
In Jetty 9.4, there is only one type, the <a class="link" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/session/DefaultSessionIdManager.html" target="_top">org.eclipse.jetty.server.session.DfeaultSessionIdManager</a>.</dd><dt><span class="term">SessionManager</span></dt><dd><p class="simpara">Previously, there was a different class of SessionManager depending upon which the type of clustering technology chosen.
In Jetty 9.4 we have removed the SessionManager class and split its functionality into different, more easily extensible and composable classes:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">General setters</span></dt><dd>All of the common setup of sessions such as the maxInactiveInterval and session cookie-related configuration has been moved to the <a class="link" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/session/SessionHandler.html" target="_top">org.eclipse.jetty.server.session.SessionHandler</a></dd></dl></div></dd></dl></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">9.3 SessionManager</th><th align="left" valign="top">9.4 SessionHandler</th></tr></thead><tbody><tr><td align="left" valign="top"><p>setMaxInactiveInterval(sec)</p></td><td align="left" valign="top"><p>setMaxInactiveInterval(sec)</p></td></tr><tr><td align="left" valign="top"><p>setSessionCookie(String)</p></td><td align="left" valign="top"><p>setSessionCookie(String)</p></td></tr><tr><td align="left" valign="top"><p>setRefreshCookieAge(sec)</p></td><td align="left" valign="top"><p>setRefreshCookieAge(sec)</p></td></tr><tr><td align="left" valign="top"><p>setSecureRequestOnly(boolean)</p></td><td align="left" valign="top"><p>setSecureRequestOnly(boolean</p></td></tr><tr><td align="left" valign="top"><p>setSessionIdPathParameterName(String)</p></td><td align="left" valign="top"><p>setSessionIdPathParameterName(String)</p></td></tr><tr><td align="left" valign="top"><p>setSessionTrackingModes(Set&lt;SessionTrackingMode&gt;)</p></td><td align="left" valign="top"><p>setSessionTrackingModes(Set&lt;SessionTrackingMode&gt;)</p></td></tr><tr><td align="left" valign="top"><p>setHttpOnly(boolean)</p></td><td align="left" valign="top"><p>setHttpOnly(boolean)</p></td></tr><tr><td align="left" valign="top"><p>setUsingCookies(boolean)</p></td><td align="left" valign="top"><p>setUsingCookies(boolean)</p></td></tr><tr><td align="left" valign="top"><p>setCheckingRemoteSessionIdEncoding(boolean)</p></td><td align="left" valign="top"><p>setCheckingRemoteSessionIdEncoding(boolean)</p></td></tr></tbody></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Persistence</span></dt><dd>In Jetty 9.3 SessionManagers (and sometimes SessionIdManagers) implemented the persistence mechanism.
In Jetty 9.4 we have moved this functionality into the <a class="link" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/session/SessionDataStore.html" target="_top">org.eclipse.jetty.server.session.SessionDataStore</a>.</dd><dt><span class="term">Session cache</span></dt><dd>In Jetty 9.3 the SessionManager held a map of session objects in memory.
In Jetty 9.4 this has been moved into the new <a class="link" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/session/SessionCache.html" target="_top">org.eclipse.jetty.server.session.SessionCache</a> interface.</dd></dl></div><p>For more information, please refer to the documentation on <a class="link" href="session-management.html#jetty-sessions-architecture" title="Session Architecture">Jetty Session Architecture.</a></p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_default"></a>Default</h5></div></div></div><p>As with earlier versions of Jetty, if you do not explicitly configure any session modules, the default session infrastructure will be enabled.
In previous versions of Jetty this was referred to as "hash" session management.
The new default provides similar features to the old hash session management:
 * a session scavenger thread that runs every 10mins and removes expired sessions
 * a session id manager that generates unique session ids and handles session id sharing during context forwarding
 * an in-memory cache of session objects.
Requests for the same session in the same context share the same session object.
Session objects remain in the cache until they expire or are explicitly invalidated.</p><p>If you wish to configure the default setup further, enable the <code class="literal">session-cache-default</code> module.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_filesystem"></a>Filesystem</h5></div></div></div><p>In earlier versions of Jetty, persisting sessions to the local filesystem was an option of the "hash" session manager.
In Jetty 9.4 this has been refactored to its own configurable module <code class="literal">session-store-file</code>.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_jdbc"></a>JDBC</h5></div></div></div><p>As with earlier versions of Jetty, sessions may be persisted to a relational database.
Enable the <code class="literal">session-store-jdbc</code> module.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_nosql"></a>NoSQL</h5></div></div></div><p>As with earlier versions of Jetty, sessions may be persisted to a document database.
Jetty supports the Mongo document database.
Enable the <code class="literal">session-store-mongo</code> module.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_infinispan"></a>Infinispan</h5></div></div></div><p>As with earlier versions of Jetty, sessions may be clustered via Infinispan to either an in-process or remote infinispan instance.
Enable the <code class="literal">session-store-infinispan</code> module.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_gcloud_datastore"></a>GCloud Datastore</h5></div></div></div><p>As with earlier versions of Jetty, sessions may be persisted to Google&#8217;s GCloud Datastore.
Enable the <code class="literal">session-store-gcloud</code> module.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_gcloud_datastore_with_memcached"></a>GCloud Datastore with Memcached</h5></div></div></div><p>As with earlier versions of Jetty, sessions can be both persisted to Google&#8217;s GCloud Datastore, and cached into Memcached for faster access.
Enable the <code class="literal">session-store-gcloud</code> and <code class="literal">session-store-cache</code> modules.</p></div></div></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-testing.html"><i class="fa fa-chevron-left" aria-hidden="true"></i> Previous</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="jetty-ref-guide.html"><i class="fa fa-chevron-up" aria-hidden="true"></i> Top</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Testing a Jetty Release&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><div class="jetty-callout">
            See an error or something missing?
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">Contribute to this documentation at
                <span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github!</span></a></span><span style="float: right"><i>(Generated: 2016-11-01)</i></span></div></p><script xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1149868-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script></body></html>