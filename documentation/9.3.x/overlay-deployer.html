<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Overlay WebApp Deployer</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-deployment.html" title="Chapter&nbsp;4.&nbsp;Deploying to Jetty"><link rel="prev" href="quickstart-webapp.html" title="Quickstart Webapps"><link rel="next" href="configuring-contexts.html" title="Chapter&nbsp;5.&nbsp;Configuring Contexts"><link xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tr><td style="width: 25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty Logo"></a><br><span style="font-size: small">
            Version: 9.3.11-SNAPSHOT</span></td><td style="width: 50%"><script type="text/javascript">  (function() {
            var cx = '016459005284625897022:obd4lsai2ds';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            })();
          </script><gcse:search></gcse:search></td></tr></table><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Overlay WebApp Deployer</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="quickstart-webapp.html"><i class="fa fa-chevron-left" aria-hidden="true"></i> Previous</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;4.&nbsp;Deploying to Jetty<br><a accesskey="p" href="index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a></th><td width="20%" align="right">&nbsp;<a accesskey="n" href="configuring-contexts.html">Next <i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></table><hr></div><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="jetty-callout"><h5 class="callout"><a href="http://www.webtide.com/">Contact the core Jetty developers at
          <span class="website">www.webtide.com</span></a></h5><p>
 private support for your internal/customer projects ... custom extensions and distributions ... versioned snapshots for indefinite support ...
 scalability guidance for your apps and Ajax/Comet projects ... development services for sponsored feature development
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overlay-deployer"></a>Overlay WebApp Deployer</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="overlay-deployer.html#overlay-overview">Overview</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#overlay-overlays">Overlays</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#overlay-jtrac">JTrac Overlay Example</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#overlay-configure">Configuring Jetty for Overlays</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#overlay-install">Installing the WebApp</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#_installing_a_template_overlay">Installing a Template Overlay</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#_installing_an_instance_overlay">Installing an Instance Overlay</a></span></dt><dt><span class="section"><a href="overlay-deployer.html#overlay-tips">Things to Know and Notice</a></span></dt></dl></div><div class="blockquote"><blockquote class="blockquote"><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i> Note</h3><p>This feature is reintroduced in Jetty 9.0.4</p></div></blockquote></div><p>The Jetty Overlay Deployer allows multiple WAR files to be overlaid so that a web application can be customized, configured, and deployed without unpacking, modifying and repacking the WAR file.
This has the following benefits:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">WAR files can be kept immutable, even signed, so that it is clear which version is deployed.</li><li class="listitem">All modifications made to customize/configure the web application are separate WARs, and thus are easily identifiable for review and migration to new versions.</li><li class="listitem">A parameterized template overlay can be created that contains common customizations and configuration that apply to many instances of the web application (for example, for multi-tenant deployment).</li><li class="listitem">Because the layered deployment clearly identifies the common and instance specific components, Jetty is able to share classloaders and static resource caches for the template, greatly reducing the memory footprint of multiple instances.</li></ul></div><p>This tutorial describes how to configure Jetty to use the Overlay Deployer, and how to deploy multiple instances of a web application using the JTrac application in the example.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-overview"></a>Overview</h3></div></div></div><p>Customizing, configuring and deploying a web application bundled as a WAR file frequently includes some or all of these steps:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Editing the <code class="literal">WEB-INF/web.xml</code> file to set init parameters, add filters/servlets or to configure JNDI resources.</li><li class="listitem">Editing other application specific configuration files under <code class="literal">WEB-INF/</code>.</li><li class="listitem">Editing container specific configuration files under <code class="literal">WEB-INF/</code> (for example, <code class="literal">jetty-web.xml</code> or <code class="literal">jboss-web.xml</code>).</li><li class="listitem">Adding/modifying static content such as images and CSS to create a style or themes for the web application.</li><li class="listitem">Adding Jars to the container classpath for Datasource and other resources.</li><li class="listitem">Modifying the container configuration to provide JNDI resources.</li></ul></div><p>The result is that the customizations and configurations blend into both the container and the WAR file.
If either the container or the base WAR file is upgraded to a new version, it can be a very difficult and error prone task to identify all the changes that have been made and to reapply them to a new version.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-overlays"></a>Overlays</h3></div></div></div><p>To solve the problems highlighted above, Jetty 7.4 introduces WAR overlays (a concept borrowed from the Maven WAR plugin).
An overlay is basically just another WAR file, whose contents merge on top of the original WAR so that filed can be added or replaced.
Jetty overlays also allow fragments of <code class="literal">web.xml</code> to be mixed in, which means the configuration can be modified without replacing it.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-jtrac"></a>JTrac Overlay Example</h3></div></div></div><p>The JTrac issue tracking web application is a good example of a typical web application, as it uses the usual suspects of libs: spring, hibernate, dom4j, commons-*, wicket, etc.
The files for this demonstration are available in overlays-demo.tar.gz.
The demonstation can be expanded on top of the jetty distribution; this tutorial expands it to /tmp and installs the components step-by-step:</p><div class="screenexample"><pre class="screen">$ cd /tmp
$ wget http://webtide.intalio.com/wp-content/uploads/2011/05/overlays-demo.tar.gz
$ tar xfvz overlays-demo.tar.gz
$ export OVERLAYS=/tmp/overlays</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-configure"></a>Configuring Jetty for Overlays</h3></div></div></div><p>Overlays support is included in jetty distributions from 7.4.1-SNAPSHOT onwards, which can be downloaded from oss.sonatype.org or Maven Central and unpack into a directory.
The <code class="literal">start.ini</code> file needs edited so that it includes the overlay option and configuration file.
The resulting file should look like:</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>OPTIONS=Server,jsp,jmx,resources,websocket,ext,overlay
etc/jetty.xml
etc/jetty-deploy.xml
etc/jetty-overlay.xml</code></pre><p>The mechanics of this are in etc/jetty-deploy.xml, which installs the <code class="literal">OverlayedAppProvider</code> into the <code class="literal">DeploymentManager</code>.
Jetty can then be started normally:</p><div class="screenexample"><pre class="screen">$ java -jar start.jar</pre></div><p>Jetty is now listening on port 8080, but with no webapp deployed.</p><div class="blockquote"><blockquote class="blockquote"><div xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><i class="fa fa-plus" aria-hidden="true"></i> Important</h3><p>You should conduct the rest of the tutorial in another window with the JETTY_HOME environment set to the jetty distribution directory.</p></div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-install"></a>Installing the WebApp</h3></div></div></div><p>The WAR file for this demo can be downloaded and deployed the using the following commands, which downloads and extracts the WAR file to the $JETTY_HOME/overlays/webapps directory.</p><div class="screenexample"><pre class="screen">$ cd /tmp
$ wget -O jtrac.zip http://sourceforge.net/projects/j-trac/files/jtrac/2.1.0/jtrac-2.1.0.zip/download
$ jar xfv jtrac.zip jtrac/jtrac.war
$ mv jtrac/jtrac.war $JETTY_HOME/overlays/webapps</pre></div><p>When these commands (or equivalent) have been executed, a message that the <code class="literal">OverlayedAppProvider</code> has extracted and loaded the WAR file will be displayed in the Jetty server window:</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>2011-05-06 10:31:54.678:INFO:OverlayedAppProvider:Extract jar:file:/tmp/jetty-distribution-7.4.1-SNAPSHOT/overlays/webapps/jtrac-2.1.0.war!/ to /tmp/jtrac-2.1.0_236811420856825222.extract
2011-05-06 10:31:55.235:INFO:OverlayedAppProvider:loaded jtrac-2.1.0@1304641914666</code></pre><p>Unlike the normal webapps dir, loading a WAR file from the overlays/webapp dir does not deploy the web application, it simply makes it available to use as the basis for templates and overlays.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_installing_a_template_overlay"></a>Installing a Template Overlay</h3></div></div></div><p>A template overlay is a WAR structured directory/archive that contains the files that have been added or modified to customize/configure the web application for all instances planned for deployment.</p><p>The demo template can be installed from the downloaded files with the command:</p><div class="screenexample"><pre class="screen">$ mv $OVERLAYS/jtracTemplate\=jtrac-2.1.0 $JETTY_HOME/overlays/templates/</pre></div><p>In the Jetty server window, a message similar to this will be displayed confirmed that the template is loaded:</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>2011-05-06 11:00:08.716:INFO:OverlayedAppProvider:loaded jtracTemplate=jtrac-2.1.0@1304643608715</code></pre><p>The contents of the loaded template are as follows:</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>templates/jtracTemplate=jtrac-2.1.0
|__ WEB-INF
    |__ classes
    |   |__ jtrac-init.properties
    |__ log4j.properties
    |__ overlay.xml
    |__ template.xml
    |__ web-overlay.xml</code></pre><div class="variablelist"><dl><dt><span class="term">name of the template directory (or WAR)</span></dt><dd>Uses the &#8216;=&#8217; character in jtracTemplate=jtrac-2.1.0 to separate the name of the template from the name of the WAR file in webapps that it applies to.
If = is a problem, use&#8201;&#8212;&#8201;instead.</dd><dt><span class="term">WEB-INF/classes/jtrac-init.properties</span></dt><dd>Replaces the JTrac properties file with an empty file, as the properties it contains are configured elsewhere.</dd><dt><span class="term">WEB-INF/log4j.properties</span></dt><dd>Configures the logging for all instances of the template.</dd><dt><span class="term">WEB-INF/overlay.xml</span></dt><dd>A Jetty XML formatted IoC file that injects/configures the <code class="literal">ContextHandler</code> for each instance. \
In this case it sets up the context path:</dd></dl></div><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd"&gt;
&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;Set name="contextPath"&gt;/&lt;/Set&gt;
&lt;/Configure&gt;</code></pre><div class="variablelist"><dl><dt><span class="term">WEB-INF/template.xml</span></dt><dd>A Jetty XML formatted IoC file that injects/configures the resource cache and classloader that all instances of the template share.
It runs only once per load of the template:</dd></dl></div><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd"&gt;
&lt;Configure class="org.eclipse.jetty.overlays.TemplateContext"&gt;
  &lt;Get name="resourceCache"&gt;
    &lt;Set name="useFileMappedBuffer"&gt;true&lt;/Set&gt;
    &lt;Set name="maxCachedFileSize"&gt;10000000&lt;/Set&gt;
    &lt;Set name="maxCachedFiles"&gt;1000&lt;/Set&gt;
    &lt;Set name="maxCacheSize"&gt;64000000&lt;/Set&gt;
  &lt;/Get&gt;
&lt;/Configure&gt;</code></pre><div class="variablelist"><dl><dt><span class="term">WEB-INF/web-overlay.xml</span></dt><dd>A <code class="literal">web.xml</code> fragment that Jetty overlays on top of the <code class="literal">web.xml</code> from the base WAR file; it can set init parameters and add/modify filters and
servlets.
In this example it sets the application home and springs <code class="literal">webAppRootKey</code>:</dd></dl></div><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
    version="2.4"&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;jtrac.home&lt;/param-name&gt;
    &lt;param-value&gt;/tmp/jtrac-${overlay.instance.classifier}&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;webAppRootKey&lt;/param-name&gt;
    &lt;param-value&gt;jtrac-${overlay.instance.classifier}&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;filter&gt;
&lt;/web-app&gt;</code></pre><p>Notice the parameterization of values such as <code class="literal">${overlays.instance.classifier}</code>, as this allows the configuration to be in the template, and not customized for each instance.</p><p>Without the Overlay Deployer, all of the above would still need to have configure , but rather than being in a single clear structure the configuration elements would have been either in the server&#8217;s common directory, the server&#8217;s <code class="literal">webdefaults.xml</code> (aka <code class="literal">server.xml</code>), or baked into the WAR file of each application instance using copied/modified files from the original.
The Overlay Deployer allows all these changes to be made in one structure; moreover it allows for the parameterization of some of the configuration, which facilitates easy multi-tenant deployment.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_installing_an_instance_overlay"></a>Installing an Instance Overlay</h3></div></div></div><p>Now that the template is installed, one or more instance overlays can be implemented to deploy the actual web applications:</p><div class="screenexample"><pre class="screen">$ mv /tmp/overlays/instances/jtracTemplate\=blue $JETTY_HOME/overlays/instances/
$ mv /tmp/overlays/instances/jtracTemplate\=red $JETTY_HOME/overlays/instances/
$ mv /tmp/overlays/instances/jtracTemplate\=blue $JETTY_HOME/overlays/instances/</pre></div><p>As each instance moves into place, the Jetty server window reacts and deploys the instance.
Within each instance, there is the structure:</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>instances/jtracTemplate=red/
|__ WEB-INF
|   |__ overlay.xml
|__ favicon.ico
|__ resources
    |__ jtrac.css</code></pre><div class="variablelist"><dl><dt><span class="term">WEB-INF/overlay.xml</span></dt><dd>A Jetty XML format IoC file that injects/configures the context for the instance.
In this case it sets up a virtual host for the instance:</dd></dl></div><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd"&gt;
&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;Set name="virtualHosts"&gt;
    &lt;Array type="String"&gt;
      &lt;Item&gt;127.0.0.2&lt;/Item&gt;
      &lt;Item&gt;red.myVirtualDomain.com&lt;/Item&gt;
    &lt;/Array&gt;
  &lt;/Set&gt;
&lt;/Configure&gt;</code></pre><div class="variablelist"><dl><dt><span class="term">favicon.ico</span></dt><dd>Replaces the icon in the base WAR with one that has a theme for the instance; in this case red, blue, or green.</dd><dt><span class="term">resources/jtrac.css</span></dt><dd>Replaces the style sheet from the base WAR with one that has a theme for the instance.</dd></dl></div><p>Deployed instances can be vied by pointing a browser at <a class="link" href="http://127.0.0.1:8080" target="_top">http://127.0.0.1:8080</a>, <a class="link" href="http://127.0.0.2:8080" target="_top">http://127.0.0.2:8080</a> and <a class="link" href="http://127.0.0.3:8080" target="_top">http://127.0.0.3:8080</a>.
The default username/password for JTrac is admin/admin.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overlay-tips"></a>Things to Know and Notice</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Each instance has themes with images and style sheets from the instance overlay.</li><li class="listitem">Each instance is running with its own application directory (that is, /tmp/jtrac-red), set in templates web-overlay.xml.</li><li class="listitem">A virtual host set in the instance overlay.xml distinguishes the instances.</li><li class="listitem">All instances share static content from the base WAR and template.
Specifically there is a shared <code class="literal">ResourceCache</code> so only a single instance of each static content is loaded into memory.</li><li class="listitem">All instances share the classloader at the base WAR and template level, so that only a single instance of common classes is loaded into memory.
Classes with non shared statics can be configured to load in the instances classloader.</li><li class="listitem"><p class="simpara">Jetty hot deploys all overlays and tracks dependencies.</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">If an XML changes in an instance, Jetty redeploys it.</li><li class="listitem">If an XML changes in a template, then Jetty redeploys all instances using it.</li><li class="listitem">If a WAR file changes, then Jetty redeploys all templates and all instances dependent on it.</li></ul></div></li><li class="listitem">New versions can be easily deployed.
For example, when JTrac-2.2.0.war becomes available, it can be placed into <code class="literal">overlays/webapps</code> and then rename <code class="literal">jtracTemplate\=jtrac-2.1.0</code> to <code class="literal">jtracTemplate\=jtrac-2.2.0</code>.</li><li class="listitem">There is a fuller version of this demo in overlays-demo-jndi.tar.gz, that uses JNDI (needs <code class="literal">options=jndi</code>, annotations and <code class="literal">jetty-plus.xml</code> in <code class="literal">start.ini</code>) and shows how additional JARs can be added in the overlays.</li></ul></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="quickstart-webapp.html"><i class="fa fa-chevron-left" aria-hidden="true"></i> Previous</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="configuring-deployment.html"><i class="fa fa-chevron-up" aria-hidden="true"></i> Top</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="configuring-contexts.html">Next <i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">Quickstart Webapps&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;Configuring Contexts</td></tr></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><div class="jetty-callout">
            See an error or something missing?
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">Contribute to this documentation at
                <span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github!</span></a></span><span style="float: right"><i>(Generated: 2016-07-05)</i></span></div></p><script xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1149868-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script></body></html>